<h1 id="day-7">Day 7<a aria-hidden="true" class="anchor-heading icon-link" href="#day-7"></a></h1>
<h2 id="some-assembly-required">Some Assembly Required<a aria-hidden="true" class="anchor-heading icon-link" href="#some-assembly-required"></a></h2>
<h2 id="part-i">Part I<a aria-hidden="true" class="anchor-heading icon-link" href="#part-i"></a></h2>
<p>This year, Santa brought little Bobby Tables a set of wires and bitwise logic gates! Unfortunately, little Bobby is a little under the recommended age range, and he needs help assembling the circuit.</p>
<p>Each wire has an identifier (some lowercase letters) and can carry a 16-bit signal (a number from <code>0</code> to <code>65535</code>). A signal is provided to each wire by a gate, another wire, or some specific value. Each wire can only get a signal from one source, but can provide its signal to multiple destinations. A gate provides no signal until all of its inputs have a signal.</p>
<p>The included instructions booklet describes how to connect the parts together: <code>x AND y -> z</code> means to connect wires <code>x</code> and <code>y</code> to an AND gate, and then connect its output to wire <code>z</code>.</p>
<p>For example:</p>
<blockquote>
<p><code>123 -> x</code> means that the signal 123 is provided to wire <code>x</code>.</p>
<p><code>x AND y -> z</code> means that the bitwise AND of wire <code>x</code> and wire <code>y</code> is provided to wire <code>z</code>.</p>
<p><code>p LSHIFT 2 -> q</code> means that the value from wire <code>p</code> is left-shifted by <code>2</code> and then provided to wire <code>q</code>.</p>
<p><code>NOT e -> f</code> means that the bitwise complement of the value from wire <code>e</code> is provided to wire <code>f</code>.</p>
</blockquote>
<p>Other possible gates include <code>OR</code> (bitwise OR) and <code>RSHIFT</code> (right-shift). If, for some reason, you'd like to emulate the circuit instead, almost all programming languages (for example, C, JavaScript, or Python) provide operators for these gates.</p>
<p>For example, here is a simple circuit:</p>
<pre><code>123 -> x
456 -> y
x AND y -> d
x OR y -> e
x LSHIFT 2 -> f
y RSHIFT 2 -> g
NOT x -> h
NOT y -> i
</code></pre>
<p>After it is run, these are the signals on the wires:</p>
<pre><code>d: 72
e: 507
f: 492
g: 114
h: 65412
i: 65079
x: 123
y: 456
</code></pre>
<p>In little Bobby's kit's instructions booklet (provided as your puzzle input), what signal is ultimately provided to wire <code>a</code>?</p>
<h2 id="solution">Solution<a aria-hidden="true" class="anchor-heading icon-link" href="#solution"></a></h2>
<pre class="language-rust"><code class="language-rust"><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>collections<span class="token punctuation">::</span></span><span class="token class-name">HashMap</span><span class="token punctuation">;</span>
<span class="token attribute attr-name">#[derive(Debug)]</span>
<span class="token keyword">pub</span> <span class="token keyword">enum</span> <span class="token type-definition class-name">Gate</span> <span class="token punctuation">{</span>
    <span class="token class-name">Value</span><span class="token punctuation">(</span><span class="token keyword">u16</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token class-name">Source</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token class-name">And</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token class-name">AndValue</span><span class="token punctuation">(</span><span class="token keyword">u16</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token class-name">Or</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token class-name">LShift</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token keyword">u16</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token class-name">RShift</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token keyword">u16</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token class-name">Not</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token attribute attr-name">#[aoc_generator(day7)]</span>
<span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">input_to_struct</span><span class="token punctuation">(</span>input<span class="token punctuation">:</span> <span class="token operator">&#x26;</span><span class="token keyword">str</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Vec</span><span class="token operator">&#x3C;</span><span class="token class-name">Gate</span><span class="token operator">></span> <span class="token punctuation">{</span>
    input
        <span class="token punctuation">.</span><span class="token function">lines</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>line<span class="token closure-punctuation punctuation">|</span></span> <span class="token punctuation">{</span>
            <span class="token keyword">let</span> words <span class="token operator">=</span> line<span class="token punctuation">.</span><span class="token function">split_whitespace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">::</span><span class="token operator">&#x3C;</span><span class="token class-name">Vec</span><span class="token operator">&#x3C;</span>_<span class="token operator">>></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> words<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">"NOT"</span> <span class="token punctuation">{</span>
                <span class="token class-name">Gate</span><span class="token punctuation">::</span><span class="token class-name">Not</span><span class="token punctuation">(</span>words<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> words<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> words<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">"LSHIFT"</span> <span class="token punctuation">{</span>
                <span class="token class-name">Gate</span><span class="token punctuation">::</span><span class="token class-name">LShift</span><span class="token punctuation">(</span>
                    words<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    words<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">::</span><span class="token operator">&#x3C;</span><span class="token keyword">u16</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    words<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token punctuation">)</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> words<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">"RSHIFT"</span> <span class="token punctuation">{</span>
                <span class="token class-name">Gate</span><span class="token punctuation">::</span><span class="token class-name">RShift</span><span class="token punctuation">(</span>
                    words<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    words<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">::</span><span class="token operator">&#x3C;</span><span class="token keyword">u16</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    words<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token punctuation">)</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> words<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">::</span><span class="token operator">&#x3C;</span><span class="token keyword">i64</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">is_ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&#x26;&#x26;</span> words<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">"AND"</span> <span class="token punctuation">{</span>
                <span class="token class-name">Gate</span><span class="token punctuation">::</span><span class="token class-name">AndValue</span><span class="token punctuation">(</span>
                    words<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">::</span><span class="token operator">&#x3C;</span><span class="token keyword">u16</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    words<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    words<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token punctuation">)</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> words<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">"AND"</span> <span class="token punctuation">{</span>
                <span class="token class-name">Gate</span><span class="token punctuation">::</span><span class="token class-name">And</span><span class="token punctuation">(</span>
                    words<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    words<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    words<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token punctuation">)</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> words<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">"OR"</span> <span class="token punctuation">{</span>
                <span class="token class-name">Gate</span><span class="token punctuation">::</span><span class="token class-name">Or</span><span class="token punctuation">(</span>
                    words<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    words<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    words<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token punctuation">)</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> words<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">::</span><span class="token operator">&#x3C;</span><span class="token keyword">i64</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">is_ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&#x26;&#x26;</span> words<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">"->"</span> <span class="token punctuation">{</span>
                <span class="token class-name">Gate</span><span class="token punctuation">::</span><span class="token class-name">Value</span><span class="token punctuation">(</span>
                    words<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">::</span><span class="token operator">&#x3C;</span><span class="token keyword">u16</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    words<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token punctuation">)</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> words<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">"->"</span> <span class="token punctuation">{</span>
                <span class="token class-name">Gate</span><span class="token punctuation">::</span><span class="token class-name">Source</span><span class="token punctuation">(</span>words<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> words<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                <span class="token macro property">unreachable!</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">::</span><span class="token operator">&#x3C;</span><span class="token class-name">Vec</span><span class="token operator">&#x3C;</span><span class="token class-name">Gate</span><span class="token operator">>></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">fn</span> <span class="token function-definition function">solve_circuit</span><span class="token punctuation">(</span>gates<span class="token punctuation">:</span> <span class="token operator">&#x26;</span><span class="token punctuation">[</span><span class="token class-name">Gate</span><span class="token punctuation">]</span><span class="token punctuation">,</span> values<span class="token punctuation">:</span> <span class="token operator">&#x26;</span><span class="token keyword">mut</span> <span class="token class-name">HashMap</span><span class="token operator">&#x3C;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token keyword">u16</span><span class="token operator">></span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">HashMap</span><span class="token operator">&#x3C;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token keyword">u16</span><span class="token operator">></span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> <span class="token keyword">mut</span> unresolved <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> constants <span class="token operator">=</span> values<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">while</span> unresolved <span class="token punctuation">{</span>
        <span class="token keyword">let</span> values_prev <span class="token operator">=</span> values<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        gates<span class="token punctuation">.</span><span class="token function">iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">for_each</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>item<span class="token closure-punctuation punctuation">|</span></span> <span class="token punctuation">{</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span>k<span class="token punctuation">,</span> v<span class="token punctuation">)</span> <span class="token keyword">in</span> <span class="token operator">&#x26;</span>constants <span class="token punctuation">{</span>
                values<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>k<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">*</span>v<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">match</span> item <span class="token punctuation">{</span>
                <span class="token class-name">Gate</span><span class="token punctuation">::</span><span class="token class-name">Value</span><span class="token punctuation">(</span><span class="token keyword">ref</span> num<span class="token punctuation">,</span> <span class="token keyword">ref</span> dst<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
                    values<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>dst<span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">*</span>num<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token class-name">Gate</span><span class="token punctuation">::</span><span class="token class-name">Source</span><span class="token punctuation">(</span><span class="token keyword">ref</span> src0<span class="token punctuation">,</span> <span class="token keyword">ref</span> dst<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
                    <span class="token keyword">if</span> values<span class="token punctuation">.</span><span class="token function">contains_key</span><span class="token punctuation">(</span>src0<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token keyword">let</span> v0 <span class="token operator">=</span> <span class="token operator">*</span>values<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>src0<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        values<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>dst<span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> v0<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
                <span class="token class-name">Gate</span><span class="token punctuation">::</span><span class="token class-name">And</span><span class="token punctuation">(</span><span class="token keyword">ref</span> src0<span class="token punctuation">,</span> <span class="token keyword">ref</span> src1<span class="token punctuation">,</span> <span class="token keyword">ref</span> dst<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
                    <span class="token keyword">if</span> values<span class="token punctuation">.</span><span class="token function">contains_key</span><span class="token punctuation">(</span>src0<span class="token punctuation">)</span> <span class="token operator">&#x26;&#x26;</span> values<span class="token punctuation">.</span><span class="token function">contains_key</span><span class="token punctuation">(</span>src1<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token keyword">let</span> v0 <span class="token operator">=</span> <span class="token operator">*</span>values<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>src0<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token keyword">let</span> v1 <span class="token operator">=</span> <span class="token operator">*</span>values<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>src1<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        values<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>dst<span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> v0 <span class="token operator">&#x26;</span> v1<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
                <span class="token class-name">Gate</span><span class="token punctuation">::</span><span class="token class-name">AndValue</span><span class="token punctuation">(</span><span class="token keyword">ref</span> v0<span class="token punctuation">,</span> <span class="token keyword">ref</span> src1<span class="token punctuation">,</span> <span class="token keyword">ref</span> dst<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
                    <span class="token keyword">if</span> values<span class="token punctuation">.</span><span class="token function">contains_key</span><span class="token punctuation">(</span>src1<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token keyword">let</span> v1 <span class="token operator">=</span> <span class="token operator">*</span>values<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>src1<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        values<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>dst<span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">*</span>v0 <span class="token operator">&#x26;</span> v1<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
                <span class="token class-name">Gate</span><span class="token punctuation">::</span><span class="token class-name">Or</span><span class="token punctuation">(</span><span class="token keyword">ref</span> src0<span class="token punctuation">,</span> <span class="token keyword">ref</span> src1<span class="token punctuation">,</span> <span class="token keyword">ref</span> dst<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
                    <span class="token keyword">if</span> values<span class="token punctuation">.</span><span class="token function">contains_key</span><span class="token punctuation">(</span>src0<span class="token punctuation">)</span> <span class="token operator">&#x26;&#x26;</span> values<span class="token punctuation">.</span><span class="token function">contains_key</span><span class="token punctuation">(</span>src1<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token keyword">let</span> v0 <span class="token operator">=</span> <span class="token operator">*</span>values<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>src0<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token keyword">let</span> v1 <span class="token operator">=</span> <span class="token operator">*</span>values<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>src1<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        values<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>dst<span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> v0 <span class="token operator">|</span> v1<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
                <span class="token class-name">Gate</span><span class="token punctuation">::</span><span class="token class-name">LShift</span><span class="token punctuation">(</span><span class="token keyword">ref</span> src0<span class="token punctuation">,</span> <span class="token keyword">ref</span> num<span class="token punctuation">,</span> <span class="token keyword">ref</span> dst<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
                    <span class="token keyword">if</span> values<span class="token punctuation">.</span><span class="token function">contains_key</span><span class="token punctuation">(</span>src0<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token keyword">let</span> v0 <span class="token operator">=</span> <span class="token operator">*</span>values<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>src0<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        values<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>dst<span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> v0 <span class="token operator">&#x3C;&#x3C;</span> <span class="token operator">*</span>num<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
                <span class="token class-name">Gate</span><span class="token punctuation">::</span><span class="token class-name">RShift</span><span class="token punctuation">(</span><span class="token keyword">ref</span> src0<span class="token punctuation">,</span> <span class="token keyword">ref</span> num<span class="token punctuation">,</span> <span class="token keyword">ref</span> dst<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
                    <span class="token keyword">if</span> values<span class="token punctuation">.</span><span class="token function">contains_key</span><span class="token punctuation">(</span>src0<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token keyword">let</span> v0 <span class="token operator">=</span> <span class="token operator">*</span>values<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>src0<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        values<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>dst<span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> v0 <span class="token operator">>></span> <span class="token operator">*</span>num<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
                <span class="token class-name">Gate</span><span class="token punctuation">::</span><span class="token class-name">Not</span><span class="token punctuation">(</span><span class="token keyword">ref</span> src0<span class="token punctuation">,</span> <span class="token keyword">ref</span> dst<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
                    <span class="token keyword">if</span> values<span class="token punctuation">.</span><span class="token function">contains_key</span><span class="token punctuation">(</span>src0<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token keyword">let</span> v0 <span class="token operator">=</span> <span class="token operator">*</span>values<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>src0<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        values<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>dst<span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">!</span>v0<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            unresolved <span class="token operator">=</span> values_prev <span class="token operator">!=</span> <span class="token operator">*</span>values<span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    values<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token attribute attr-name">#[aoc(day7, part1)]</span>
<span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">part1</span><span class="token punctuation">(</span>input<span class="token punctuation">:</span> <span class="token operator">&#x26;</span><span class="token punctuation">[</span><span class="token class-name">Gate</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token keyword">u16</span> <span class="token punctuation">{</span>
    <span class="token operator">*</span><span class="token function">solve_circuit</span><span class="token punctuation">(</span>input<span class="token punctuation">,</span> <span class="token operator">&#x26;</span><span class="token keyword">mut</span> <span class="token class-name">HashMap</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"a"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
<h2 id="part-ii">Part II<a aria-hidden="true" class="anchor-heading icon-link" href="#part-ii"></a></h2>
<p>Now, take the signal you got on wire a, override wire b to that signal, and reset the other wires (including wire a).</p>
<p>What new signal is ultimately provided to wire <code>a</code>?</p>
<h2 id="solution-1">Solution<a aria-hidden="true" class="anchor-heading icon-link" href="#solution-1"></a></h2>
<pre class="language-rust"><code class="language-rust"><span class="token attribute attr-name">#[aoc(day7, part2)]</span>
<span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">part2</span><span class="token punctuation">(</span>input<span class="token punctuation">:</span> <span class="token operator">&#x26;</span><span class="token punctuation">[</span><span class="token class-name">Gate</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token keyword">u16</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> <span class="token keyword">mut</span> map <span class="token operator">=</span> <span class="token class-name">HashMap</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    map<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>
        <span class="token string">"b"</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token operator">*</span><span class="token function">solve_circuit</span><span class="token punctuation">(</span><span class="token operator">&#x26;</span>input<span class="token punctuation">,</span> <span class="token operator">&#x26;</span><span class="token keyword">mut</span> <span class="token class-name">HashMap</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"a"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token operator">*</span><span class="token function">solve_circuit</span><span class="token punctuation">(</span><span class="token operator">&#x26;</span>input<span class="token punctuation">,</span> <span class="token operator">&#x26;</span><span class="token keyword">mut</span> map<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"a"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>