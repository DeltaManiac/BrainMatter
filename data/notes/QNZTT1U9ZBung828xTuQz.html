<h1 id="gokit">Gokit<a aria-hidden="true" class="anchor-heading icon-link" href="#gokit"></a></h1>
<h2 id="gokit-1">Gokit<a aria-hidden="true" class="anchor-heading icon-link" href="#gokit-1"></a></h2>
<p>Spring boot like framework for <a href="/notes/96Hj5nYpnUciwlTenFpoU">Go</a>. It has 3 major Components</p>
<h2 id="service-layer">Service Layer<a aria-hidden="true" class="anchor-heading icon-link" href="#service-layer"></a></h2>
<ul>
<li>Innermost layer where business logic resides.</li>
<li>Modeled as services</li>
<li>Oblivious to Endpoint/Transport Layers</li>
<li>Can be used by multiple Transports (grpc/json/http)</li>
</ul>
<h2 id="endpoint-layer">Endpoint Layer<a aria-hidden="true" class="anchor-heading icon-link" href="#endpoint-layer"></a></h2>
<ul>
<li>Represents a single RPC Method</li>
<li>Service exposed as an Endpoint</li>
<li>Endpoint can be exposed by multiple Transports</li>
</ul>
<h2 id="transport-layer">Transport Layer<a aria-hidden="true" class="anchor-heading icon-link" href="#transport-layer"></a></h2>
<ul>
<li>Exposes various Transports
<ul>
<li>grpc</li>
<li>http</li>
</ul>
</li>
</ul>
<h1 id="building-a-pastebin-clone">Building a <code>pastebin</code> clone<a aria-hidden="true" class="anchor-heading icon-link" href="#building-a-pastebin-clone"></a></h1>
<h2 id="define-a-service-blueprint-interface">Define a service blueprint interface<a aria-hidden="true" class="anchor-heading icon-link" href="#define-a-service-blueprint-interface"></a></h2>
<pre class="language-go"><code class="language-go"><span class="token comment">// PbService provides storage capabilities</span>
<span class="token keyword">type</span> PbService <span class="token keyword">interface</span> <span class="token punctuation">{</span>
	<span class="token function">Create</span><span class="token punctuation">(</span>content <span class="token builtin">string</span><span class="token punctuation">,</span> ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span>
	<span class="token function">Delete</span><span class="token punctuation">(</span>key <span class="token builtin">string</span><span class="token punctuation">,</span> ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span>
	<span class="token function">Get</span><span class="token punctuation">(</span>key <span class="token builtin">string</span><span class="token punctuation">,</span> ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
<h2 id="make-a-new-struct-to-define-the-pastebin-service">Make a new struct to define the PasteBin Service<a aria-hidden="true" class="anchor-heading icon-link" href="#make-a-new-struct-to-define-the-pastebin-service"></a></h2>
<p>This struct is used to group together the functionalities of pastebin service</p>
<pre class="language-go"><code class="language-go"><span class="token keyword">type</span> pbService <span class="token keyword">struct</span> <span class="token punctuation">{</span>
	memory <span class="token keyword">map</span><span class="token punctuation">[</span>uuid<span class="token punctuation">.</span>UUID<span class="token punctuation">]</span><span class="token builtin">string</span>
<span class="token punctuation">}</span>

<span class="token comment">// NewPbService make a new PbService</span>
<span class="token keyword">func</span> <span class="token function">NewPbService</span><span class="token punctuation">(</span><span class="token punctuation">)</span> PbService <span class="token punctuation">{</span>
	<span class="token keyword">return</span> pbService<span class="token punctuation">{</span>
		memory<span class="token punctuation">:</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">map</span><span class="token punctuation">[</span>uuid<span class="token punctuation">.</span>UUID<span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<h2 id="implement-the-pbservice-interface-on-the-struct">Implement the PbService Interface on the struct<a aria-hidden="true" class="anchor-heading icon-link" href="#implement-the-pbservice-interface-on-the-struct"></a></h2>
<p>In <a href="/notes/96Hj5nYpnUciwlTenFpoU">Go</a> we do not have a key word to define that this structs implements a specific interface like the <code>implements</code> in Java.</p>
<p>They way we enforce contracts is by implementing all the methods of the contract interface in our case here its the <code>PbService</code> interface.</p>
<p>Since our <code>NewPbService</code> method returns the type of <code>PbService</code> the go compiler will ensure that <code>NewPbService</code> confirms to the <code>PbService</code> interface.</p>
<pre class="language-go"><code class="language-go"><span class="token comment">//Create: Here we store the content and return a uuid</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>s pbService<span class="token punctuation">)</span> <span class="token function">Create</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> content <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	id <span class="token operator">:=</span> uuid<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	s<span class="token punctuation">.</span>memory<span class="token punctuation">[</span>id<span class="token punctuation">]</span> <span class="token operator">=</span> content
	<span class="token keyword">return</span> id<span class="token punctuation">.</span><span class="token function">String</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">nil</span>
<span class="token punctuation">}</span>

<span class="token comment">//Delete: Here we use the key to find and delete the content stored</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>s pbService<span class="token punctuation">)</span> <span class="token function">Delete</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> key <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	id<span class="token punctuation">,</span> err <span class="token operator">:=</span> uuid<span class="token punctuation">.</span><span class="token function">Parse</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token string">""</span><span class="token punctuation">,</span> errors<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span><span class="token string">"Invalid Uuid Format"</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	<span class="token function">delete</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span>memory<span class="token punctuation">,</span> id<span class="token punctuation">)</span>
	<span class="token keyword">return</span> <span class="token string">"ok"</span><span class="token punctuation">,</span> <span class="token boolean">nil</span>
<span class="token punctuation">}</span>

<span class="token comment">//Get: Here we use the key to find and return the content stored</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>s pbService<span class="token punctuation">)</span> <span class="token function">Get</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> key <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	id<span class="token punctuation">,</span> err <span class="token operator">:=</span> uuid<span class="token punctuation">.</span><span class="token function">Parse</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token string">""</span><span class="token punctuation">,</span> errors<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span><span class="token string">"Invalid Uuid Format"</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	content<span class="token punctuation">,</span> exists <span class="token operator">:=</span> s<span class="token punctuation">.</span>memory<span class="token punctuation">[</span>id<span class="token punctuation">]</span>
	<span class="token keyword">if</span> exists <span class="token punctuation">{</span>
		<span class="token keyword">return</span> content<span class="token punctuation">,</span> <span class="token boolean">nil</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> <span class="token string">""</span><span class="token punctuation">,</span> errors<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span><span class="token string">"Invalid Uuid"</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
<h2 id="request-and-response">Request and Response<a aria-hidden="true" class="anchor-heading icon-link" href="#request-and-response"></a></h2>
<p>In Go kit, the primary messaging pattern is RPC.</p>
<p>So, every method in our interface will be modeled as a remote procedure call. For each method, we define request and response structs, capturing all of the input and output parameters respectively.</p>
<h3 id="create-request-response">Create Request Response<a aria-hidden="true" class="anchor-heading icon-link" href="#create-request-response"></a></h3>
<pre class="language-go"><code class="language-go"><span class="token keyword">type</span> createPbRequest <span class="token keyword">struct</span> <span class="token punctuation">{</span>
	content <span class="token builtin">string</span> <span class="token string">`json:"content"`</span>
<span class="token punctuation">}</span>

<span class="token keyword">type</span> createPbResponse <span class="token keyword">struct</span> <span class="token punctuation">{</span>
	key <span class="token builtin">string</span> <span class="token string">`json:"key"`</span>
	Err <span class="token builtin">string</span> <span class="token string">`json:"err,omitempty"`</span> <span class="token comment">// errors don't JSON-marshal, so we use a string</span>
<span class="token punctuation">}</span>
</code></pre>
<h3 id="delete-request-response">Delete Request Response<a aria-hidden="true" class="anchor-heading icon-link" href="#delete-request-response"></a></h3>
<pre class="language-go"><code class="language-go"><span class="token keyword">type</span> deletePbRequest <span class="token keyword">struct</span> <span class="token punctuation">{</span>
	key <span class="token builtin">string</span> <span class="token string">`json:"key"`</span>
<span class="token punctuation">}</span>

<span class="token keyword">type</span> deletePbResponse <span class="token keyword">struct</span> <span class="token punctuation">{</span>
	status <span class="token builtin">string</span> <span class="token string">`json:"status"`</span>
	Err    <span class="token builtin">string</span> <span class="token string">`json:"err,omitempty"`</span> <span class="token comment">// errors don't JSON-marshal, so we use a string</span>
<span class="token punctuation">}</span>
</code></pre>
<h3 id="get-request-response">Get Request Response<a aria-hidden="true" class="anchor-heading icon-link" href="#get-request-response"></a></h3>
<pre class="language-go"><code class="language-go"><span class="token keyword">type</span> getPbRequest <span class="token keyword">struct</span> <span class="token punctuation">{</span>
	key <span class="token builtin">string</span> <span class="token string">`json:"key"`</span>
<span class="token punctuation">}</span>

<span class="token keyword">type</span> getPbResponse <span class="token keyword">struct</span> <span class="token punctuation">{</span>
	content <span class="token builtin">string</span> <span class="token string">`json:"content"`</span>
	Err     <span class="token builtin">string</span> <span class="token string">`json:"err,omitempty"`</span> <span class="token comment">// errors don't JSON-marshal, so we use a string</span>
<span class="token punctuation">}</span>
</code></pre>
<h2 id="define-endpoints">Define Endpoints<a aria-hidden="true" class="anchor-heading icon-link" href="#define-endpoints"></a></h2>
<p>An endpoint represents a single RPC, which is a single method in our service.</p>
<h3 id="create-endpoint">Create Endpoint<a aria-hidden="true" class="anchor-heading icon-link" href="#create-endpoint"></a></h3>
<pre class="language-go"><code class="language-go"><span class="token keyword">func</span> <span class="token function">createPbEndpoint</span><span class="token punctuation">(</span>svc PbService<span class="token punctuation">)</span> endpoint<span class="token punctuation">.</span>Endpoint <span class="token punctuation">{</span>
	<span class="token keyword">return</span> <span class="token keyword">func</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> request <span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		req <span class="token operator">:=</span> request<span class="token punctuation">.</span><span class="token punctuation">(</span>createPbRequest<span class="token punctuation">)</span>
		key<span class="token punctuation">,</span> err <span class="token operator">:=</span> svc<span class="token punctuation">.</span><span class="token function">Create</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> req<span class="token punctuation">.</span>Content<span class="token punctuation">)</span>
		<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
			<span class="token keyword">return</span> createPbResponse<span class="token punctuation">{</span>key<span class="token punctuation">,</span> err<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">nil</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">return</span> createPbResponse<span class="token punctuation">{</span>key<span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">nil</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<h3 id="delete-endpoint">Delete Endpoint<a aria-hidden="true" class="anchor-heading icon-link" href="#delete-endpoint"></a></h3>
<pre class="language-go"><code class="language-go"><span class="token keyword">func</span> <span class="token function">deletePbEndpoint</span><span class="token punctuation">(</span>svc PbService<span class="token punctuation">)</span> endpoint<span class="token punctuation">.</span>Endpoint <span class="token punctuation">{</span>
	<span class="token keyword">return</span> <span class="token keyword">func</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> request <span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		req <span class="token operator">:=</span> request<span class="token punctuation">.</span><span class="token punctuation">(</span>deletePbRequest<span class="token punctuation">)</span>
		status<span class="token punctuation">,</span> err <span class="token operator">:=</span> svc<span class="token punctuation">.</span><span class="token function">Delete</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> req<span class="token punctuation">.</span>Key<span class="token punctuation">)</span>
		<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
			<span class="token keyword">return</span> deletePbResponse<span class="token punctuation">{</span>status<span class="token punctuation">,</span> err<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">nil</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">return</span> deletePbResponse<span class="token punctuation">{</span>status<span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">nil</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<h3 id="get-endpoint">Get Endpoint<a aria-hidden="true" class="anchor-heading icon-link" href="#get-endpoint"></a></h3>
<pre class="language-go"><code class="language-go"><span class="token keyword">func</span> <span class="token function">getPbEndpoint</span><span class="token punctuation">(</span>svc PbService<span class="token punctuation">)</span> endpoint<span class="token punctuation">.</span>Endpoint <span class="token punctuation">{</span>
	<span class="token keyword">return</span> <span class="token keyword">func</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> request <span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		req <span class="token operator">:=</span> request<span class="token punctuation">.</span><span class="token punctuation">(</span>getPbRequest<span class="token punctuation">)</span>
		content<span class="token punctuation">,</span> err <span class="token operator">:=</span> svc<span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> req<span class="token punctuation">.</span>Key<span class="token punctuation">)</span>
		<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
			<span class="token keyword">return</span> getPbResponse<span class="token punctuation">{</span>content<span class="token punctuation">,</span> err<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">nil</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">return</span> getPbResponse<span class="token punctuation">{</span>content<span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">nil</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<h2 id="define-transport">Define Transport<a aria-hidden="true" class="anchor-heading icon-link" href="#define-transport"></a></h2>
<p>Since this trivial example used JSON over HTTP we would have to decode the JSON to structs that our service can understand</p>
<h3 id="create-requester-decoder">Create Requester Decoder<a aria-hidden="true" class="anchor-heading icon-link" href="#create-requester-decoder"></a></h3>
<pre class="language-go"><code class="language-go"><span class="token keyword">func</span> <span class="token function">decodeCreatePbRequest</span><span class="token punctuation">(</span><span class="token boolean">_</span> context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> r <span class="token operator">*</span>http<span class="token punctuation">.</span>Request<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">var</span> request createPbRequest
	<span class="token keyword">if</span> err <span class="token operator">:=</span> json<span class="token punctuation">.</span><span class="token function">NewDecoder</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>Body<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Decode</span><span class="token punctuation">(</span><span class="token operator">&#x26;</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> err
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> request<span class="token punctuation">,</span> <span class="token boolean">nil</span>
<span class="token punctuation">}</span>
</code></pre>
<h3 id="delete-request-decoder">Delete Request Decoder<a aria-hidden="true" class="anchor-heading icon-link" href="#delete-request-decoder"></a></h3>
<pre class="language-go"><code class="language-go"><span class="token keyword">func</span> <span class="token function">decodeDeletePbRequest</span><span class="token punctuation">(</span><span class="token boolean">_</span> context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> r <span class="token operator">*</span>http<span class="token punctuation">.</span>Request<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">var</span> request deletePbRequest
	<span class="token keyword">if</span> err <span class="token operator">:=</span> json<span class="token punctuation">.</span><span class="token function">NewDecoder</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>Body<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Decode</span><span class="token punctuation">(</span><span class="token operator">&#x26;</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> err
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> request<span class="token punctuation">,</span> <span class="token boolean">nil</span>
<span class="token punctuation">}</span>
</code></pre>
<h3 id="get-request-decoder">Get Request Decoder<a aria-hidden="true" class="anchor-heading icon-link" href="#get-request-decoder"></a></h3>
<pre class="language-go"><code class="language-go"><span class="token keyword">func</span> <span class="token function">decodeGetPbRequest</span><span class="token punctuation">(</span><span class="token boolean">_</span> context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> r <span class="token operator">*</span>http<span class="token punctuation">.</span>Request<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">var</span> request getPbRequest
	<span class="token keyword">if</span> err <span class="token operator">:=</span> json<span class="token punctuation">.</span><span class="token function">NewDecoder</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>Body<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Decode</span><span class="token punctuation">(</span><span class="token operator">&#x26;</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> err
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> request<span class="token punctuation">,</span> <span class="token boolean">nil</span>
<span class="token punctuation">}</span>
</code></pre>
<h3 id="response-encoder">Response Encoder<a aria-hidden="true" class="anchor-heading icon-link" href="#response-encoder"></a></h3>
<p>This method would accept an <code>interface</code> type and convert it JSON, this allows it to accept <code>createPbResponse</code>,<code>deletePbResponse</code>,<code>getPbResponse</code> as an <code>interface{}</code> and encode it as json using the annotations in the struct definition.</p>
<pre class="language-go"><code class="language-go"><span class="token keyword">func</span> <span class="token function">encodeResponse</span><span class="token punctuation">(</span><span class="token boolean">_</span> context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> w http<span class="token punctuation">.</span>ResponseWriter<span class="token punctuation">,</span> response <span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{</span>
	<span class="token keyword">return</span> json<span class="token punctuation">.</span><span class="token function">NewEncoder</span><span class="token punctuation">(</span>w<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Encode</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
<h2 id="main">Main<a aria-hidden="true" class="anchor-heading icon-link" href="#main"></a></h2>
<pre class="language-go"><code class="language-go"><span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token string">"context"</span>
	<span class="token string">"encoding/json"</span>
	<span class="token string">"errors"</span>
	<span class="token string">"log"</span>
	<span class="token string">"net/http"</span>

	<span class="token string">"github.com/go-kit/kit/endpoint"</span>
	<span class="token string">"github.com/google/uuid"</span>

	httptransport <span class="token string">"github.com/go-kit/kit/transport/http"</span>
<span class="token punctuation">)</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	svc <span class="token operator">:=</span> <span class="token function">NewPbService</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	createPbHandler <span class="token operator">:=</span> httptransport<span class="token punctuation">.</span><span class="token function">NewServer</span><span class="token punctuation">(</span>
		<span class="token function">createPbEndpoint</span><span class="token punctuation">(</span>svc<span class="token punctuation">)</span><span class="token punctuation">,</span>
		decodeCreatePbRequest<span class="token punctuation">,</span>
		encodeResponse<span class="token punctuation">,</span>
	<span class="token punctuation">)</span>

	deletePbHandler <span class="token operator">:=</span> httptransport<span class="token punctuation">.</span><span class="token function">NewServer</span><span class="token punctuation">(</span>
		<span class="token function">deletePbEndpoint</span><span class="token punctuation">(</span>svc<span class="token punctuation">)</span><span class="token punctuation">,</span>
		decodeDeletePbRequest<span class="token punctuation">,</span>
		encodeResponse<span class="token punctuation">,</span>
	<span class="token punctuation">)</span>

	getPbHandler <span class="token operator">:=</span> httptransport<span class="token punctuation">.</span><span class="token function">NewServer</span><span class="token punctuation">(</span>
		<span class="token function">getPbEndpoint</span><span class="token punctuation">(</span>svc<span class="token punctuation">)</span><span class="token punctuation">,</span>
		decodeGetPbRequest<span class="token punctuation">,</span>
		encodeResponse<span class="token punctuation">,</span>
	<span class="token punctuation">)</span>

	http<span class="token punctuation">.</span><span class="token function">Handle</span><span class="token punctuation">(</span><span class="token string">"/create"</span><span class="token punctuation">,</span> createPbHandler<span class="token punctuation">)</span>
	http<span class="token punctuation">.</span><span class="token function">Handle</span><span class="token punctuation">(</span><span class="token string">"/delete"</span><span class="token punctuation">,</span> deletePbHandler<span class="token punctuation">)</span>
	http<span class="token punctuation">.</span><span class="token function">Handle</span><span class="token punctuation">(</span><span class="token string">"/get"</span><span class="token punctuation">,</span> getPbHandler<span class="token punctuation">)</span>
	log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span>http<span class="token punctuation">.</span><span class="token function">ListenAndServe</span><span class="token punctuation">(</span><span class="token string">":8080"</span><span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
<h2 id="divide-and-conquer">Divide and Conquer<a aria-hidden="true" class="anchor-heading icon-link" href="#divide-and-conquer"></a></h2>
<p>At this point the <code>main.go</code> has a lot of code so lets move to different files so that we have separation of concerns.</p>
<h3 id="servicego"><code>service.go</code><a aria-hidden="true" class="anchor-heading icon-link" href="#servicego"></a></h3>
<pre class="language-go"><code class="language-go"><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token string">"context"</span>
	<span class="token string">"errors"</span>

	<span class="token string">"github.com/google/uuid"</span>
<span class="token punctuation">)</span>

<span class="token comment">// PbService provides storage capabilities</span>
<span class="token keyword">type</span> PbService <span class="token keyword">interface</span> <span class="token punctuation">{</span>
	<span class="token function">Create</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> content <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span>
	<span class="token function">Delete</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> key <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span>
	<span class="token function">Get</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> key <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">type</span> pbService <span class="token keyword">struct</span> <span class="token punctuation">{</span>
	memory <span class="token keyword">map</span><span class="token punctuation">[</span>uuid<span class="token punctuation">.</span>UUID<span class="token punctuation">]</span><span class="token builtin">string</span>
<span class="token punctuation">}</span>

<span class="token comment">// NewPbService make a new PbService</span>
<span class="token keyword">func</span> <span class="token function">NewPbService</span><span class="token punctuation">(</span><span class="token punctuation">)</span> PbService <span class="token punctuation">{</span>
	<span class="token keyword">return</span> pbService<span class="token punctuation">{</span>
		memory<span class="token punctuation">:</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">map</span><span class="token punctuation">[</span>uuid<span class="token punctuation">.</span>UUID<span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">//Create: Here we store the content and return a uuid</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>s pbService<span class="token punctuation">)</span> <span class="token function">Create</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> content <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	id <span class="token operator">:=</span> uuid<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	s<span class="token punctuation">.</span>memory<span class="token punctuation">[</span>id<span class="token punctuation">]</span> <span class="token operator">=</span> content
	<span class="token keyword">return</span> id<span class="token punctuation">.</span><span class="token function">String</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">nil</span>
<span class="token punctuation">}</span>

<span class="token comment">//Get: Here we use the key to find and return the content stored</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>s pbService<span class="token punctuation">)</span> <span class="token function">Get</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> key <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	id<span class="token punctuation">,</span> err <span class="token operator">:=</span> uuid<span class="token punctuation">.</span><span class="token function">Parse</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token string">""</span><span class="token punctuation">,</span> errors<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span><span class="token string">"Invalid Uuid Format"</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	content<span class="token punctuation">,</span> exists <span class="token operator">:=</span> s<span class="token punctuation">.</span>memory<span class="token punctuation">[</span>id<span class="token punctuation">]</span>
	<span class="token keyword">if</span> exists <span class="token punctuation">{</span>
		<span class="token keyword">return</span> content<span class="token punctuation">,</span> <span class="token boolean">nil</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> <span class="token string">""</span><span class="token punctuation">,</span> errors<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span><span class="token string">"Invalid Uuid"</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">//Delete: Here we use the key to find and delete the content stored</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>s pbService<span class="token punctuation">)</span> <span class="token function">Delete</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> key <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	id<span class="token punctuation">,</span> err <span class="token operator">:=</span> uuid<span class="token punctuation">.</span><span class="token function">Parse</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token string">""</span><span class="token punctuation">,</span> errors<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span><span class="token string">"Invalid Uuid Format"</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	<span class="token function">delete</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span>memory<span class="token punctuation">,</span> id<span class="token punctuation">)</span>
	<span class="token keyword">return</span> <span class="token string">"ok"</span><span class="token punctuation">,</span> <span class="token boolean">nil</span>
<span class="token punctuation">}</span>
</code></pre>
<h3 id="transportgo"><code>transport.go</code><a aria-hidden="true" class="anchor-heading icon-link" href="#transportgo"></a></h3>
<pre class="language-go"><code class="language-go"><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token string">"context"</span>
	<span class="token string">"encoding/json"</span>
	<span class="token string">"net/http"</span>

	<span class="token string">"github.com/go-kit/kit/endpoint"</span>
<span class="token punctuation">)</span>

<span class="token keyword">type</span> createPbRequest <span class="token keyword">struct</span> <span class="token punctuation">{</span>
	Content <span class="token builtin">string</span> <span class="token string">`json:"content"`</span>
<span class="token punctuation">}</span>

<span class="token keyword">type</span> createPbResponse <span class="token keyword">struct</span> <span class="token punctuation">{</span>
	Key <span class="token builtin">string</span> <span class="token string">`json:"key"`</span>
	Err <span class="token builtin">string</span> <span class="token string">`json:"err,omitempty"`</span> <span class="token comment">// errors don't JSON-marshal, so we use a string</span>
<span class="token punctuation">}</span>

<span class="token keyword">type</span> getPbRequest <span class="token keyword">struct</span> <span class="token punctuation">{</span>
	Key <span class="token builtin">string</span> <span class="token string">`json:"key"`</span>
<span class="token punctuation">}</span>

<span class="token keyword">type</span> getPbResponse <span class="token keyword">struct</span> <span class="token punctuation">{</span>
	Content <span class="token builtin">string</span> <span class="token string">`json:"content"`</span>
	Err     <span class="token builtin">string</span> <span class="token string">`json:"err,omitempty"`</span> <span class="token comment">// errors don't JSON-marshal, so we use a string</span>
<span class="token punctuation">}</span>

<span class="token keyword">type</span> deletePbRequest <span class="token keyword">struct</span> <span class="token punctuation">{</span>
	Key <span class="token builtin">string</span> <span class="token string">`json:"key"`</span>
<span class="token punctuation">}</span>

<span class="token keyword">type</span> deletePbResponse <span class="token keyword">struct</span> <span class="token punctuation">{</span>
	Status <span class="token builtin">string</span> <span class="token string">`json:"status"`</span>
	Err    <span class="token builtin">string</span> <span class="token string">`json:"err,omitempty"`</span> <span class="token comment">// errors don't JSON-marshal, so we use a string</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">createPbEndpoint</span><span class="token punctuation">(</span>svc PbService<span class="token punctuation">)</span> endpoint<span class="token punctuation">.</span>Endpoint <span class="token punctuation">{</span>
	<span class="token keyword">return</span> <span class="token keyword">func</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> request <span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		req <span class="token operator">:=</span> request<span class="token punctuation">.</span><span class="token punctuation">(</span>createPbRequest<span class="token punctuation">)</span>
		key<span class="token punctuation">,</span> err <span class="token operator">:=</span> svc<span class="token punctuation">.</span><span class="token function">Create</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> req<span class="token punctuation">.</span>Content<span class="token punctuation">)</span>
		<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
			<span class="token keyword">return</span> createPbResponse<span class="token punctuation">{</span>key<span class="token punctuation">,</span> err<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">nil</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">return</span> createPbResponse<span class="token punctuation">{</span>key<span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">nil</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">deletePbEndpoint</span><span class="token punctuation">(</span>svc PbService<span class="token punctuation">)</span> endpoint<span class="token punctuation">.</span>Endpoint <span class="token punctuation">{</span>
	<span class="token keyword">return</span> <span class="token keyword">func</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> request <span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		req <span class="token operator">:=</span> request<span class="token punctuation">.</span><span class="token punctuation">(</span>deletePbRequest<span class="token punctuation">)</span>
		status<span class="token punctuation">,</span> err <span class="token operator">:=</span> svc<span class="token punctuation">.</span><span class="token function">Delete</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> req<span class="token punctuation">.</span>Key<span class="token punctuation">)</span>
		<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
			<span class="token keyword">return</span> deletePbResponse<span class="token punctuation">{</span>status<span class="token punctuation">,</span> err<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">nil</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">return</span> deletePbResponse<span class="token punctuation">{</span>status<span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">nil</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">getPbEndpoint</span><span class="token punctuation">(</span>svc PbService<span class="token punctuation">)</span> endpoint<span class="token punctuation">.</span>Endpoint <span class="token punctuation">{</span>
	<span class="token keyword">return</span> <span class="token keyword">func</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> request <span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		req <span class="token operator">:=</span> request<span class="token punctuation">.</span><span class="token punctuation">(</span>getPbRequest<span class="token punctuation">)</span>
		content<span class="token punctuation">,</span> err <span class="token operator">:=</span> svc<span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> req<span class="token punctuation">.</span>Key<span class="token punctuation">)</span>
		<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
			<span class="token keyword">return</span> getPbResponse<span class="token punctuation">{</span>content<span class="token punctuation">,</span> err<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">nil</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">return</span> getPbResponse<span class="token punctuation">{</span>content<span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">nil</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">decodeCreatePbRequest</span><span class="token punctuation">(</span><span class="token boolean">_</span> context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> r <span class="token operator">*</span>http<span class="token punctuation">.</span>Request<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">var</span> request createPbRequest
	<span class="token keyword">if</span> err <span class="token operator">:=</span> json<span class="token punctuation">.</span><span class="token function">NewDecoder</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>Body<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Decode</span><span class="token punctuation">(</span><span class="token operator">&#x26;</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> err
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> request<span class="token punctuation">,</span> <span class="token boolean">nil</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">decodeGetPbRequest</span><span class="token punctuation">(</span><span class="token boolean">_</span> context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> r <span class="token operator">*</span>http<span class="token punctuation">.</span>Request<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">var</span> request getPbRequest
	<span class="token keyword">if</span> err <span class="token operator">:=</span> json<span class="token punctuation">.</span><span class="token function">NewDecoder</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>Body<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Decode</span><span class="token punctuation">(</span><span class="token operator">&#x26;</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> err
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> request<span class="token punctuation">,</span> <span class="token boolean">nil</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">decodeDeletePbRequest</span><span class="token punctuation">(</span><span class="token boolean">_</span> context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> r <span class="token operator">*</span>http<span class="token punctuation">.</span>Request<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">var</span> request deletePbRequest
	<span class="token keyword">if</span> err <span class="token operator">:=</span> json<span class="token punctuation">.</span><span class="token function">NewDecoder</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>Body<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Decode</span><span class="token punctuation">(</span><span class="token operator">&#x26;</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> err
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> request<span class="token punctuation">,</span> <span class="token boolean">nil</span>
<span class="token punctuation">}</span>
</code></pre>
<h3 id="maingo"><code>main.go</code><a aria-hidden="true" class="anchor-heading icon-link" href="#maingo"></a></h3>
<pre class="language-go"><code class="language-go"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	svc <span class="token operator">:=</span> <span class="token function">NewPbService</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	createPbHandler <span class="token operator">:=</span> httptransport<span class="token punctuation">.</span><span class="token function">NewServer</span><span class="token punctuation">(</span>
		<span class="token function">createPbEndpoint</span><span class="token punctuation">(</span>svc<span class="token punctuation">)</span><span class="token punctuation">,</span>
		decodeCreatePbRequest<span class="token punctuation">,</span>
		encodeResponse<span class="token punctuation">,</span>
	<span class="token punctuation">)</span>

	deletePbHandler <span class="token operator">:=</span> httptransport<span class="token punctuation">.</span><span class="token function">NewServer</span><span class="token punctuation">(</span>
		<span class="token function">deletePbEndpoint</span><span class="token punctuation">(</span>svc<span class="token punctuation">)</span><span class="token punctuation">,</span>
		decodeDeletePbRequest<span class="token punctuation">,</span>
		encodeResponse<span class="token punctuation">,</span>
	<span class="token punctuation">)</span>
	getPbHandler <span class="token operator">:=</span> httptransport<span class="token punctuation">.</span><span class="token function">NewServer</span><span class="token punctuation">(</span>
		<span class="token function">getPbEndpoint</span><span class="token punctuation">(</span>svc<span class="token punctuation">)</span><span class="token punctuation">,</span>
		decodeGetPbRequest<span class="token punctuation">,</span>
		encodeResponse<span class="token punctuation">,</span>
	<span class="token punctuation">)</span>
	http<span class="token punctuation">.</span><span class="token function">Handle</span><span class="token punctuation">(</span><span class="token string">"/create"</span><span class="token punctuation">,</span> createPbHandler<span class="token punctuation">)</span>
	http<span class="token punctuation">.</span><span class="token function">Handle</span><span class="token punctuation">(</span><span class="token string">"/delete"</span><span class="token punctuation">,</span> deletePbHandler<span class="token punctuation">)</span>
	http<span class="token punctuation">.</span><span class="token function">Handle</span><span class="token punctuation">(</span><span class="token string">"/get"</span><span class="token punctuation">,</span> getPbHandler<span class="token punctuation">)</span>
	log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span>http<span class="token punctuation">.</span><span class="token function">ListenAndServe</span><span class="token punctuation">(</span><span class="token string">":8080"</span><span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
<h2 id="logging-middleware">Logging Middleware<a aria-hidden="true" class="anchor-heading icon-link" href="#logging-middleware"></a></h2>
<p>All applications need to log information, this can be enabled by adding a logging middleware that we create in a file called <code>logging.go</code></p>
<p>Middleware in go-kit work on <code>Endpoint</code></p>
<p>The interface definition is <code>type Middleware func(Endpoint) Endpoint</code>, which means it is a function that takes in an endpoint and returns an endpoint</p>
<p>We can create the <code>loggingMiddleware</code> so that it adheres to the <code>PbService</code> by implementing the <code>Create</code> <code>Delete</code> <code>Get</code> methods.</p>
<pre class="language-go"><code class="language-go"><span class="token keyword">type</span> loggingMiddleware <span class="token keyword">struct</span> <span class="token punctuation">{</span>
	logger log<span class="token punctuation">.</span>Logger
	next   PbService
<span class="token punctuation">}</span>
</code></pre>
<h3 id="create">Create<a aria-hidden="true" class="anchor-heading icon-link" href="#create"></a></h3>
<pre class="language-go"><code class="language-go"><span class="token keyword">func</span> <span class="token punctuation">(</span>m loggingMiddleware<span class="token punctuation">)</span> <span class="token function">Create</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> content <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>output <span class="token builtin">string</span><span class="token punctuation">,</span> err <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">// This defered function would be invoked just before the retuen statement</span>
	<span class="token keyword">defer</span> <span class="token keyword">func</span><span class="token punctuation">(</span>begin time<span class="token punctuation">.</span>Time<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		m<span class="token punctuation">.</span>logger<span class="token punctuation">.</span><span class="token function">Log</span><span class="token punctuation">(</span>
			<span class="token string">"method"</span><span class="token punctuation">,</span> <span class="token string">"CreatePb"</span><span class="token punctuation">,</span>
			<span class="token string">"input"</span><span class="token punctuation">,</span> content<span class="token punctuation">,</span>
			<span class="token string">"output"</span><span class="token punctuation">,</span> output<span class="token punctuation">,</span>
			<span class="token string">"err"</span><span class="token punctuation">,</span> err<span class="token punctuation">,</span>
			<span class="token string">"took"</span><span class="token punctuation">,</span> time<span class="token punctuation">.</span><span class="token function">Since</span><span class="token punctuation">(</span>begin<span class="token punctuation">)</span><span class="token punctuation">,</span>
		<span class="token punctuation">)</span>
	<span class="token punctuation">}</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	output<span class="token punctuation">,</span> err <span class="token operator">=</span> m<span class="token punctuation">.</span>next<span class="token punctuation">.</span><span class="token function">Create</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> content<span class="token punctuation">)</span>
	<span class="token keyword">return</span>
<span class="token punctuation">}</span>
</code></pre>
<h3 id="delete">Delete<a aria-hidden="true" class="anchor-heading icon-link" href="#delete"></a></h3>
<pre class="language-go"><code class="language-go"> <span class="token keyword">func</span> <span class="token punctuation">(</span>m loggingMiddleware<span class="token punctuation">)</span> <span class="token function">Delete</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> key <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>output <span class="token builtin">string</span><span class="token punctuation">,</span> err <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">defer</span> <span class="token keyword">func</span><span class="token punctuation">(</span>begin time<span class="token punctuation">.</span>Time<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		m<span class="token punctuation">.</span>logger<span class="token punctuation">.</span><span class="token function">Log</span><span class="token punctuation">(</span>
			<span class="token string">"method"</span><span class="token punctuation">,</span> <span class="token string">"DeletePb"</span><span class="token punctuation">,</span>
			<span class="token string">"input"</span><span class="token punctuation">,</span> key<span class="token punctuation">,</span>
			<span class="token string">"output"</span><span class="token punctuation">,</span> output<span class="token punctuation">,</span>
			<span class="token string">"err"</span><span class="token punctuation">,</span> err<span class="token punctuation">,</span>
			<span class="token string">"took"</span><span class="token punctuation">,</span> time<span class="token punctuation">.</span><span class="token function">Since</span><span class="token punctuation">(</span>begin<span class="token punctuation">)</span><span class="token punctuation">,</span>
		<span class="token punctuation">)</span>
	<span class="token punctuation">}</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	output<span class="token punctuation">,</span> err <span class="token operator">=</span> m<span class="token punctuation">.</span>next<span class="token punctuation">.</span><span class="token function">Delete</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> key<span class="token punctuation">)</span>
	<span class="token keyword">return</span>
<span class="token punctuation">}</span>
</code></pre>
<h3 id="get">Get<a aria-hidden="true" class="anchor-heading icon-link" href="#get"></a></h3>
<pre class="language-go"><code class="language-go"><span class="token keyword">func</span> <span class="token punctuation">(</span>m loggingMiddleware<span class="token punctuation">)</span> <span class="token function">Get</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> key <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>output <span class="token builtin">string</span><span class="token punctuation">,</span> err <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">defer</span> <span class="token keyword">func</span><span class="token punctuation">(</span>begin time<span class="token punctuation">.</span>Time<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		m<span class="token punctuation">.</span>logger<span class="token punctuation">.</span><span class="token function">Log</span><span class="token punctuation">(</span>
			<span class="token string">"method"</span><span class="token punctuation">,</span> <span class="token string">"GetPb"</span><span class="token punctuation">,</span>
			<span class="token string">"input"</span><span class="token punctuation">,</span> key<span class="token punctuation">,</span>
			<span class="token string">"output"</span><span class="token punctuation">,</span> output<span class="token punctuation">,</span>
			<span class="token string">"err"</span><span class="token punctuation">,</span> err<span class="token punctuation">,</span>
			<span class="token string">"took"</span><span class="token punctuation">,</span> time<span class="token punctuation">.</span><span class="token function">Since</span><span class="token punctuation">(</span>begin<span class="token punctuation">)</span><span class="token punctuation">,</span>
		<span class="token punctuation">)</span>
	<span class="token punctuation">}</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	output<span class="token punctuation">,</span> err <span class="token operator">=</span> m<span class="token punctuation">.</span>next<span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> key<span class="token punctuation">)</span>
	<span class="token keyword">return</span>
<span class="token punctuation">}</span>
</code></pre>
<h2 id="wiring-the-middleware">Wiring the Middleware<a aria-hidden="true" class="anchor-heading icon-link" href="#wiring-the-middleware"></a></h2>
<p>In order to wire the middleware in all we have to do is link it up with the service that we have defined</p>
<pre class="language-go"><code class="language-go"><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token string">"context"</span>
	<span class="token string">"encoding/json"</span>
	<span class="token string">"net/http"</span>
	<span class="token string">"os"</span>

	<span class="token string">"github.com/go-kit/kit/log"</span>

	httptransport <span class="token string">"github.com/go-kit/kit/transport/http"</span>
<span class="token punctuation">)</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">// Use the global logger</span>
	logger <span class="token operator">:=</span> log<span class="token punctuation">.</span><span class="token function">NewLogfmtLogger</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>Stderr<span class="token punctuation">)</span>
	<span class="token keyword">var</span> svc PbService
	svc <span class="token operator">=</span> <span class="token function">NewPbService</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token comment">// Wire the middleware and thats it</span>
	svc <span class="token operator">=</span> loggingMiddleware<span class="token punctuation">{</span>logger<span class="token punctuation">,</span> svc<span class="token punctuation">}</span>

	createPbHandler <span class="token operator">:=</span> httptransport<span class="token punctuation">.</span><span class="token function">NewServer</span><span class="token punctuation">(</span>
		<span class="token function">createPbEndpoint</span><span class="token punctuation">(</span>svc<span class="token punctuation">)</span><span class="token punctuation">,</span>
		decodeCreatePbRequest<span class="token punctuation">,</span>
		encodeResponse<span class="token punctuation">,</span>
	<span class="token punctuation">)</span>

	deletePbHandler <span class="token operator">:=</span> httptransport<span class="token punctuation">.</span><span class="token function">NewServer</span><span class="token punctuation">(</span>
		<span class="token function">deletePbEndpoint</span><span class="token punctuation">(</span>svc<span class="token punctuation">)</span><span class="token punctuation">,</span>
		decodeDeletePbRequest<span class="token punctuation">,</span>
		encodeResponse<span class="token punctuation">,</span>
	<span class="token punctuation">)</span>

	getPbHandler <span class="token operator">:=</span> httptransport<span class="token punctuation">.</span><span class="token function">NewServer</span><span class="token punctuation">(</span>
		<span class="token function">getPbEndpoint</span><span class="token punctuation">(</span>svc<span class="token punctuation">)</span><span class="token punctuation">,</span>
		decodeGetPbRequest<span class="token punctuation">,</span>
		encodeResponse<span class="token punctuation">,</span>
	<span class="token punctuation">)</span>
	http<span class="token punctuation">.</span><span class="token function">Handle</span><span class="token punctuation">(</span><span class="token string">"/create"</span><span class="token punctuation">,</span> createPbHandler<span class="token punctuation">)</span>
	http<span class="token punctuation">.</span><span class="token function">Handle</span><span class="token punctuation">(</span><span class="token string">"/delete"</span><span class="token punctuation">,</span> deletePbHandler<span class="token punctuation">)</span>
	http<span class="token punctuation">.</span><span class="token function">Handle</span><span class="token punctuation">(</span><span class="token string">"/get"</span><span class="token punctuation">,</span> getPbHandler<span class="token punctuation">)</span>
	logger<span class="token punctuation">.</span><span class="token function">Log</span><span class="token punctuation">(</span><span class="token string">"msg"</span><span class="token punctuation">,</span> <span class="token string">"HTTP"</span><span class="token punctuation">,</span> <span class="token string">"addr"</span><span class="token punctuation">,</span> <span class="token string">":8080"</span><span class="token punctuation">)</span>
	logger<span class="token punctuation">.</span><span class="token function">Log</span><span class="token punctuation">(</span><span class="token string">"err"</span><span class="token punctuation">,</span> http<span class="token punctuation">.</span><span class="token function">ListenAndServe</span><span class="token punctuation">(</span><span class="token string">":8080"</span><span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">encodeResponse</span><span class="token punctuation">(</span><span class="token boolean">_</span> context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> w http<span class="token punctuation">.</span>ResponseWriter<span class="token punctuation">,</span> response <span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{</span>
	<span class="token keyword">return</span> json<span class="token punctuation">.</span><span class="token function">NewEncoder</span><span class="token punctuation">(</span>w<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Encode</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
<h2 id="pastebin">PasteBin<a aria-hidden="true" class="anchor-heading icon-link" href="#pastebin"></a></h2>
<h3 id="client">Client<a aria-hidden="true" class="anchor-heading icon-link" href="#client"></a></h3>
<pre class="language-sh"><code class="language-sh">
$ curl localhost:8080/create -XPOST -d '{"content":"THIS IS SPARTA"}'

{"key":"c449250a-d74c-4d23-acbb-6785b0bd822a"}

$ curl localhost:8080/get -XPOST -d '{"key":"c449250a-d74c-4d23-acbb-6785b0bd822a"}'

{"content":"THIS IS SPARTA"}

$ curl localhost:8I00/delete -XPOST -d '{"key":"c449250a-d74c-4d23-acbb-6785b0bd822a"}'

{"status":"ok"}

$ curl localhost:8080/get -XPOST -d '{"key":"c449250a-d74c-4d23-acbb-6785b0bd822a"}'

{"content":"","err":"Invalid Uuid"}

</code></pre>
<h3 id="server">Server<a aria-hidden="true" class="anchor-heading icon-link" href="#server"></a></h3>
<pre class="language-sh"><code class="language-sh">$ ./pastebin-II

msg=HTTP addr=:8080

method=CreatePb input="THIS IS SPARTA" output=c449250a-d74c-4d23-acbb-6785b0bd822a err=null took=67.92µs

method=GetPb input=c449250a-d74c-4d23-acbb-6785b0bd822a output="THIS IS SPARTA" err=null took=1.675µs

method=DeletePb input=c449250a-d74c-4d23-acbb-6785b0bd822a output=ok err=null took=1.45µs

method=GetPb input=c449250a-d74c-4d23-acbb-6785b0bd822a output= err="Invalid Uuid" took=803ns
</code></pre>