<h1 id="reliable-tcp-streams">Reliable TCP Streams<a aria-hidden="true" class="anchor-heading icon-link" href="#reliable-tcp-streams"></a></h1>
<h1 id="tcp">TCP<a aria-hidden="true" class="anchor-heading icon-link" href="#tcp"></a></h1>
<p><strong>Packet Loss</strong>: Occurs when data fails to reach its destination</p>
<p><strong>Network Congestion</strong>: Occurs when nodes attempt to send more data over a network connections than the connection can handle which causes nodes to discard the excess packets</p>
<p><strong>Flow Control</strong>: Adaptation of transfer rate to make sure it transmits data as fast as possible while keeping dropped packets to a minimum</p>
<h3 id="tcp-session">TCP Session<a aria-hidden="true" class="anchor-heading icon-link" href="#tcp-session"></a></h3>
<p>Established with a three-way handshake</p>
<pre>
                   CLIENT                      SERVER
               Dial  |                           | Listen
                     |                           |
                     | ----------SYN-----------> |
                     |                           | Accept
                     | &#x3C;-------SYN/ACK---------- |
        Established  |                           |
                     | ----------ACK-----------> | Established

</pre>
<h3 id="handshake">Handshake<a aria-hidden="true" class="anchor-heading icon-link" href="#handshake"></a></h3>
<ol>
<li>
<p>Client sends a packet with the synchronize(SYN) flag to the server which contains client's capabilities and preferred window settings</p>
</li>
<li>
<p>Server responds with both the acknowledgement(ACK) and SYN flag set in the packet</p>
</li>
<li>
<p>Client responds with ac ACK packet to acknowledge the server's SYN packet.</p>
</li>
</ol>
<h4 id="acknowledging-receipt-of-packets-by-using-sequence-number">Acknowledging Receipt of Packets by using Sequence Number<a aria-hidden="true" class="anchor-heading icon-link" href="#acknowledging-receipt-of-packets-by-using-sequence-number"></a></h4>
<pre>
                 CLIENT                             SERVER
                    |        SYN (Seq = X)            |
                    |-------------------------------->|
                    |                                 | Received
                    |        SYN (Seq = Y)            | Client Seq = X
                    |&#x3C;--------------------------------|
           Received |        ACK (Seq = X+1)          |
     Server Seq = Y |                                 |
                    |-------------------------------->|
                    |        ACK (Seq = Y+1)          |
                    |                                 |
</pre>
<p>Sequence number is determined by the sender of the message</p>
<h4 id="receive-buffers-and-windows-sizes">Receive Buffers and Windows Sizes<a aria-hidden="true" class="anchor-heading icon-link" href="#receive-buffers-and-windows-sizes"></a></h4>
<p>TCP allows a single ACK packet to acknowledge the receipt of more than one incoming packet.</p>
<p>Receiver must advertise to the sender how much space it have available in its receive buffer before it sends an acknowledgment</p>
<p><strong>Receive Buffer</strong>: per connection block of memory reserved for incoming data on a network connection</p>
<p><strong>Window Size</strong>: Information in the ACK packet which is the number of bytes the sender can transmit to the receiver without requiring an acknowledgement</p>
<pre>              Client                         Server
                |                               |
                |   ACK (Window size = 3072)    |
Acknowledging   |------------------------------>| Client can Receive 3072 bytes
data            |                               |
                |                               |
                |         (1024 bytes)          |
                |&#x3C;------------------------------|
                |                               |
                |         (1024 bytes)          |
                |&#x3C;------------------------------|
                |                               |
                |         (1024 bytes)          |
Buffer full     |&#x3C;------------------------------|
with 3072 bytes |                               |
                |                               |
                |   ACK (Window size = 2048)    |
Acknowledging   |------------------------------>| Client can Receive 2048 bytes
data            |                               |
                |         (1024 bytes)          |
                |&#x3C;------------------------------|
                |                               |
                |         (1024 bytes)          |
Buffer full     |&#x3C;------------------------------|
with 2048 bytes |                               |
</pre>
<h3 id="termination-tcp-sessions">Termination TCP Sessions<a aria-hidden="true" class="anchor-heading icon-link" href="#termination-tcp-sessions"></a></h3>
<ol>
<li>
<p>Client connections changes from <code>ESTABLISHED</code> to <code>FIN_WAIT_1</code></p>
</li>
<li>
<p>Server acknowledges the client's <code>FIN</code> and changes its state from <code>ESTABLISHED</code> to <code>CLOSE_WAIT</code></p>
</li>
<li>
<p>Server sends it own <code>FIN</code> packet changing its state to <code>LAST_ACK</code> and waits for final acknowledgement from client</p>
</li>
<li>
<p>The client acknowledges the server's <code>FIN</code> and enters <code>TIME_WAIT</code> state and sends the final<code>ACK</code></p>
</li>
<li>
<p>The client waits for the the <em>maximum segment life-time</em> then changes its connection state to <code>CLOSED</code></p>
</li>
</ol>
<pre>              Client                         Server
                |                               |
    Established |                               | Established
                |                               |
                |           FIN                 |
    FIN_WAIT_1  |------------------------------>|
                |           ACK                 | CLOSE_WAIT
                |&#x3C;------------------------------|
    FIN_WAIT_2  |                               |
                |                               |
                |                               |
                |           FIN                 |
                |&#x3C;------------------------------| LAST_ACK
     TIME_WAIT  |           ACK                 |
                |------------------------------>|
                |                               | CLOSED
        CLOSED  |                               |
</pre>
<h3 id="handling-less-graceful-terminations">Handling Less Graceful Terminations<a aria-hidden="true" class="anchor-heading icon-link" href="#handling-less-graceful-terminations"></a></h3>
<p>When connections are closed/terminated, any connection from the other side of the connection will prompt the closed side of the connection to return  <code>RST</code> packet(reset)</p>