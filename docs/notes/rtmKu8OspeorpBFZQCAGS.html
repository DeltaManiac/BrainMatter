<!DOCTYPE html>

<html lang="en-US">
<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
  
  <title>Reddit - BrainMatter</title>
  

  <link
    rel="shortcut icon"
    href="https://deltamaniac.github.io/favicon.ico"
    type="image/x-icon"
  />
  <link
    rel="stylesheet"
    href="https://deltamaniac.github.io/assets/css/just-the-docs-default.css"
  />
  <script
    type="text/javascript"
    src="https://deltamaniac.github.io/assets/js/just-the-docs.js"
  ></script>
  <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.22.0/themes/prism.min.css"
  />
  <link
    rel="stylesheet"
    href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css"
    integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X"
    crossorigin="anonymous"
  />
  <script
    type="text/javascript"
    src="https://deltamaniac.github.io/assets/js/vendor/lunr.min.js"
  ></script>
  
  <meta name="viewport" content="width=device-width, initial-scale=1" />
   
   
  
<meta name="description" content="Personal knowledge space">
<meta name="author" content="DeltaManiac">

<link rel="canonical" href="https://deltamaniac.github.io//notes/rtmKu8OspeorpBFZQCAGS.html">

<meta property="og:type" content="article">
<meta property="og:url" content="https://deltamaniac.github.io//notes/rtmKu8OspeorpBFZQCAGS.html">
<meta property="og:description" content="Personal knowledge space">
<meta property="og:image" content="https://deltamaniac.github.io/undefined">

<meta name="twitter:card" content="summary">
<meta name="twitter:site" content="@delta_maniac">
<meta name="twitter:url" content="https://deltamaniac.github.io//notes/rtmKu8OspeorpBFZQCAGS.html">
<meta name="twitter:description" content="Personal knowledge space">
<meta name="twitter:image" content="https://deltamaniac.github.io/undefined">


  <meta property="og:title" content="Reddit - BrainMatter" />
  <meta name="twitter:title" content="Reddit - BrainMatter" />
  
</head>



<body>
    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
      <symbol id="svg-link" viewBox="0 0 24 24">
        <title>Link</title>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link">
          <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path>
        </svg>
      </symbol>
      <symbol id="svg-search" viewBox="0 0 24 24">
        <title>Search</title>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search">
          <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line>
        </svg>
      </symbol>
      <symbol id="svg-menu" viewBox="0 0 24 24">
        <title>Menu</title>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu">
          <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line>
        </svg>
      </symbol>
      <symbol id="svg-arrow-right" viewBox="0 0 24 24">
        <title>Expand</title>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right">
          <polyline points="9 18 15 12 9 6"></polyline>
        </svg>
      </symbol>
      <symbol id="svg-doc" viewBox="0 0 24 24">
        <title>Document</title>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file">
          <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline>
        </svg>
      </symbol>
    </svg>

    <div class="side-bar">
      <div class="site-header">
        <a href="https://deltamaniac.github.io" class="site-title lh-tight">
  BrainMatter

 </a>
        <a href="#" id="menu-button" class="site-button">
          <svg viewBox="0 0 24 24" class="icon"><use xlink:href="#svg-menu"></use></svg>
        </a>
      </div>

      <nav role="navigation" aria-label="Main" id="site-nav" class="site-nav">
      </nav>
      <footer class="site-footer">
        🌱 with 💕 using <a href="https://www.dendron.so/"> Dendron 🌲 </a>
      </footer>
    </div>
    <div class="main" id="top">
        <div id="main-header" class="main-header">
          
            <div class="search">
              <div class="search-input-wrap">
                <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search BrainMatter" aria-label="Search BrainMatter" autocomplete="off">
                <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label>
              </div>
              <div id="search-results" class="search-results"></div>
            </div>
          
          
    </div>
    <div id="main-content-wrap" class="main-content-wrap">
      
        
          <nav aria-label="Breadcrumb" class="breadcrumb-nav">
            <ol class="breadcrumb-nav-list"><li class="breadcrumb-nav-list-item"><a href="https://deltamaniac.github.io">BrainMatter</a></li><li class="breadcrumb-nav-list-item"><a href="https://deltamaniac.github.io/notes\A6TBKYAcFVjBqZpdbHuaS.html">Rust</a></li><li class="breadcrumb-nav-list-item"><a href="https://deltamaniac.github.io/notes\qOyBUuT4UMS8TYis4MnIv.html">Bots</a></li><li class="breadcrumb-nav-list-item">Reddit</li></ol>
          </nav>
        
      
      <div id="main-content" class="main-content" role="main">

        
        
        <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
        <script>mermaid.initialize({startOnLoad:true});</script>
        

        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css" integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk" crossorigin="anonymous">
        <script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
        <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
        <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js" integrity="sha384-OgVRvuATP1z7JjHLkuOU7Xw704+h835Lr+6QL9UvYjZE3Ipu6Tp75j7Bh/kR0JKI" crossorigin="anonymous"></script>
        
        

        

        

        

        <script>
          $(function () {
            $('[data-toggle="popover"]').popover({html: true})
          })
        </script>

        

<div id="main" role="main">

  <article class="page" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="Reddit">
    
    <meta itemprop="datePublished" content="2020-10-17T12:55:03+00:00">
    <meta itemprop="dateModified" content="2020-10-17T12:55:03+00:00">

    <div class="page__inner-wrap">

      

      <section class="page__content" itemprop="text">

        

        <h1 id="reddit"><a aria-hidden="true" class="anchor-heading" href="#reddit"><svg aria-hidden="true" viewBox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a>Reddit</h1>
<h2 id="vyom"><a aria-hidden="true" class="anchor-heading" href="#vyom"><svg aria-hidden="true" viewBox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a>Vyom</h2>
<p>The surmised version of how to write a Reddit Bot in <a href="https://deltamaniac.github.io/notes/A6TBKYAcFVjBqZpdbHuaS.html">Rust</a></p>
<h1 id="part-i"><a aria-hidden="true" class="anchor-heading" href="#part-i"><svg aria-hidden="true" viewBox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a>Part I</h1>
<p>Recently while browsing <a href="https://old.reddit.com">reddit</a> I came up on a <a href="https://www.reddit.com/r/rust/comments/i1satq/webference_rusty_days_2020_all_recorded_talks/g01rwq8/?context=3">post</a> in the <a href="https://old.reddit.com">/r/rust</a> subreddit which was a link to a YouTube playlist for the Rusty-Days conference, however there was no way I could find the contents of the playlist without going to YouTube on my phone. This was a nuance so I went to YouTube and curated the list.</p>
<p><img src="/assets/images/2020-10-11-18-16-48.png"></p>
<p>This was going to be tiresome if I'd have to do it every time I see a post that links to a YouTube playlist. So here we are writing a bot do this task for everyone. This bot will run on a server somewhere (hopefully forever) and curate playlist info for all the people who avail its service.</p>
<h1 id="creating-credentials-for-our-bot"><a aria-hidden="true" class="anchor-heading" href="#creating-credentials-for-our-bot"><svg aria-hidden="true" viewBox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a>Creating Credentials For Our Bot</h1>
<p>In order to write our bot we first need to get some credentials from reddit so that we can access <a href="https://old.reddit.com/dev/api">reddit apis</a> programmatically.</p>
<p>First we need an application id and secret so that reddit can know our application. We can get this information by going to <a href="https://www.reddit.com/prefs/apps">preferences/app</a> and clicking <code>are you a developer? create an app...</code> button cause <strong>we definitely are.</strong></p>
<p>Reddit lets us choose the type of the app we want to build. The three types of app are :</p>
<ul>
<li>
<p>Web app: Runs as part of a web service on a server you control. Can keep a secret.</p>
</li>
<li>
<p>Installed app: Runs on devices you don't control, such as the user's mobile phone. Cannot keep a secret, and therefore, does not receive one.</p>
</li>
<li>
<p>Script app: Runs on hardware you control, such as your own laptop or server. Can keep a secret. Only has access to your account.</p>
</li>
</ul>
<p>More info about about the apps can be found <a href="https://github.com/reddit-archive/reddit/wiki/oauth2-app-types">here</a>.</p>
<p>We choose the <code>script</code> type, enter a name and description for our bot, and use the dummy url <code>http://www.example.com/unused/redirect/uri</code> for the redirect url.</p>
<p><img src="/assets/images/2020-10-11-18-17-29.png"></p>
<p>We have now created the credentials with Client Id : <code>TjC0s2uTaTHYCg</code> and Client Secret : <code>mrkAaWitnXLf_DiRagIRS_33cD8</code>.</p>
<p><img src="/assets/images/2020-10-11-18-18-29.png"></p>
<h1 id="using-and-storing-the-credentials"><a aria-hidden="true" class="anchor-heading" href="#using-and-storing-the-credentials"><svg aria-hidden="true" viewBox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a>Using and Storing the credentials</h1>
<p>We can now hard code the credentials in our source code and use like this.</p>
<pre class="language-rust"><code class="language-rust"># main<span class="token punctuation">.</span>rs

<span class="token keyword">static</span>  <span class="token constant">CLIENT_ID</span><span class="token punctuation">:</span><span class="token operator">&#x26;</span><span class="token keyword">str</span><span class="token operator">=</span><span class="token string">"TjC0s2uTaTHYCg"</span><span class="token punctuation">;</span>
<span class="token keyword">static</span>  <span class="token constant">CLIENT_SECRET</span><span class="token punctuation">:</span><span class="token operator">&#x26;</span><span class="token keyword">str</span><span class="token operator">=</span><span class="token string">"mrkAaWitnXLf_DiRagIRS_33cD8"</span><span class="token punctuation">;</span>

<span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"Client ID: {}"</span><span class="token punctuation">,</span><span class="token constant">CLIENT_ID</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"Client Secret: {}"</span><span class="token punctuation">,</span><span class="token constant">CLIENT_SECRET</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<pre class="language-shell"><code class="language-shell">DeltaManiac @ ~/git/rust/vyom
└─ $ cargo run
    Finished dev <span class="token punctuation">[</span>unoptimized + debuginfo<span class="token punctuation">]</span> target<span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token keyword">in</span> <span class="token number">0</span>.08s
     Running <span class="token variable"><span class="token variable">`</span>target/debug/vyom<span class="token variable">`</span></span>
Client ID: SmQ7CzGkKA62yA
Client Secret: UItY35BYBEN_rFVnGVzud9Pig6g
</code></pre>
<p>This is a very easy and clear way to handle credentials but it is flawed.</p>
<ul>
<li>
<p>If we need to change the credentials then we would have to change the code, rebuild the app and restart the app.</p>
</li>
<li>
<p>If we decide to share the code with someone or push it github, it will expose our credentials, which can be used to hijack our account and do bad things.</p>
</li>
</ul>
<p>So lets see if we can fix the first problem, by moving the credentials out of the source code. But where do we put it then ? If you're thinking about environment variables then you're absolutely right. Environment variables are a good place to store such values and they are fairly easy to change.</p>
<pre class="language-rust"><code class="language-rust"># main<span class="token punctuation">.</span>rs

<span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">match</span> <span class="token namespace">std<span class="token punctuation">::</span>env<span class="token punctuation">::</span></span><span class="token function">var</span><span class="token punctuation">(</span><span class="token string">"CLIENT_ID1"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Ok</span><span class="token punctuation">(</span>client_id<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"Client ID: {}"</span><span class="token punctuation">,</span> client_id<span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token class-name">Err</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token macro property">panic!</span><span class="token punctuation">(</span><span class="token string">"Couldn't read CLIENT_ID ({})"</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">match</span> <span class="token namespace">std<span class="token punctuation">::</span>env<span class="token punctuation">::</span></span><span class="token function">var</span><span class="token punctuation">(</span><span class="token string">"CLIENT_SECRET1"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Ok</span><span class="token punctuation">(</span>client_secret<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"Client Secret: {}"</span><span class="token punctuation">,</span> client_secret<span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token class-name">Err</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token macro property">panic!</span><span class="token punctuation">(</span><span class="token string">"Couldn't read CLIENT_SECRET ({})"</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>Since our bot wont work without a <code>client_id</code> and a <code>client_secret</code> we call <a href="https://doc.rust-lang.org/stable/std/macro.panic.html">panic!</a> so that the application exits with an error.</p>
<pre class="language-shell"><code class="language-shell"><span class="token punctuation">(</span>base<span class="token punctuation">)</span> DeltaManiac @ ~/git/rust/vyom
└─ $ cargo run
    Finished dev <span class="token punctuation">[</span>unoptimized + debuginfo<span class="token punctuation">]</span> target<span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token keyword">in</span> <span class="token number">0</span>.41s
     Running <span class="token variable"><span class="token variable">`</span>target/debug/vyom<span class="token variable">`</span></span>
thread <span class="token string">'main'</span> panicked at <span class="token punctuation">\</span>'Couldn<span class="token punctuation">\</span>'t <span class="token builtin class-name">read</span> CLIENT_ID <span class="token punctuation">(</span>environment variable not found<span class="token punctuation">)</span>,
src/main.rs:9:19
note: run with <span class="token variable"><span class="token variable">`</span><span class="token assign-left variable">RUST_BACKTRACE</span><span class="token operator">=</span><span class="token number">1</span><span class="token variable">`</span></span> environment variable to display a backtrace

<span class="token comment"># Set the environment variables</span>
<span class="token punctuation">(</span>base<span class="token punctuation">)</span> DeltaManiac @ ~/git/rust/vyom
└─ $ <span class="token builtin class-name">export</span> <span class="token assign-left variable">CLIENT_SECRET</span><span class="token operator">=</span>UItY35BYBEN_rFVnGVzud9Pig6g
<span class="token punctuation">(</span>base<span class="token punctuation">)</span> DeltaManiac @ ~/git/rust/vyom
└─ $ <span class="token builtin class-name">export</span> <span class="token assign-left variable">CLIENT_ID</span><span class="token operator">=</span>SmQ7CzGkKA62yA

<span class="token punctuation">(</span>base<span class="token punctuation">)</span> DeltaManiac @ ~/git/rust/vyom
└─ $ cargo run
    Finished dev <span class="token punctuation">[</span>unoptimized + debuginfo<span class="token punctuation">]</span> target<span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token keyword">in</span> <span class="token number">0</span>.47s
     Running <span class="token variable"><span class="token variable">`</span>target/debug/vyom<span class="token variable">`</span></span>
Client ID: SmQ7CzGkKA62yA
Client Secret: UItY35BYBEN_rFVnGVzud9Pig6g
</code></pre>
<p>Most of the time we don't really want to export a lot of environment variables manually. It is exhausting. We could fix this problem by writing a shell script that has all our <code>export</code> statements... or we can use <a href="https://crates.io/crates/dotenv">dotenv</a>. Dotenv is a crate that provides us a way to put environment variables in a <code>.env</code> file and read them. Dotenv is smart to enough to only read from the file if the Environment Variable is <strong>not set</strong> on the system.</p>
<p>We first add the <code>dotenv</code> dependency to our <code>Cargo.toml</code> file.</p>
<pre class="language-toml"><code class="language-toml"><span class="token comment"># Cargo.toml</span>
<span class="token punctuation">[</span><span class="token table class-name">package</span><span class="token punctuation">]</span>
<span class="token key property">name</span> <span class="token punctuation">=</span> <span class="token string">"vyom"</span>
<span class="token key property">version</span> <span class="token punctuation">=</span> <span class="token string">"0.1.0"</span>
<span class="token key property">authors</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span><span class="token string">"DeltaManiac &#x3C;maxpaynered@gmail.com>"</span><span class="token punctuation">]</span>
<span class="token key property">edition</span> <span class="token punctuation">=</span> <span class="token string">"2018"</span>

<span class="token punctuation">[</span><span class="token table class-name">dependencies</span><span class="token punctuation">]</span>
<span class="token key property">dotenv_codegen</span><span class="token punctuation">=</span><span class="token string">"0.15.0"</span> <span class="token comment"># dotenv dependency</span>
</code></pre>
<p>We then setup the environment variables in the <code>.env</code> file.</p>
<pre class="language-shell"><code class="language-shell"><span class="token comment"># .env</span>
<span class="token assign-left variable">CLIENT_ID</span><span class="token operator">=</span>test_123
<span class="token assign-left variable">CLIENT_SECRET</span><span class="token operator">=</span>test_321
<span class="token assign-left variable">Test</span><span class="token operator">=</span>DeezTests
</code></pre>
<p>We finally modify our code to use the <code>dotenv</code> crate.</p>
<pre class="language-rust"><code class="language-rust"># main<span class="token punctuation">.</span>rs

<span class="token attribute attr-name">#[macro_use]</span>
<span class="token keyword">extern</span> <span class="token keyword">crate</span> <span class="token module-declaration namespace">dotenv_codegen</span><span class="token punctuation">;</span>

<span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"Env Not on Sys: {}"</span><span class="token punctuation">,</span><span class="token macro property">dotenv!</span><span class="token punctuation">(</span><span class="token string">"Test"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"Client ID: {}"</span><span class="token punctuation">,</span><span class="token macro property">dotenv!</span><span class="token punctuation">(</span><span class="token string">"CLIENT_ID"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"Client Secret: {}"</span><span class="token punctuation">,</span><span class="token macro property">dotenv!</span><span class="token punctuation">(</span><span class="token string">"CLIENT_SECRET"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<pre class="language-shell"><code class="language-shell"><span class="token punctuation">(</span>base<span class="token punctuation">)</span> DeltaManiac @ ~/git/rust/vyom
└─ $ cargo run
    Finished dev <span class="token punctuation">[</span>unoptimized + debuginfo<span class="token punctuation">]</span> target<span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token keyword">in</span> <span class="token number">0</span>.08s
     Running <span class="token variable"><span class="token variable">`</span>target/debug/vyom<span class="token variable">`</span></span>
Env Not on Sys: ss <span class="token comment">#Value from the .env file</span>
Client ID: SmQ7CzGkKA62yA <span class="token comment">#Value from the system</span>
Client Secret: UItY35BYBEN_rFVnGVzud9Pig6g <span class="token comment">#Value from the system</span>
</code></pre>
<h1 id="how-will-the-bot-work-"><a aria-hidden="true" class="anchor-heading" href="#how-will-the-bot-work-"><svg aria-hidden="true" viewBox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a>How will the bot work ?</h1>
<p>The bot will listen to a mention like <code>/u/VyomBot</code> and would check if the post is a link to a YouTube playlist or at a later stage if the parent comment of the mention is a YouTube playlist.</p>
<h1 id="setting-up-reddit"><a aria-hidden="true" class="anchor-heading" href="#setting-up-reddit"><svg aria-hidden="true" viewBox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a>Setting up Reddit</h1>
<p>We can follow these steps to setup reddit for testing/developing this bot</p>
<ol>
<li>
<p>Created a new user called <a href="https://old.reddit.com/user/VyomBot">VyomBot</a> so that the bot can be mentioned via <code>/u/VyomBot</code></p>
</li>
<li>
<p>Registered a new app of <code>script</code> type for <code>/u/VyomBot</code></p>
</li>
<li>
<p>Create a new <a href="https://old.reddit.com/ur/VyomBot">subreddit</a> <code>/r/VyomBot</code> as a test play ground.</p>
</li>
</ol>
<p><img src="/assets/images/2020-10-11-18-20-37.png"></p>
<ol start="4">
<li>
<p>Create a new <a href="https://www.reddit.com/r/VyomBot/comments/i6fk15/test_playlist/?">post</a> with the link to the playlist.</p>
</li>
<li>
<p>Mention <code>/u/VyomBot</code> in the comments.</p>
</li>
</ol>
<p><img src="/assets/images/2020-10-11-18-21-13.png"></p>
<h1 id="talking-to-reddit"><a aria-hidden="true" class="anchor-heading" href="#talking-to-reddit"><svg aria-hidden="true" viewBox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a>Talking to Reddit</h1>
<h2 id="getting-messages-from-inbox"><a aria-hidden="true" class="anchor-heading" href="#getting-messages-from-inbox"><svg aria-hidden="true" viewBox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a>Getting Messages from Inbox</h2>
<p>Lets start off by querying reddit to see if we have a new mention and printing the message. We will use the <a href="https://crates.io/crates/roux">roux</a> crate for interacting with the reddit apis.
Direct quote from the description of the crate</p>
<blockquote>
<p>A simple, asynchronous Reddit API wrapper implemented in Rust.</p>
</blockquote>
<p>This means that we have to use a framework like <a href="https://crates.io/crates/tokio">tokio</a> to provide the async runtime for our bot.
Lets go about doing that.</p>
<p>Add the dependencies to our Cargo.toml file.</p>
<pre class="language-toml"><code class="language-toml"><span class="token comment"># Cargo.toml</span>
<span class="token punctuation">[</span><span class="token table class-name">package</span><span class="token punctuation">]</span>
<span class="token key property">name</span> <span class="token punctuation">=</span> <span class="token string">"vyom"</span>
<span class="token key property">version</span> <span class="token punctuation">=</span> <span class="token string">"0.1.0"</span>
<span class="token key property">authors</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span><span class="token string">"DeltaManiac &#x3C;maxpaynered@gmail.com>"</span><span class="token punctuation">]</span>
<span class="token key property">edition</span> <span class="token punctuation">=</span> <span class="token string">"2018"</span>

<span class="token punctuation">[</span><span class="token table class-name">dependencies</span><span class="token punctuation">]</span>
<span class="token key property">dotenv_codegen</span><span class="token punctuation">=</span><span class="token string">"0.15.0"</span> <span class="token comment"># dotenv dependency</span>
<span class="token key property">roux</span><span class="token punctuation">=</span><span class="token string">"1.0.0"</span> <span class="token comment"># roux dependency</span>
<span class="token key property">tokio</span> <span class="token punctuation">=</span> <span class="token punctuation">{</span><span class="token key property">version</span><span class="token punctuation">=</span><span class="token string">"0.2.22"</span><span class="token punctuation">,</span><span class="token key property">features</span><span class="token punctuation">=</span><span class="token punctuation">[</span><span class="token string">"macros"</span><span class="token punctuation">]</span><span class="token punctuation">}</span> <span class="token comment"># tokio dependency and only enable the macro feature</span>
</code></pre>
<p>Update our code to use the library and call the reddit apis.</p>
<pre class="language-rust"><code class="language-rust"># main<span class="token punctuation">.</span>rs

<span class="token attribute attr-name">#[macro_use]</span>
<span class="token keyword">extern</span> <span class="token keyword">crate</span> <span class="token module-declaration namespace">dotenv_codegen</span><span class="token punctuation">;</span>
<span class="token attribute attr-name">#[macro_use]</span>
<span class="token keyword">extern</span> <span class="token keyword">crate</span> <span class="token module-declaration namespace">log</span><span class="token punctuation">;</span> <span class="token comment">// Used for logging</span>
<span class="token keyword">use</span> <span class="token namespace">roux<span class="token punctuation">::</span></span><span class="token class-name">Reddit</span><span class="token punctuation">;</span>

<span class="token attribute attr-name">#[tokio::main]</span>
<span class="token keyword">async</span> <span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">match</span> <span class="token class-name">Reddit</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span>
        <span class="token macro property">dotenv!</span><span class="token punctuation">(</span><span class="token string">"VYOM_USERAGENT"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token macro property">dotenv!</span><span class="token punctuation">(</span><span class="token string">"VYOM_CLIENT_ID"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token macro property">dotenv!</span><span class="token punctuation">(</span><span class="token string">"VYOM_CLIENT_SECRET"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">username</span><span class="token punctuation">(</span><span class="token macro property">dotenv!</span><span class="token punctuation">(</span><span class="token string">"VYOM_USERNAME"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">password</span><span class="token punctuation">(</span><span class="token macro property">dotenv!</span><span class="token punctuation">(</span><span class="token string">"VYOM_PASSWORD"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">login</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token keyword">await</span>
    <span class="token punctuation">{</span>   <span class="token comment">// Try to make a new client with the credentials</span>
        <span class="token class-name">Ok</span><span class="token punctuation">(</span>client<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">match</span> client<span class="token punctuation">.</span><span class="token function">inbox</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">await</span> <span class="token punctuation">{</span>
            <span class="token comment">// Fetch the inbox of the logged in user</span>
            <span class="token class-name">Ok</span><span class="token punctuation">(</span>listing<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
                <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"Message Count {}"</span><span class="token punctuation">,</span> listing<span class="token punctuation">.</span>data<span class="token punctuation">.</span>children<span class="token punctuation">.</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token macro property">dbg!</span><span class="token punctuation">(</span>listing<span class="token punctuation">.</span>data<span class="token punctuation">.</span>children<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token class-name">Err</span><span class="token punctuation">(</span>_<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
                <span class="token macro property">error!</span><span class="token punctuation">(</span><span class="token string">"Failed to fetch messages"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token class-name">Err</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token macro property">panic!</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre>
<p>When we run the program we get the number of messages we have and the <code>dbg!</code> macro shows what the passed in variable which in this case is a <code>InboxItem</code> struct, looks like.</p>
<pre class="language-shell"><code class="language-shell"><span class="token punctuation">(</span>base<span class="token punctuation">)</span> DeltaManiac @ ~/git/rust/vyom
└─ $ cargo run
    Finished dev <span class="token punctuation">[</span>unoptimized + debuginfo<span class="token punctuation">]</span> target<span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token keyword">in</span> <span class="token number">3</span>.71s
     Running <span class="token variable"><span class="token variable">`</span>target/debug/vyom<span class="token variable">`</span></span>
Message Count <span class="token number">5</span>
<span class="token punctuation">[</span>src/main.rs:24<span class="token punctuation">]</span> <span class="token operator">&#x26;</span>listing.data.children.get<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>.unwrap<span class="token punctuation">(</span><span class="token punctuation">)</span>.data <span class="token operator">=</span> InboxItem <span class="token punctuation">{</span>
    id: <span class="token string">"g0vfbra"</span>,
    subject: <span class="token string">"username mention"</span>,
    was_comment: true,
    author: Some<span class="token punctuation">(</span>
        <span class="token string">"DeltaManiac"</span>,
    <span class="token punctuation">)</span>,
    parent_id: Some<span class="token punctuation">(</span>
        <span class="token string">"t3_i6fk15"</span>,
    <span class="token punctuation">)</span>,
    subreddit_name_prefixed: Some<span class="token punctuation">(</span>
        <span class="token string">"r/VyomBot"</span>,
    <span class="token punctuation">)</span>,
    new: true,
    type: <span class="token string">"username_mention"</span>,
    body: <span class="token string">"/u/VyomBot"</span>,
    dest: <span class="token string">"VyomBot"</span>,
    body_html: <span class="token string">"&#x26;lt;!-- SC_OFF --&#x26;gt;&#x26;lt;div class=<span class="token entity" title="\&#x22;">\"</span>md<span class="token entity" title="\&#x22;">\"</span>&#x26;gt;&#x26;lt;p&#x26;gt;&#x26;lt;a href=<span class="token entity" title="\&#x22;">\"</span>/u/VyomBot<span class="token entity" title="\&#x22;">\"</span>&#x26;gt;/u/VyomBot&#x26;lt;/a&#x26;gt;&#x26;lt;/p&#x26;gt;<span class="token entity" title="\n">\n</span>&#x26;lt;/div&#x26;gt;&#x26;lt;!-- SC_ON --&#x26;gt;"</span>,
    name: <span class="token string">"t1_g0vfbra"</span>,
    created: <span class="token number">1596987973.0</span>,
    created_utc: <span class="token number">1596959173.0</span>,
    context: <span class="token string">"/r/VyomBot/comments/i6fk15/test_playlist/g0vfbra/?context=3"</span>,
<span class="token punctuation">}</span>
</code></pre>
<p>We can use the <code>new</code> property to identify if this is a message that we had previously read.
The type property can be used to determine if the item is a comment or a username mention.
We can use this to iterate over the messages retrieved and and determine the messages that we have to reply to.</p>
<h1 id="replying-to-the-message"><a aria-hidden="true" class="anchor-heading" href="#replying-to-the-message"><svg aria-hidden="true" viewBox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a>Replying to the message</h1>
<p>Roux provides us a convenient method aptly name <code>comment</code> to reply to the message. Let's go ahead and use this to reply to the message.</p>
<pre class="language-rust"><code class="language-rust"># main<span class="token punctuation">.</span>rs

<span class="token keyword">async</span> <span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token punctuation">...</span>
<span class="token punctuation">...</span>
<span class="token comment">// Fetch the inbox of the logged in user</span>
    <span class="token class-name">Ok</span><span class="token punctuation">(</span>listing<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
        <span class="token keyword">for</span> message <span class="token keyword">in</span> listing<span class="token punctuation">.</span>data<span class="token punctuation">.</span>children<span class="token punctuation">.</span><span class="token function">iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            is message unread and of <span class="token keyword">type</span> <span class="token string">"username_mention"</span>
            <span class="token keyword">if</span> message<span class="token punctuation">.</span>data<span class="token punctuation">.</span>new <span class="token operator">&#x26;&#x26;</span> message<span class="token punctuation">.</span>data<span class="token punctuation">.</span>r#<span class="token keyword">type</span> <span class="token operator">==</span> <span class="token string">"username_mention"</span> <span class="token punctuation">{</span>
                <span class="token keyword">match</span> client
                    <span class="token punctuation">.</span><span class="token function">comment</span><span class="token punctuation">(</span>
                        <span class="token string">"You have been Noted by Vyom. Please Stand By!"</span><span class="token punctuation">,</span>
                        <span class="token operator">&#x26;</span>message<span class="token punctuation">.</span>data<span class="token punctuation">.</span>name<span class="token punctuation">.</span><span class="token function">as_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    <span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token keyword">await</span>
                <span class="token punctuation">{</span>
                    <span class="token class-name">Ok</span><span class="token punctuation">(</span>_<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token macro property">info!</span><span class="token punctuation">(</span><span class="token string">"Replied to {}"</span><span class="token punctuation">,</span> message<span class="token punctuation">.</span>data<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">,</span>
                    <span class="token class-name">Err</span><span class="token punctuation">(</span>_<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token macro property">error!</span><span class="token punctuation">(</span><span class="token string">"Failed to reply to mention"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token punctuation">}</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">...</span>
<span class="token punctuation">...</span>
</code></pre>
<blockquote>
<p>Psst.., I'll let you in on something cool. In rust <code>type</code> is a reserved keyword. In most programming languages you can use a keyword only as keyword, e.g. you <em>cannot</em> have a variable called <code>for</code>. In rust we can use <code>type</code> as an attribute of a struct and access it by specifying it as a raw string using the <code>r#</code> like <code>message.data.r#type</code></p>
</blockquote>
<p>Now that we have written the code lets run it and see what happens..</p>
<pre class="language-shell"><code class="language-shell"><span class="token punctuation">(</span>base<span class="token punctuation">)</span> DeltaManiac @ ~/git/rust/vyom
└─ $ cargo run
    Finished dev <span class="token punctuation">[</span>unoptimized + debuginfo<span class="token punctuation">]</span> target<span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token keyword">in</span> <span class="token number">4</span>.45s
     Running <span class="token variable"><span class="token variable">`</span>target/debug/vyom<span class="token variable">`</span></span>
</code></pre>
<p>Nice! It logged that we replied to the mention. Lets run it again, this time it should not reply to an already replied message as we have read it.</p>
<pre class="language-shell"><code class="language-shell"><span class="token punctuation">[</span><span class="token number">2020</span>-08-09T12:59:25Z INFO  vyom<span class="token punctuation">]</span> Replied to t1_g0vfbra
<span class="token punctuation">(</span>base<span class="token punctuation">)</span> DeltaManiac @ ~/git/rust/vyom
└─ $ cargo run
    Finished dev <span class="token punctuation">[</span>unoptimized + debuginfo<span class="token punctuation">]</span> target<span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token keyword">in</span> <span class="token number">0</span>.10s
     Running <span class="token variable"><span class="token variable">`</span>target/debug/vyom<span class="token variable">`</span></span>
<span class="token punctuation">[</span><span class="token number">2020</span>-08-09T12:59:29Z INFO  vyom<span class="token punctuation">]</span> Replied to t1_g0vfbra
<span class="token punctuation">(</span>base<span class="token punctuation">)</span> DeltaManiac @ ~/git/rust/vyom
└─ $ cargo run
    Finished dev <span class="token punctuation">[</span>unoptimized + debuginfo<span class="token punctuation">]</span> target<span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token keyword">in</span> <span class="token number">0</span>.09s
     Running <span class="token variable"><span class="token variable">`</span>target/debug/vyom<span class="token variable">`</span></span>
<span class="token punctuation">[</span><span class="token number">2020</span>-08-09T12:59:32Z INFO  vyom<span class="token punctuation">]</span> Replied to t1_g0vfbra
</code></pre>
<p>Damn!
IT REPLIED AGAIN!!!😞
And this is what the subreddit looks like now.</p>
<p><img src="/assets/images/2020-10-11-18-22-14.png"></p>
<p>Time to find that pesky bug and get rid of it for good.</p>
<p>Lets go to reddit and see what the inbox looks like.</p>
<p><img src="/assets/images/2020-10-11-18-22-29.png"></p>
<p>Well, its just as we suspected, when we reply to a mention with the <code>comment</code> function it does not change the status of the message. Sifting through the <a href="https://docs.rs/roux/1.0.0/roux/?search=read">documentation</a> of <code>roux</code> we can find a method that marks a message as <code>read</code>.</p>
<p>The place we are at right now reminds of a the poem <a href="https://www.poetryfoundation.org/poems/44272/the-road-not-taken">The Road Not Taken</a> by Robert Frost. It talks about how the author finds two roads diverging in the wood and he ponders which one to travel upon. I ask you to take a few minutes and read the poem, its beautiful.</p>
<p>I'll be waiting!</p>
<p>Oh BTW the code can be found on the <code>part-I</code> branch <a href="https://github.com/DeltaManiac/VyomBot">here</a></p>
<h1 id="part-ii"><a aria-hidden="true" class="anchor-heading" href="#part-ii"><svg aria-hidden="true" viewBox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a>Part II</h1>
<p>If you had read the poem mentioned in the previous part, you can be pretty sure what we are going to do right now. You Betcha! We are going to go down the Rabbit Hole.</p>
<p>Just as in the poem it would have been easy for us to change the library to something that already has a <code>mark as read</code> method like many do and continue on, but like Frost we will take the road not taken and that might make all the difference. 😉</p>
<h2 id="down-the-rabbit-hole"><a aria-hidden="true" class="anchor-heading" href="#down-the-rabbit-hole"><svg aria-hidden="true" viewBox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a>Down the Rabbit Hole</h2>
<p>We actually got stumped on the last part because there was no method to mark a message as read in <code>roux</code>. This makes one wonder if there isn't such an api for reddit or that <code>roux</code> just didn't implement it.</p>
<p>Lets head to <a href="https://www.reddit.com/dev/api">reddit api docs</a> and try our luck.</p>
<p>Yep, reddit does have a <a href="https://www.reddit.com/dev/api#POST_api_read_message"><code>read_message</code></a> api for us to use exactly for this purpose. The api accepts a list of <a href="https://www.reddit.com/dev/api#fullnames">fullnames</a> with an HTTP POST method.</p>
<p>What is the <code>fullname</code> for our message ? Its nothing but the <code>name</code> parameter of the struct.</p>
<p>Now to fix <code>roux</code>, so that we can mark the message as read.</p>
<p>Lets clone the <a href="https://github.com/halcyonnouveau/roux.rs">roux source code</a> into another directory.</p>
<p>Since the <code>comment</code> method we used is an api which POSTS the comment data to reddit. Perhaps we can <del>reuse</del>, who are we kidding ? We can definitely <em>copy-paste</em> and modify the code to send some data to the <code>read_message</code> api.</p>
<blockquote>
<p>While searching for a way to mark a message as read, we came up across another api <a href="https://www.reddit.com/dev/api#GET_message_unread"><code>message/unread</code></a> which returns only the unread messages from our inbox, so we don't have to filter out on the <code>new</code> flag of the response anymore. Yay!</p>
</blockquote>
<pre class="language-rust"><code class="language-rust"># src<span class="token operator">/</span>me<span class="token operator">/</span><span class="token keyword">mod</span><span class="token punctuation">.</span>rs
<span class="token punctuation">...</span>
<span class="token comment">/// Get user's submitted posts.</span>
    <span class="token keyword">pub</span> <span class="token keyword">async</span> <span class="token keyword">fn</span> <span class="token function-definition function">inbox</span><span class="token punctuation">(</span><span class="token operator">&#x26;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Result</span><span class="token operator">&#x3C;</span><span class="token class-name">BasicListing</span><span class="token operator">&#x3C;</span><span class="token class-name">InboxItem</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token class-name">RouxError</span><span class="token operator">></span> <span class="token punctuation">{</span>
        <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token keyword">self</span>
            <span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"message/inbox"</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token keyword">await</span><span class="token operator">?</span>
            <span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">::</span><span class="token operator">&#x3C;</span><span class="token class-name">BasicListing</span><span class="token operator">&#x3C;</span><span class="token class-name">InboxItem</span><span class="token operator">>></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token keyword">await</span><span class="token operator">?</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

<span class="token comment">/** This is our addition **/</span>
<span class="token comment">///  Get users unread messages</span>
    <span class="token keyword">pub</span> <span class="token keyword">async</span> <span class="token keyword">fn</span> <span class="token function-definition function">unread</span><span class="token punctuation">(</span><span class="token operator">&#x26;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Result</span><span class="token operator">&#x3C;</span><span class="token class-name">BasicListing</span><span class="token operator">&#x3C;</span><span class="token class-name">InboxItem</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token class-name">RouxError</span><span class="token operator">></span> <span class="token punctuation">{</span>
        <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token keyword">self</span>
            <span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"message/unread"</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token keyword">await</span><span class="token operator">?</span>
            <span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">::</span><span class="token operator">&#x3C;</span><span class="token class-name">BasicListing</span><span class="token operator">&#x3C;</span><span class="token class-name">InboxItem</span><span class="token operator">>></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token keyword">await</span><span class="token operator">?</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

<span class="token comment">/** This is our addition **/</span>
<span class="token comment">/// Mark message as read</span>
    <span class="token keyword">pub</span> <span class="token keyword">async</span> <span class="token keyword">fn</span> <span class="token function-definition function">mark_read</span><span class="token punctuation">(</span><span class="token operator">&#x26;</span><span class="token keyword">self</span><span class="token punctuation">,</span> ids<span class="token punctuation">:</span> <span class="token operator">&#x26;</span><span class="token keyword">str</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Result</span><span class="token operator">&#x3C;</span><span class="token class-name">Response</span><span class="token punctuation">,</span> <span class="token class-name">RouxError</span><span class="token operator">></span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> form <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">,</span> ids<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">"api/read_message"</span><span class="token punctuation">,</span> <span class="token operator">&#x26;</span>form<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">await</span>
    <span class="token punctuation">}</span>

<span class="token comment">/** This is our addition **/</span>
<span class="token comment">/// Mark messages as unread</span>
    <span class="token keyword">pub</span> <span class="token keyword">async</span> <span class="token keyword">fn</span> <span class="token function-definition function">mark_read</span><span class="token punctuation">(</span><span class="token operator">&#x26;</span><span class="token keyword">self</span><span class="token punctuation">,</span> ids<span class="token punctuation">:</span> <span class="token operator">&#x26;</span><span class="token keyword">str</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Result</span><span class="token operator">&#x3C;</span><span class="token class-name">Response</span><span class="token punctuation">,</span> <span class="token class-name">RouxError</span><span class="token operator">></span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> form <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">,</span> ids<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">"api/unread_message"</span><span class="token punctuation">,</span> <span class="token operator">&#x26;</span>form<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">await</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">pub</span> <span class="token keyword">async</span> <span class="token keyword">fn</span> <span class="token function-definition function">comment</span><span class="token punctuation">(</span><span class="token operator">&#x26;</span><span class="token keyword">self</span><span class="token punctuation">,</span> text<span class="token punctuation">:</span> <span class="token operator">&#x26;</span><span class="token keyword">str</span><span class="token punctuation">,</span> parent<span class="token punctuation">:</span> <span class="token operator">&#x26;</span><span class="token keyword">str</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Result</span><span class="token operator">&#x3C;</span><span class="token class-name">Response</span><span class="token punctuation">,</span> <span class="token class-name">RouxError</span><span class="token operator">></span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> form <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token string">"text"</span><span class="token punctuation">,</span> text<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">"parent"</span><span class="token punctuation">,</span> parent<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">"api/comment"</span><span class="token punctuation">,</span> <span class="token operator">&#x26;</span>form<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">await</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">...</span>
</code></pre>
<blockquote>
<p>I've submitted a <a href="https://github.com/halcyonnouveau/roux.rs/pull/13">PR</a> to roux with these changes.</p>
</blockquote>
<p>So all is good and well with the change, but how do we use this changed version with our code ?</p>
<p><code>Cargo.toml</code> is the answer. We can tell <code>Cargo.toml</code> to use the code from a directory or from a url for a specified crate. Since we have a the modified source code in our system, we can point to that to get it working.</p>
<pre class="language-toml"><code class="language-toml"><span class="token comment"># Cargo.toml</span>

<span class="token punctuation">[</span><span class="token table class-name">package</span><span class="token punctuation">]</span>
<span class="token key property">name</span> <span class="token punctuation">=</span> <span class="token string">"vyom"</span>
<span class="token key property">version</span> <span class="token punctuation">=</span> <span class="token string">"0.1.0"</span>
<span class="token key property">authors</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span><span class="token string">"Harikrishnan Menon &#x3C;harikrishnan.menon@sap.com>"</span><span class="token punctuation">]</span>
<span class="token key property">edition</span> <span class="token punctuation">=</span> <span class="token string">"2018"</span>

<span class="token punctuation">[</span><span class="token table class-name">dependencies</span><span class="token punctuation">]</span>
<span class="token key property">roux</span><span class="token punctuation">=</span><span class="token punctuation">{</span><span class="token key property">path</span><span class="token punctuation">=</span><span class="token string">"../roux.rs"</span><span class="token punctuation">}</span> <span class="token comment">#This points to our local modified copy</span>
<span class="token comment"># roux={git = "https://github.com/DeltaManiac/roux.rs"} #This points to the modified version on github</span>
<span class="token key property">dotenv_codegen</span><span class="token punctuation">=</span><span class="token string">"0.15.0"</span>
<span class="token key property">tokio</span> <span class="token punctuation">=</span> <span class="token punctuation">{</span><span class="token key property">version</span><span class="token punctuation">=</span><span class="token string">"0.2.22"</span><span class="token punctuation">,</span> <span class="token key property">features</span><span class="token punctuation">=</span><span class="token punctuation">[</span><span class="token string">"macros"</span><span class="token punctuation">]</span><span class="token punctuation">}</span>
<span class="token key property">env_logger</span> <span class="token punctuation">=</span><span class="token string">"0.7.1"</span>
<span class="token key property">log</span> <span class="token punctuation">=</span> <span class="token string">"0.4.11"</span>
</code></pre>
<p>When we build our project now, we can see that it picks up the roux source code from the new path specified by us.</p>
<pre class="language-shell"><code class="language-shell"><span class="token punctuation">(</span>base<span class="token punctuation">)</span> DeltaManiac @ ~/git/rust/vyom
└─ $ cargo build
   Compiling roux v1.0.1-alpha.0 <span class="token punctuation">(</span>/Users/DeltaManiac/git/rust/roux.rs<span class="token punctuation">)</span>
   Compiling vyom v0.1.0 <span class="token punctuation">(</span>/Users/DeltaManiac/git/rust/vyom<span class="token punctuation">)</span>
   Finished dev <span class="token punctuation">[</span>unoptimized + debuginfo<span class="token punctuation">]</span> target<span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token keyword">in</span> <span class="token number">6</span>.70s
</code></pre>
<blockquote>
<p>If we don't want go through the hassle of doing this, we can point cargo to my fork which has the necessary changes. This is how the code would be in the repository.</p>
</blockquote>
<h2 id="actually-squashing-the-bug"><a aria-hidden="true" class="anchor-heading" href="#actually-squashing-the-bug"><svg aria-hidden="true" viewBox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a>Actually Squashing the Bug</h2>
<p>Now that we are back from our exceedingly educating trip down the rabbit hole, lets see how we can finally mark a message as read after we reply to it.</p>
<pre class="language-rust"><code class="language-rust"># main<span class="token punctuation">.</span>rs
<span class="token punctuation">...</span>
<span class="token punctuation">...</span>
<span class="token comment">// Fetch only the unread messages form the inbox of the logged in user</span>
<span class="token class-name">Ok</span><span class="token punctuation">(</span>client<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">match</span> client<span class="token punctuation">.</span><span class="token function">unread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">await</span> <span class="token punctuation">{</span>
    <span class="token class-name">Ok</span><span class="token punctuation">(</span>listing<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
        <span class="token keyword">for</span> message <span class="token keyword">in</span> listing<span class="token punctuation">.</span>data<span class="token punctuation">.</span>children<span class="token punctuation">.</span><span class="token function">iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// We have removed the `new` check</span>
            <span class="token keyword">if</span> message<span class="token punctuation">.</span>data<span class="token punctuation">.</span>r#<span class="token keyword">type</span> <span class="token operator">==</span> <span class="token string">"username_mention"</span> <span class="token punctuation">{</span>
                <span class="token keyword">match</span> client
                    <span class="token punctuation">.</span><span class="token function">comment</span><span class="token punctuation">(</span>
                        <span class="token string">"Thank you for standing by while we squished a bug. You shouldn't be seeing this message again!"</span><span class="token punctuation">,</span>
                        <span class="token operator">&#x26;</span>message<span class="token punctuation">.</span>data<span class="token punctuation">.</span>name<span class="token punctuation">.</span><span class="token function">as_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    <span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token keyword">await</span>
                <span class="token punctuation">{</span>
                    <span class="token class-name">Ok</span><span class="token punctuation">(</span>_<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
                        <span class="token macro property">info!</span><span class="token punctuation">(</span><span class="token string">"Replied to {}"</span><span class="token punctuation">,</span> message<span class="token punctuation">.</span>data<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token keyword">match</span> client<span class="token punctuation">.</span><span class="token function">mark_read</span><span class="token punctuation">(</span>message<span class="token punctuation">.</span>data<span class="token punctuation">.</span>name<span class="token punctuation">.</span><span class="token function">as_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">await</span> <span class="token punctuation">{</span>
                            <span class="token class-name">Ok</span><span class="token punctuation">(</span>_<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token macro property">info!</span><span class="token punctuation">(</span><span class="token string">"Marked {} as read"</span><span class="token punctuation">,</span> message<span class="token punctuation">.</span>data<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">,</span>
                            <span class="token class-name">Err</span><span class="token punctuation">(</span>_<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
                                <span class="token macro property">error!</span><span class="token punctuation">(</span><span class="token string">"Failed to mark {} as read"</span><span class="token punctuation">,</span> message<span class="token punctuation">.</span>data<span class="token punctuation">.</span>name<span class="token punctuation">)</span>
                            <span class="token punctuation">}</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span>
                    <span class="token class-name">Err</span><span class="token punctuation">(</span>_<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token macro property">error!</span><span class="token punctuation">(</span><span class="token string">"Failed to reply to mention {}"</span><span class="token punctuation">,</span> message<span class="token punctuation">.</span>data<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token punctuation">}</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">...</span>
<span class="token punctuation">...</span>
</code></pre>
<p>We have changed the reply text so that we can identify from reddit that it is actually the new reply that is being sent, and we call the <code>mark_read</code> method form the modified crate to mark the message as read.</p>
<p>Lets run the code and see if it works. Fingers Crossed.</p>
<pre class="language-shell"><code class="language-shell"><span class="token punctuation">(</span>base<span class="token punctuation">)</span> DeltaManiac @ ~/git/rust/vyom
└─ $ cargo run
   Compiling vyom v0.1.0
    Finished dev <span class="token punctuation">[</span>unoptimized + debuginfo<span class="token punctuation">]</span> target<span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token keyword">in</span> <span class="token number">4</span>.41s
     Running <span class="token variable"><span class="token variable">`</span>target/debug/vyom<span class="token variable">`</span></span>
<span class="token punctuation">[</span><span class="token number">2020</span>-08-09T16:38:11Z INFO  vyom<span class="token punctuation">]</span> Replied to t1_g0vfbra
<span class="token punctuation">[</span><span class="token number">2020</span>-08-09T16:38:11Z INFO  vyom<span class="token punctuation">]</span> Marked t1_g0vfbra as <span class="token builtin class-name">read</span>
</code></pre>
<p>Cool, but does it actually mark the message as read? Lets run the program again a couple more times and figure it out.</p>
<pre class="language-shell"><code class="language-shell"><span class="token punctuation">(</span>base<span class="token punctuation">)</span> DeltaManiac @ ~/git/rust/vyom
└─ $ cargo run
    Finished dev <span class="token punctuation">[</span>unoptimized + debuginfo<span class="token punctuation">]</span> target<span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token keyword">in</span> <span class="token number">0</span>.10s
     Running <span class="token variable"><span class="token variable">`</span>target/debug/vyom<span class="token variable">`</span></span>
<span class="token punctuation">(</span>base<span class="token punctuation">)</span> DeltaManiac @ ~/git/rust/vyom
└─ $ cargo run
    Finished dev <span class="token punctuation">[</span>unoptimized + debuginfo<span class="token punctuation">]</span> target<span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token keyword">in</span> <span class="token number">0</span>.10s
     Running <span class="token variable"><span class="token variable">`</span>target/debug/vyom<span class="token variable">`</span></span>
<span class="token punctuation">(</span>base<span class="token punctuation">)</span> DeltaManiac @ ~/git/rust/vyom
└─ $
</code></pre>
<p>Since there doesn't seem to to be any logs being printed we can confirm that we are not replying again to the message. But it programming and you never know if you're right until you completely verify from reddit side too. Let go take a look at the subreddit.</p>
<p><img src="/assets/images/2020-10-11-18-24-11.png"></p>
<p>Yep, it has only one comment.</p>
<h2 id="extracting-the-intel"><a aria-hidden="true" class="anchor-heading" href="#extracting-the-intel"><svg aria-hidden="true" viewBox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a>Extracting the Intel</h2>
<p>Now that we have figured out how to respond to comments, lets get to the actual crux of the problem.</p>
<p>When a VyomBot gets mentioned where should he look for the Youtube link? There can be many answers to this question like</p>
<ol>
<li>The immediate parent comment of the mention</li>
<li>The title of the post</li>
<li>It could be part of the message sent to VyomBot</li>
</ol>
<p>These all seem relevant, but to keep it simple lets start with 2, i.e if the parent is a YouTube playlist link then we fetch the information and post it as a comment.</p>
<p>In order to get the link of the playlist we are not going to use the roux library but instead handwrite it ourselves. Why you ask ? CAUSE ITS GONNA BE FUN!!</p>
<blockquote>
<p>Note to reader the next part of the code is kind of hacky code and do not follow idiomatic rust. Here be Dragons 🐉🐉🐉</p>
</blockquote>
<h3 id="constructing-the-reddit-post-link"><a aria-hidden="true" class="anchor-heading" href="#constructing-the-reddit-post-link"><svg aria-hidden="true" viewBox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a>Constructing the Reddit Post link</h3>
<p>We can use the <code>context</code> field of the response which looks like</p>
<pre class="language-json"><code class="language-json"><span class="token punctuation">{</span>
...
...
    name<span class="token operator">:</span> <span class="token string">"t1_g0vfbra"</span><span class="token punctuation">,</span>
    created<span class="token operator">:</span> <span class="token number">1596987973.0</span><span class="token punctuation">,</span>
    created_utc<span class="token operator">:</span> <span class="token number">1596959173.0</span><span class="token punctuation">,</span>
    context<span class="token operator">:</span> <span class="token string">"/r/VyomBot/comments/i6fk15/test_playlist/g0vfbra/?context=3"</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre>
<p>to construct the url of the post.</p>
<p>The first 5 parts <code>r</code>, <code>VyomBot</code>, <code>comments</code>, <code>i6fk15</code>, <code>test_playlist</code> can be used to for the url to the post.
Let's do this right now.</p>
<pre class="language-rust"><code class="language-rust"># main<span class="token punctuation">.</span>rs
<span class="token punctuation">...</span>
 <span class="token keyword">if</span> message<span class="token punctuation">.</span>data<span class="token punctuation">.</span>r#<span class="token keyword">type</span> <span class="token operator">==</span> <span class="token string">"username_mention"</span> <span class="token punctuation">{</span>
<span class="token keyword">let</span> post_url <span class="token operator">=</span> <span class="token macro property">format!</span><span class="token punctuation">(</span>
    <span class="token string">"https://www.reddit.com/{}/.json"</span><span class="token punctuation">,</span>
    message
        <span class="token punctuation">.</span>data
        <span class="token punctuation">.</span>context <span class="token comment">// /r/VyomBot/comments/i6fk15/test_playlist/g0vfbra/?context=3</span>
        <span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// remove any trailing and leading spaces</span>
        <span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token char string">'/'</span><span class="token punctuation">)</span> <span class="token comment">// [ "", "r", "VyomBot", "comments", "i6fk15", "test_playlist", "g0vfbra", "?context=3" ]</span>
        <span class="token punctuation">.</span><span class="token function">skip</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment">// [ "r", "VyomBot", "comments", "i6fk15", "test_playlist", "g0vfbra", "?context=3" ]</span>
        <span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">::</span><span class="token operator">&#x3C;</span><span class="token class-name">Vec</span><span class="token operator">&#x3C;</span><span class="token operator">&#x26;</span><span class="token keyword">str</span><span class="token operator">>></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">..=</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token comment">// Take the first 5 [ "r", "VyomBot", "comments", "i6fk15", "test_playlist" ]</span>
        <span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">)</span> <span class="token comment">// /r/VyomBot/comments/i6fk15/test_playlist/</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">...</span>
</code></pre>
<p>We now have constructed the url <code>https://www.reddit.com/{}/r/VyomBot/comments/i6fk15/test_playlist/.json</code>. The <code>.json</code> at the end tells reddit to return the JSON formatted and not the HTML page of the post id specified</p>
<h3 id="extracting-the-playlist-id"><a aria-hidden="true" class="anchor-heading" href="#extracting-the-playlist-id"><svg aria-hidden="true" viewBox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a>Extracting the Playlist ID</h3>
<p>In order to query the url that we crafted above we would be using the <a href="https://crates.io/crates/reqwest"><code>reqwest</code></a> crate and the <a href="https://crates.io/crates/url"><code>url</code></a> crate. We fire a GET request to reddit and extract the <code>url</code> parameter from the response body which would have our link.</p>
<p>We then would convert the response body to a dynamic json using the <a href="https://crates.io/crates/serde_json"><code>serde_json</code></a> crate and then extract the link from the <code>url</code> property of the response.</p>
<p>Then the <a href="https://crates.io/crates/url"><code>url</code></a> crate to parse and extract the playlist id from the YouTube link. For our link
<code>https://www.youtube.com/playlist?list=PLf3u8NhoEikhTC5radGrmmqdkOK-xMDoZ</code> the playlist id is <code>PLf3u8NhoEikhTC5radGrmmqdkOK-xMDoZ</code>.</p>
<pre class="language-toml"><code class="language-toml"><span class="token comment"># Cargo.toml</span>

<span class="token punctuation">[</span><span class="token table class-name">package</span><span class="token punctuation">]</span>
<span class="token key property">name</span> <span class="token punctuation">=</span> <span class="token string">"vyom"</span>
<span class="token key property">version</span> <span class="token punctuation">=</span> <span class="token string">"0.1.0"</span>
<span class="token key property">authors</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span><span class="token string">"Harikrishnan Menon &#x3C;harikrishnan.menon@sap.com>"</span><span class="token punctuation">]</span>
<span class="token key property">edition</span> <span class="token punctuation">=</span> <span class="token string">"2018"</span>

<span class="token punctuation">[</span><span class="token table class-name">dependencies</span><span class="token punctuation">]</span>
<span class="token key property">roux</span><span class="token punctuation">=</span><span class="token punctuation">{</span><span class="token key property">path</span><span class="token punctuation">=</span><span class="token string">"../roux.rs"</span><span class="token punctuation">}</span> <span class="token comment">#This points to our local modified copy</span>
<span class="token comment"># roux={git = "https://github.com/DeltaManiac/roux.rs"} #This points to the modified version on github</span>
<span class="token key property">dotenv_codegen</span><span class="token punctuation">=</span><span class="token string">"0.15.0"</span>
<span class="token key property">tokio</span> <span class="token punctuation">=</span> <span class="token punctuation">{</span><span class="token key property">version</span><span class="token punctuation">=</span><span class="token string">"0.2.22"</span><span class="token punctuation">,</span> <span class="token key property">features</span><span class="token punctuation">=</span><span class="token punctuation">[</span><span class="token string">"macros"</span><span class="token punctuation">]</span><span class="token punctuation">}</span>
<span class="token key property">env_logger</span> <span class="token punctuation">=</span><span class="token string">"0.7.1"</span>
<span class="token key property">log</span> <span class="token punctuation">=</span> <span class="token string">"0.4.11"</span>
<span class="token key property">reqwest</span> <span class="token punctuation">=</span> <span class="token punctuation">{</span><span class="token key property">version</span><span class="token punctuation">=</span><span class="token string">"0.10.7"</span><span class="token punctuation">,</span><span class="token key property">features</span><span class="token punctuation">=</span><span class="token punctuation">[</span><span class="token string">"json"</span><span class="token punctuation">]</span><span class="token punctuation">}</span> // New
<span class="token key property">serde_json</span> <span class="token punctuation">=</span> <span class="token string">"1.0.57"</span> // New
<span class="token key property">url</span> <span class="token punctuation">=</span> <span class="token string">"2.1.1"</span>  // New

</code></pre>
<pre class="language-rust"><code class="language-rust"># main<span class="token punctuation">.</span>rs
<span class="token punctuation">...</span>
<span class="token punctuation">...</span>
<span class="token comment">// Make an http request to the post url</span>
<span class="token keyword">let</span> playlist_id <span class="token operator">=</span> <span class="token keyword">match</span> <span class="token namespace">reqwest<span class="token punctuation">::</span></span><span class="token function">get</span><span class="token punctuation">(</span><span class="token operator">&#x26;</span>post_url<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">await</span> <span class="token punctuation">{</span>
    <span class="token comment">// If the response is received convert it in to dynamic json</span>
    <span class="token class-name">Ok</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">match</span> response<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">::</span><span class="token operator">&#x3C;</span><span class="token namespace">serde_json<span class="token punctuation">::</span></span><span class="token class-name">Value</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">await</span> <span class="token punctuation">{</span>
        <span class="token class-name">Ok</span><span class="token punctuation">(</span>json<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
            <span class="token comment">// Get json[0]["data"]["children][0]["url}</span>
            <span class="token comment">// NB: DO NOT USE THIS CODE IN PRODUCTION</span>
            <span class="token keyword">let</span> url <span class="token operator">=</span> <span class="token keyword">match</span> json
                <span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"data"</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"children"</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"data"</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"url"</span><span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                <span class="token comment">// Parse the youtube url from the string</span>
                <span class="token comment">// "https://www.youtube.com/playlist?list=PLf3u8NhoEikhTC5radGrmmqdkOK-xMDoZ"</span>
                <span class="token comment">// after trimming `"`</span>
                <span class="token class-name">Some</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">match</span> <span class="token namespace">url<span class="token punctuation">::</span></span><span class="token class-name">Url</span><span class="token punctuation">::</span><span class="token function">parse</span><span class="token punctuation">(</span>
                    <span class="token operator">&#x26;</span>url<span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">trim_matches</span><span class="token punctuation">(</span><span class="token char string">'\"'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token class-name">Ok</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
                        <span class="token keyword">match</span> <span class="token punctuation">(</span>
                            <span class="token comment">// From the query parameters</span>
                            <span class="token comment">// find the parameter with key "list"</span>
                            url<span class="token punctuation">.</span><span class="token function">query_pairs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>q<span class="token closure-punctuation punctuation">|</span></span> <span class="token punctuation">{</span>
                                q<span class="token number">.0</span> <span class="token operator">==</span> <span class="token string">"list"</span>
                            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                            <span class="token comment">// Also check if the host is youtube</span>
                            <span class="token punctuation">(</span>url<span class="token punctuation">.</span><span class="token function">host_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token class-name">Some</span><span class="token punctuation">(</span><span class="token string">"youtube.com"</span><span class="token punctuation">)</span>
                                <span class="token operator">||</span> url<span class="token punctuation">.</span><span class="token function">host_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                                    <span class="token operator">==</span> <span class="token class-name">Some</span><span class="token punctuation">(</span><span class="token string">"www.youtube.com"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                        <span class="token punctuation">)</span> <span class="token punctuation">{</span>
                            <span class="token punctuation">(</span><span class="token class-name">Some</span><span class="token punctuation">(</span><span class="token punctuation">(</span>_<span class="token punctuation">,</span> val<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
                                <span class="token comment">// Return the url</span>
                                <span class="token class-name">Some</span><span class="token punctuation">(</span>val<span class="token punctuation">.</span><span class="token function">into_owned</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                            <span class="token punctuation">}</span>
                            <span class="token punctuation">(</span>_<span class="token punctuation">,</span> _<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
                                <span class="token macro property">error!</span><span class="token punctuation">(</span>
                                    <span class="token string">"Couldn't find `list` param in url {} for message : {}"</span><span class="token punctuation">,</span>
                                    <span class="token operator">&#x26;</span>url<span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                                    <span class="token operator">&#x26;</span>message<span class="token punctuation">.</span>data<span class="token punctuation">.</span>name
                                <span class="token punctuation">)</span><span class="token punctuation">;</span>
                                <span class="token class-name">None</span>
                            <span class="token punctuation">}</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span>
                    <span class="token comment">// Error Handling</span>
<span class="token punctuation">...</span>

<span class="token macro property">dbg!</span><span class="token punctuation">(</span>playlist_id<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">...</span>
<span class="token punctuation">...</span>
</code></pre>
<blockquote>
<p>A better way to handle the response is to create a struct that mimics the response and just let the <code>.json()</code> method of reqwest do the heavy lifting of converting it into rust types. This will help avoid all the calls to <code>unwrap</code>.</p>
</blockquote>
<blockquote>
<p>The nested matches statements should be replaced by <code>.and_then()</code> for a more cleaner and readable code.</p>
</blockquote>
<pre class="language-shell"><code class="language-shell"><span class="token punctuation">(</span>base<span class="token punctuation">)</span> DeltaManiac @ ~/git/rust/vyom
└─ $ cargo run
Compiling vyom v0.1.0
Finished dev <span class="token punctuation">[</span>unoptimized + debuginfo<span class="token punctuation">]</span> target<span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token keyword">in</span> <span class="token number">5</span>.09s     Running <span class="token variable"><span class="token variable">`</span>target/debug/vyom<span class="token variable">`</span></span>
<span class="token punctuation">[</span>src/main.rs:200<span class="token punctuation">]</span> <span class="token string">"playlist_id"</span> <span class="token operator">=</span> <span class="token string">"PLf3u8NhoEikhTC5radGrmmqdkOK-xMDoZ"</span>
<span class="token punctuation">[</span>src/main.rs:200<span class="token punctuation">]</span> <span class="token string">"playlist_id"</span> <span class="token operator">=</span> <span class="token string">"PLf3u8NhoEikhTC5radGrmmqdkOK-xMDoZ"</span>
</code></pre>
<p>Hooray! We've come a long way since we started, written some atrocious code, contributed to a library and even rolled out our own code instead of using library code to talk to talk to reddit.</p>
<p>I know its getting boring now and we're gonna wrap it up in the next part.</p>
<p>Oh BTW the code can be found on the <code>part-II</code> branch <a href="https://github.com/DeltaManiac/VyomBot">here</a></p>
<h1 id="part-iii"><a aria-hidden="true" class="anchor-heading" href="#part-iii"><svg aria-hidden="true" viewBox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a>Part III</h1>
<p>We've reached the final chapter. The spoils are just ahead of us, lets go grab em.</p>
<h1 id="obtaining-credentials"><a aria-hidden="true" class="anchor-heading" href="#obtaining-credentials"><svg aria-hidden="true" viewBox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a>Obtaining Credentials</h1>
<p>We need to generate a different set of credentials to talk with YouTube. Lets go do that step by step..</p>
<ol>
<li>
<p>Logon to <a href="https://console.developer.google.com">Google Developer Console</a></p>
</li>
<li>
<p>Click <code>Enable Apis and Service</code>
<img src="/assets/images/2020-10-11-18-26-54.png"></p>
</li>
<li>
<p>Search for <code>YouTube Data API v3</code>
<img src="/assets/images/2020-10-11-18-27-09.png"></p>
</li>
<li>
<p>Click the <code>Enable</code> button to enable the API for our account
<img src="/assets/images/2020-10-11-18-27-17.png"></p>
</li>
<li>
<p>Click the <code>Create Credentials</code> button to start creating credentials for us to use.
<img src="/assets/images/2020-10-11-18-27-29.png"></p>
</li>
<li>
<p>We need to first describe what kind of credentials have to be generated. Don't worry, just follow the screenshot.
<img src="/assets/images/2020-10-11-18-27-39.png"></p>
</li>
<li>
<p>We're Done!
<img src="/assets/images/2020-10-11-18-27-51.png"></p>
</li>
</ol>
<h1 id="handling-json-better"><a aria-hidden="true" class="anchor-heading" href="#handling-json-better"><svg aria-hidden="true" viewBox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a>Handling JSON better</h1>
<p>In the last part we used a dynamic JSON to to retrieve the playlist url from Reddit. This time to interact with the YouTube API we wont do that, instead we will one up ourselves and de-serialize the JSON into structs that we define in rust.</p>
<blockquote>
<p>We use <a href="https://crates.io/crates/serde"><code>serde</code></a> to do handle the heavy lifting of JSON de-serialization</p>
</blockquote>
<p>The response of the YouTube API is a bit more well defined than the Reddit API.</p>
<pre class="language-json"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"kind"</span><span class="token operator">:</span> <span class="token string">"youtube#playlistItemListResponse"</span><span class="token punctuation">,</span>
  <span class="token property">"etag"</span><span class="token operator">:</span> <span class="token string">"Fij-lGuELswW5Y6HXEJsEVAZ6Xg"</span><span class="token punctuation">,</span>
  <span class="token property">"nextPageToken"</span><span class="token operator">:</span> <span class="token string">"CAUQAA"</span><span class="token punctuation">,</span>
  <span class="token property">"items"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token property">"kind"</span><span class="token operator">:</span> <span class="token string">"youtube#playlistItem"</span><span class="token punctuation">,</span>
      <span class="token property">"etag"</span><span class="token operator">:</span> <span class="token string">"KC_3PIeEyspbfuA_AplI4dv2ITA"</span><span class="token punctuation">,</span>
      <span class="token property">"id"</span><span class="token operator">:</span> <span class="token string">"UExmM3U4TmhvRWlraFRDNXJhZEdybW1xZGtPSy14TURvWi45ODRDNTg0QjA4NkFBNkQy"</span><span class="token punctuation">,</span>
      <span class="token property">"snippet"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">"publishedAt"</span><span class="token operator">:</span> <span class="token string">"2020-08-05T19:31:06Z"</span><span class="token punctuation">,</span>
        <span class="token property">"channelId"</span><span class="token operator">:</span> <span class="token string">"UC9X86dyEwpbCnpC18qjt33Q"</span><span class="token punctuation">,</span>
        <span class="token property">"title"</span><span class="token operator">:</span> <span class="token string">"Rusty Days 2020 - Hackathon Submissions"</span><span class="token punctuation">,</span>
        <span class="token property">"description"</span><span class="token operator">:</span> <span class="token string">"Rules ► https://rusty-days.org/hackathon/\n\nTeams ►\narrugginiti https://github.com/Rust-Wroclaw/rd-hack-arrugginiti\nBox-Team https://github.com/Rust-Wroclaw/rd-hack-Box-Team\nBrighter3D https://github.com/Rust-Wroclaw/rd-hack-Brighter3D\nhexyoungs https://github.com/Rust-Wroclaw/rd-hack-hexyoungs\nLastMinute https://github.com/Rust-Wroclaw/rd-hack-LastMinute\nplanters https://github.com/Rust-Wroclaw/rd-hack-planters\n\nFollow ►\nFacebook: https://rusty-days.org/facebook\nTwitch: https://rusty-days.org/twitch\nTwitter: https://rusty-days.org/twitter"</span><span class="token punctuation">,</span>
        <span class="token property">"thumbnails"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">"default"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">"url"</span><span class="token operator">:</span> <span class="token string">"https://i.ytimg.com/vi/QaCvUKrxNLI/default.jpg"</span><span class="token punctuation">,</span>
            <span class="token property">"width"</span><span class="token operator">:</span> <span class="token number">120</span><span class="token punctuation">,</span>
            <span class="token property">"height"</span><span class="token operator">:</span> <span class="token number">90</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token property">"medium"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">"url"</span><span class="token operator">:</span> <span class="token string">"https://i.ytimg.com/vi/QaCvUKrxNLI/mqdefault.jpg"</span><span class="token punctuation">,</span>
            <span class="token property">"width"</span><span class="token operator">:</span> <span class="token number">320</span><span class="token punctuation">,</span>
            <span class="token property">"height"</span><span class="token operator">:</span> <span class="token number">180</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token property">"high"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">"url"</span><span class="token operator">:</span> <span class="token string">"https://i.ytimg.com/vi/QaCvUKrxNLI/hqdefault.jpg"</span><span class="token punctuation">,</span>
            <span class="token property">"width"</span><span class="token operator">:</span> <span class="token number">480</span><span class="token punctuation">,</span>
            <span class="token property">"height"</span><span class="token operator">:</span> <span class="token number">360</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token property">"standard"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">"url"</span><span class="token operator">:</span> <span class="token string">"https://i.ytimg.com/vi/QaCvUKrxNLI/sddefault.jpg"</span><span class="token punctuation">,</span>
            <span class="token property">"width"</span><span class="token operator">:</span> <span class="token number">640</span><span class="token punctuation">,</span>
            <span class="token property">"height"</span><span class="token operator">:</span> <span class="token number">480</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token property">"channelTitle"</span><span class="token operator">:</span> <span class="token string">"Rust Wrocław"</span><span class="token punctuation">,</span>
        <span class="token property">"playlistId"</span><span class="token operator">:</span> <span class="token string">"PLf3u8NhoEikhTC5radGrmmqdkOK-xMDoZ"</span><span class="token punctuation">,</span>
        <span class="token property">"position"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token property">"resourceId"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">"kind"</span><span class="token operator">:</span> <span class="token string">"youtube#video"</span><span class="token punctuation">,</span>
          <span class="token property">"videoId"</span><span class="token operator">:</span> <span class="token string">"QaCvUKrxNLI"</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      <span class="token property">"kind"</span><span class="token operator">:</span> <span class="token string">"youtube#playlistItem"</span><span class="token punctuation">,</span>
      <span class="token property">"etag"</span><span class="token operator">:</span> <span class="token string">"EgGMmoAJ81l2BJFspcg1idaKy-8"</span><span class="token punctuation">,</span>
      <span class="token property">"id"</span><span class="token operator">:</span> <span class="token string">"UExmM3U4TmhvRWlraFRDNXJhZEdybW1xZGtPSy14TURvWi5EMEEwRUY5M0RDRTU3NDJC"</span><span class="token punctuation">,</span>
      <span class="token property">"snippet"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">"publishedAt"</span><span class="token operator">:</span> <span class="token string">"2020-08-01T12:17:09Z"</span><span class="token punctuation">,</span>
        <span class="token property">"channelId"</span><span class="token operator">:</span> <span class="token string">"UC9X86dyEwpbCnpC18qjt33Q"</span><span class="token punctuation">,</span>
        <span class="token property">"title"</span><span class="token operator">:</span> <span class="token string">"Rusty Days 2020 - Tim McNamara: How 10 open source projects manage unsafe code"</span><span class="token punctuation">,</span>
        <span class="token property">"description"</span><span class="token operator">:</span> <span class="token string">"Agenda ► https://rusty-days.org/agenda\nSlides ►https://rusty-days.org/assets/slides/08-how-10-open-source-projects-manage-unsafe-code.pdf\nPlaylist with all talks ► https://www.youtube.com/playlist?list=PLf3u8NhoEikhTC5radGrmmqdkOK-xMDoZ\n\nFollow ►\nFacebook: https://rusty-days.org/facebook\nTwitch: https://rusty-days.org/twitch\nTwitter: https://rusty-days.org/twitter\n\nThis video ►\nIs it safe to use unsafe? Learn why some projects need unsafe code and how projects manage its risks.\n\nThis talk will briefly discuss what the unsafe keyword enables and what its risks are. The bulk of time will be spent discussing how projects manage those risks. It finishes by providing recommendations based on that analysis.\n\nProjects surveyed include:\n* Servo (Mozilla)\n* Fuchsia OS (Google)\n* fast_rsync (Dropbox)\n* winrt-rs (Microsoft)\n* Firecracker (AWS)\n* Linkerd2"</span><span class="token punctuation">,</span>
        <span class="token property">"thumbnails"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">"default"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">"url"</span><span class="token operator">:</span> <span class="token string">"https://i.ytimg.com/vi/9M0NQI5Cp2c/default.jpg"</span><span class="token punctuation">,</span>
            <span class="token property">"width"</span><span class="token operator">:</span> <span class="token number">120</span><span class="token punctuation">,</span>
            <span class="token property">"height"</span><span class="token operator">:</span> <span class="token number">90</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token property">"medium"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">"url"</span><span class="token operator">:</span> <span class="token string">"https://i.ytimg.com/vi/9M0NQI5Cp2c/mqdefault.jpg"</span><span class="token punctuation">,</span>
            <span class="token property">"width"</span><span class="token operator">:</span> <span class="token number">320</span><span class="token punctuation">,</span>
            <span class="token property">"height"</span><span class="token operator">:</span> <span class="token number">180</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token property">"high"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">"url"</span><span class="token operator">:</span> <span class="token string">"https://i.ytimg.com/vi/9M0NQI5Cp2c/hqdefault.jpg"</span><span class="token punctuation">,</span>
            <span class="token property">"width"</span><span class="token operator">:</span> <span class="token number">480</span><span class="token punctuation">,</span>
            <span class="token property">"height"</span><span class="token operator">:</span> <span class="token number">360</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token property">"standard"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">"url"</span><span class="token operator">:</span> <span class="token string">"https://i.ytimg.com/vi/9M0NQI5Cp2c/sddefault.jpg"</span><span class="token punctuation">,</span>
            <span class="token property">"width"</span><span class="token operator">:</span> <span class="token number">640</span><span class="token punctuation">,</span>
            <span class="token property">"height"</span><span class="token operator">:</span> <span class="token number">480</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token property">"maxres"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">"url"</span><span class="token operator">:</span> <span class="token string">"https://i.ytimg.com/vi/9M0NQI5Cp2c/maxresdefault.jpg"</span><span class="token punctuation">,</span>
            <span class="token property">"width"</span><span class="token operator">:</span> <span class="token number">1280</span><span class="token punctuation">,</span>
            <span class="token property">"height"</span><span class="token operator">:</span> <span class="token number">720</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token property">"channelTitle"</span><span class="token operator">:</span> <span class="token string">"Rust Wrocław"</span><span class="token punctuation">,</span>
        <span class="token property">"playlistId"</span><span class="token operator">:</span> <span class="token string">"PLf3u8NhoEikhTC5radGrmmqdkOK-xMDoZ"</span><span class="token punctuation">,</span>
        <span class="token property">"position"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
        <span class="token property">"resourceId"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">"kind"</span><span class="token operator">:</span> <span class="token string">"youtube#video"</span><span class="token punctuation">,</span>
          <span class="token property">"videoId"</span><span class="token operator">:</span> <span class="token string">"9M0NQI5Cp2c"</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      <span class="token property">"kind"</span><span class="token operator">:</span> <span class="token string">"youtube#playlistItem"</span><span class="token punctuation">,</span>
      <span class="token property">"etag"</span><span class="token operator">:</span> <span class="token string">"3gm-0cEUcjfm1v1vgh_3EjS6mJg"</span><span class="token punctuation">,</span>
      <span class="token property">"id"</span><span class="token operator">:</span> <span class="token string">"UExmM3U4TmhvRWlraFRDNXJhZEdybW1xZGtPSy14TURvWi40NzZCMERDMjVEN0RFRThB"</span><span class="token punctuation">,</span>
      <span class="token property">"snippet"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">"publishedAt"</span><span class="token operator">:</span> <span class="token string">"2020-08-01T12:16:07Z"</span><span class="token punctuation">,</span>
        <span class="token property">"channelId"</span><span class="token operator">:</span> <span class="token string">"UC9X86dyEwpbCnpC18qjt33Q"</span><span class="token punctuation">,</span>
        <span class="token property">"title"</span><span class="token operator">:</span> <span class="token string">"Rusty Days 2020 - Luca Palmieri: Are we observable yet?"</span><span class="token punctuation">,</span>
        <span class="token property">"description"</span><span class="token operator">:</span> <span class="token string">"Agenda ► https://rusty-days.org/agenda\nSlides ►https://rusty-days.org/assets/slides/07-are-we-observable-yet.pdf\nPlaylist with all talks ► https://www.youtube.com/playlist?list=PLf3u8NhoEikhTC5radGrmmqdkOK-xMDoZ\n\nFollow ►\nFacebook: https://rusty-days.org/facebook\nTwitch: https://rusty-days.org/twitch\nTwitter: https://rusty-days.org/twitter\n\nThis video ►\nIs Rust ready for mainstream usage in backend development?\n\nThere is a lot of buzz around web frameworks while many other (critical!) Day 2 concerns do not get nearly as much attention.\n\nWe will discuss observability: do the tools currently available in the Rust ecosystem cover most of your telemetry needs?\n\nI will walk you through our journey here at TrueLayer when we built our first production backend system in Rust, Donate Direct.\n\nWe will be touching on the state of Rust tooling for logging, metrics and distributed tracing."</span><span class="token punctuation">,</span>
        <span class="token property">"thumbnails"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">"default"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">"url"</span><span class="token operator">:</span> <span class="token string">"https://i.ytimg.com/vi/HtKnLiFwHJM/default.jpg"</span><span class="token punctuation">,</span>
            <span class="token property">"width"</span><span class="token operator">:</span> <span class="token number">120</span><span class="token punctuation">,</span>
            <span class="token property">"height"</span><span class="token operator">:</span> <span class="token number">90</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token property">"medium"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">"url"</span><span class="token operator">:</span> <span class="token string">"https://i.ytimg.com/vi/HtKnLiFwHJM/mqdefault.jpg"</span><span class="token punctuation">,</span>
            <span class="token property">"width"</span><span class="token operator">:</span> <span class="token number">320</span><span class="token punctuation">,</span>
            <span class="token property">"height"</span><span class="token operator">:</span> <span class="token number">180</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token property">"high"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">"url"</span><span class="token operator">:</span> <span class="token string">"https://i.ytimg.com/vi/HtKnLiFwHJM/hqdefault.jpg"</span><span class="token punctuation">,</span>
            <span class="token property">"width"</span><span class="token operator">:</span> <span class="token number">480</span><span class="token punctuation">,</span>
            <span class="token property">"height"</span><span class="token operator">:</span> <span class="token number">360</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token property">"standard"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">"url"</span><span class="token operator">:</span> <span class="token string">"https://i.ytimg.com/vi/HtKnLiFwHJM/sddefault.jpg"</span><span class="token punctuation">,</span>
            <span class="token property">"width"</span><span class="token operator">:</span> <span class="token number">640</span><span class="token punctuation">,</span>
            <span class="token property">"height"</span><span class="token operator">:</span> <span class="token number">480</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token property">"maxres"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">"url"</span><span class="token operator">:</span> <span class="token string">"https://i.ytimg.com/vi/HtKnLiFwHJM/maxresdefault.jpg"</span><span class="token punctuation">,</span>
            <span class="token property">"width"</span><span class="token operator">:</span> <span class="token number">1280</span><span class="token punctuation">,</span>
            <span class="token property">"height"</span><span class="token operator">:</span> <span class="token number">720</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token property">"channelTitle"</span><span class="token operator">:</span> <span class="token string">"Rust Wrocław"</span><span class="token punctuation">,</span>
        <span class="token property">"playlistId"</span><span class="token operator">:</span> <span class="token string">"PLf3u8NhoEikhTC5radGrmmqdkOK-xMDoZ"</span><span class="token punctuation">,</span>
        <span class="token property">"position"</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
        <span class="token property">"resourceId"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">"kind"</span><span class="token operator">:</span> <span class="token string">"youtube#video"</span><span class="token punctuation">,</span>
          <span class="token property">"videoId"</span><span class="token operator">:</span> <span class="token string">"HtKnLiFwHJM"</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      <span class="token property">"kind"</span><span class="token operator">:</span> <span class="token string">"youtube#playlistItem"</span><span class="token punctuation">,</span>
      <span class="token property">"etag"</span><span class="token operator">:</span> <span class="token string">"2C9sX2xuTowOxjn0m95AH53JiA4"</span><span class="token punctuation">,</span>
      <span class="token property">"id"</span><span class="token operator">:</span> <span class="token string">"UExmM3U4TmhvRWlraFRDNXJhZEdybW1xZGtPSy14TURvWi5GNjNDRDREMDQxOThCMDQ2"</span><span class="token punctuation">,</span>
      <span class="token property">"snippet"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">"publishedAt"</span><span class="token operator">:</span> <span class="token string">"2020-07-31T11:28:34Z"</span><span class="token punctuation">,</span>
        <span class="token property">"channelId"</span><span class="token operator">:</span> <span class="token string">"UC9X86dyEwpbCnpC18qjt33Q"</span><span class="token punctuation">,</span>
        <span class="token property">"title"</span><span class="token operator">:</span> <span class="token string">"Rusty Days 2020 - Jan-Erik Rediger: Leveraging Rust to build cross-platform mobile libraries"</span><span class="token punctuation">,</span>
        <span class="token property">"description"</span><span class="token operator">:</span> <span class="token string">"Agenda ► https://rusty-days.org/agenda\nSlides ►https://rusty-days.org/assets/slides/06-cross-platform-mobile-libraries.pdf\nPlaylist with all talks ► https://www.youtube.com/playlist?list=PLf3u8NhoEikhTC5radGrmmqdkOK-xMDoZ\n\nFollow ►\nFacebook: https://rusty-days.org/facebook\nTwitch: https://rusty-days.org/twitch\nTwitter: https://rusty-days.org/twitter\n\n\nThis video ►\nAt Mozilla, Firefox is not the only product we ship. Many others — including a variety of smartphone applications, and certainly not just web browsers — are built by various teams across the organization. These applications are composed of a multitude of libraries which, when possible, are reused across platforms.\n\nIn the past year we used Rust to rebuild one of these libraries: the library powering the telemetry in our mobile applications is now integrated into Android and iOS applications and will soon be powering our Desktop platforms as well.\n\nThis talk will showcase how this small team managed to create a cross-platform Rust library, and ship it to a bunch of platforms all at once."</span><span class="token punctuation">,</span>
        <span class="token property">"thumbnails"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">"default"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">"url"</span><span class="token operator">:</span> <span class="token string">"https://i.ytimg.com/vi/j5rczOF7pzg/default.jpg"</span><span class="token punctuation">,</span>
            <span class="token property">"width"</span><span class="token operator">:</span> <span class="token number">120</span><span class="token punctuation">,</span>
            <span class="token property">"height"</span><span class="token operator">:</span> <span class="token number">90</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token property">"medium"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">"url"</span><span class="token operator">:</span> <span class="token string">"https://i.ytimg.com/vi/j5rczOF7pzg/mqdefault.jpg"</span><span class="token punctuation">,</span>
            <span class="token property">"width"</span><span class="token operator">:</span> <span class="token number">320</span><span class="token punctuation">,</span>
            <span class="token property">"height"</span><span class="token operator">:</span> <span class="token number">180</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token property">"high"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">"url"</span><span class="token operator">:</span> <span class="token string">"https://i.ytimg.com/vi/j5rczOF7pzg/hqdefault.jpg"</span><span class="token punctuation">,</span>
            <span class="token property">"width"</span><span class="token operator">:</span> <span class="token number">480</span><span class="token punctuation">,</span>
            <span class="token property">"height"</span><span class="token operator">:</span> <span class="token number">360</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token property">"standard"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">"url"</span><span class="token operator">:</span> <span class="token string">"https://i.ytimg.com/vi/j5rczOF7pzg/sddefault.jpg"</span><span class="token punctuation">,</span>
            <span class="token property">"width"</span><span class="token operator">:</span> <span class="token number">640</span><span class="token punctuation">,</span>
            <span class="token property">"height"</span><span class="token operator">:</span> <span class="token number">480</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token property">"maxres"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">"url"</span><span class="token operator">:</span> <span class="token string">"https://i.ytimg.com/vi/j5rczOF7pzg/maxresdefault.jpg"</span><span class="token punctuation">,</span>
            <span class="token property">"width"</span><span class="token operator">:</span> <span class="token number">1280</span><span class="token punctuation">,</span>
            <span class="token property">"height"</span><span class="token operator">:</span> <span class="token number">720</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token property">"channelTitle"</span><span class="token operator">:</span> <span class="token string">"Rust Wrocław"</span><span class="token punctuation">,</span>
        <span class="token property">"playlistId"</span><span class="token operator">:</span> <span class="token string">"PLf3u8NhoEikhTC5radGrmmqdkOK-xMDoZ"</span><span class="token punctuation">,</span>
        <span class="token property">"position"</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
        <span class="token property">"resourceId"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">"kind"</span><span class="token operator">:</span> <span class="token string">"youtube#video"</span><span class="token punctuation">,</span>
          <span class="token property">"videoId"</span><span class="token operator">:</span> <span class="token string">"j5rczOF7pzg"</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      <span class="token property">"kind"</span><span class="token operator">:</span> <span class="token string">"youtube#playlistItem"</span><span class="token punctuation">,</span>
      <span class="token property">"etag"</span><span class="token operator">:</span> <span class="token string">"pB_4gb7ai1HOgVLz8Jx9SJB1P_g"</span><span class="token punctuation">,</span>
      <span class="token property">"id"</span><span class="token operator">:</span> <span class="token string">"UExmM3U4TmhvRWlraFRDNXJhZEdybW1xZGtPSy14TURvWi45NDk1REZENzhEMzU5MDQz"</span><span class="token punctuation">,</span>
      <span class="token property">"snippet"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">"publishedAt"</span><span class="token operator">:</span> <span class="token string">"2020-07-31T09:06:09Z"</span><span class="token punctuation">,</span>
        <span class="token property">"channelId"</span><span class="token operator">:</span> <span class="token string">"UC9X86dyEwpbCnpC18qjt33Q"</span><span class="token punctuation">,</span>
        <span class="token property">"title"</span><span class="token operator">:</span> <span class="token string">"Rusty Days 2020 -  Nell Shamrell - Harrington: The Rust Borrow Checker - A Deep Dive"</span><span class="token punctuation">,</span>
        <span class="token property">"description"</span><span class="token operator">:</span> <span class="token string">"Agenda ► https://rusty-days.org/agenda\nSlides ►https://rusty-days.org/assets/slides/05-the-rust-borrow-checker.pdf\nPlaylist with all talks ► https://www.youtube.com/playlist?list=PLf3u8NhoEikhTC5radGrmmqdkOK-xMDoZ\n\nFollow ►\nFacebook: https://rusty-days.org/facebook\nTwitch: https://rusty-days.org/twitch\nTwitter: https://rusty-days.org/twitter\n\nThis video ►\n\nThe Rust compiler's borrow checker is critical for ensuring safe Rust code. Even more critical, however, is how the borrow checker provides useful, automated guidance on how to write safe code when the check fails. \n\nEarly in your Rust journey, it may feel like you are fighting the borrow checker. Come to this talk to learn how you can transition from fighting the borrow checker to using its guidance to write safer and more powerful code at any experience level. Walk away not only understanding the what and the how of the borrow checker - but why it works the way it does - and why it is so critical to both the technical functionality and philosophy of Rust."</span><span class="token punctuation">,</span>
        <span class="token property">"thumbnails"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">"default"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">"url"</span><span class="token operator">:</span> <span class="token string">"https://i.ytimg.com/vi/knhpe5IUnlE/default.jpg"</span><span class="token punctuation">,</span>
            <span class="token property">"width"</span><span class="token operator">:</span> <span class="token number">120</span><span class="token punctuation">,</span>
            <span class="token property">"height"</span><span class="token operator">:</span> <span class="token number">90</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token property">"medium"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">"url"</span><span class="token operator">:</span> <span class="token string">"https://i.ytimg.com/vi/knhpe5IUnlE/mqdefault.jpg"</span><span class="token punctuation">,</span>
            <span class="token property">"width"</span><span class="token operator">:</span> <span class="token number">320</span><span class="token punctuation">,</span>
            <span class="token property">"height"</span><span class="token operator">:</span> <span class="token number">180</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token property">"high"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">"url"</span><span class="token operator">:</span> <span class="token string">"https://i.ytimg.com/vi/knhpe5IUnlE/hqdefault.jpg"</span><span class="token punctuation">,</span>
            <span class="token property">"width"</span><span class="token operator">:</span> <span class="token number">480</span><span class="token punctuation">,</span>
            <span class="token property">"height"</span><span class="token operator">:</span> <span class="token number">360</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token property">"standard"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">"url"</span><span class="token operator">:</span> <span class="token string">"https://i.ytimg.com/vi/knhpe5IUnlE/sddefault.jpg"</span><span class="token punctuation">,</span>
            <span class="token property">"width"</span><span class="token operator">:</span> <span class="token number">640</span><span class="token punctuation">,</span>
            <span class="token property">"height"</span><span class="token operator">:</span> <span class="token number">480</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token property">"maxres"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">"url"</span><span class="token operator">:</span> <span class="token string">"https://i.ytimg.com/vi/knhpe5IUnlE/maxresdefault.jpg"</span><span class="token punctuation">,</span>
            <span class="token property">"width"</span><span class="token operator">:</span> <span class="token number">1280</span><span class="token punctuation">,</span>
            <span class="token property">"height"</span><span class="token operator">:</span> <span class="token number">720</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token property">"channelTitle"</span><span class="token operator">:</span> <span class="token string">"Rust Wrocław"</span><span class="token punctuation">,</span>
        <span class="token property">"playlistId"</span><span class="token operator">:</span> <span class="token string">"PLf3u8NhoEikhTC5radGrmmqdkOK-xMDoZ"</span><span class="token punctuation">,</span>
        <span class="token property">"position"</span><span class="token operator">:</span> <span class="token number">4</span><span class="token punctuation">,</span>
        <span class="token property">"resourceId"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">"kind"</span><span class="token operator">:</span> <span class="token string">"youtube#video"</span><span class="token punctuation">,</span>
          <span class="token property">"videoId"</span><span class="token operator">:</span> <span class="token string">"knhpe5IUnlE"</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">"pageInfo"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"totalResults"</span><span class="token operator">:</span> <span class="token number">9</span><span class="token punctuation">,</span>
    <span class="token property">"resultsPerPage"</span><span class="token operator">:</span> <span class="token number">5</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>This JSON response can be constructed from simple structs that we can define.
The <code>#[derive(Deserialize)]</code> helps <code>serde</code> understand that it can use this struct to deserialize json into by matching the fields of the struct to those of that in the JSON body.</p>
<blockquote>
<p><code>serde</code> is an amazing library and a bit too vast to explain in this post.</p>
</blockquote>
<pre class="language-rust"><code class="language-rust"># main<span class="token punctuation">.</span>rs

<span class="token attribute attr-name">#[derive(Debug, Deserialize)]</span>
<span class="token keyword">struct</span> <span class="token type-definition class-name">Snippet</span> <span class="token punctuation">{</span>
    title<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">,</span>
    position<span class="token punctuation">:</span> <span class="token keyword">i32</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
<span class="token attribute attr-name">#[derive(Debug, Deserialize)]</span>
<span class="token keyword">struct</span> <span class="token type-definition class-name">Item</span> <span class="token punctuation">{</span>
    kind<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">,</span>
    snippet<span class="token punctuation">:</span> <span class="token class-name">Snippet</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
<span class="token attribute attr-name">#[derive(Debug, Deserialize)]</span>
<span class="token keyword">struct</span> <span class="token type-definition class-name">YoutubeResponse</span> <span class="token punctuation">{</span>
    items<span class="token punctuation">:</span> <span class="token class-name">Vec</span><span class="token operator">&#x3C;</span><span class="token class-name">Item</span><span class="token operator">></span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre>
<p>Now that we have defined our struct lets go ahead and call the YouTube API.</p>
<pre class="language-rust"><code class="language-rust"># main<span class="token punctuation">.</span>rs

<span class="token keyword">let</span> <span class="token keyword">mut</span> reply<span class="token punctuation">:</span> <span class="token class-name">String</span> <span class="token operator">=</span>
    <span class="token string">"Sorry couldn't find the YouTube Link! :("</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">if</span> playlist_id<span class="token punctuation">.</span><span class="token function">is_some</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Generate api url</span>
    <span class="token keyword">let</span> url <span class="token operator">=</span> <span class="token macro property">format!</span><span class="token punctuation">(</span><span class="token string">"https://www.googleapis.com/youtube/v3/playlistItems?part=snippet&#x26;playlistId={}&#x26;key={}&#x26;maxResults={}"</span><span class="token punctuation">,</span>playlist_id<span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token constant">YT_KEY</span><span class="token punctuation">,</span> <span class="token constant">YT_MAX_RESULT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token comment">// Fire the API</span>
    <span class="token keyword">let</span> playlist_items <span class="token operator">=</span> <span class="token keyword">match</span> <span class="token namespace">reqwest<span class="token punctuation">::</span></span><span class="token function">get</span><span class="token punctuation">(</span><span class="token operator">&#x26;</span>url<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">await</span> <span class="token punctuation">{</span>
                        <span class="token comment">// Try to convert the response to our struct</span>
        <span class="token class-name">Ok</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">match</span> response<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">::</span><span class="token operator">&#x3C;</span><span class="token class-name">YoutubeResponse</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">await</span> <span class="token punctuation">{</span>
            <span class="token comment">// Return the array of Item</span>
            <span class="token class-name">Ok</span><span class="token punctuation">(</span>yt_response<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token class-name">Some</span><span class="token punctuation">(</span>yt_response<span class="token punctuation">.</span>items<span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token class-name">Err</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
                <span class="token macro property">error!</span><span class="token punctuation">(</span>
                    <span class="token string">"Couldn't parse playlist response for comment {} reason : {}"</span><span class="token punctuation">,</span>
                        <span class="token operator">&#x26;</span>message<span class="token punctuation">.</span>data<span class="token punctuation">.</span>name<span class="token punctuation">,</span> e
                            <span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">None</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token class-name">Err</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
            <span class="token macro property">error!</span><span class="token punctuation">(</span>
                <span class="token string">"Couldn't fetch YouTube data for comment {} reason : {}"</span><span class="token punctuation">,</span>
                <span class="token operator">&#x26;</span>message<span class="token punctuation">.</span>data<span class="token punctuation">.</span>name<span class="token punctuation">,</span> e
            <span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">None</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token comment">//Loop over each item and then create the message.</span>
    <span class="token keyword">if</span> playlist_items<span class="token punctuation">.</span><span class="token function">is_some</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> items <span class="token operator">=</span> playlist_items<span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> items<span class="token punctuation">.</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">0</span> <span class="token punctuation">{</span>
            reply <span class="token operator">=</span> <span class="token string">"Playlist Items: \n"</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">for</span> item <span class="token keyword">in</span> items <span class="token punctuation">{</span>
                reply<span class="token punctuation">.</span><span class="token function">push_str</span><span class="token punctuation">(</span>
                    <span class="token macro property">format!</span><span class="token punctuation">(</span><span class="token string">"\n {} \n"</span><span class="token punctuation">,</span> item<span class="token punctuation">.</span>snippet<span class="token punctuation">.</span>title<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">as_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>We first define <code>reply</code> with the string that we want to respond with if we fail to identify the playlist id.
If we have a playlistID we then call YouTube API with the key we generated earlier. We then extract the items of the playlist generated our reply text. The code that we have written in the previous part already handles replying to the message.
Lets try it out!</p>
<pre class="language-shell"><code class="language-shell"><span class="token punctuation">(</span>base<span class="token punctuation">)</span> DeltaManiac @ ~/git/rust/vyom
└─ $ cargo run
   Compiling vyom v0.1.0
    Finished dev <span class="token punctuation">[</span>unoptimized + debuginfo<span class="token punctuation">]</span> target<span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token keyword">in</span> <span class="token number">5</span>.79s
     Running <span class="token variable"><span class="token variable">`</span>target/debug/vyom<span class="token variable">`</span></span>
<span class="token punctuation">[</span><span class="token number">2020</span>-08-11T18:46:46Z INFO  vyom<span class="token punctuation">]</span> Replied to t1_g14nya9
<span class="token punctuation">[</span><span class="token number">2020</span>-08-11T18:46:46Z INFO  vyom<span class="token punctuation">]</span> Marked t1_g14nya9 as <span class="token builtin class-name">read</span>
</code></pre>
<p>And on Reddit it looks just as beautiful!
<img src="/assets/images/2020-10-11-18-30-04.png"></p>
<h1 id="fin"><a aria-hidden="true" class="anchor-heading" href="#fin"><svg aria-hidden="true" viewBox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a>Fin</h1>
<p>Thanks for joining along while we built our first bot :heart:.
If this journey has taught you something, feel free to give a shout out!</p>
<hr>
<h2 id="backlinks"><a aria-hidden="true" class="anchor-heading" href="#backlinks"><svg aria-hidden="true" viewBox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a>Backlinks</h2>
<ul>
<li><a href="https://deltamaniac.github.io/notes/A6TBKYAcFVjBqZpdbHuaS.html">Rust</a></li>
</ul><span id="navId" data="rtmKu8OspeorpBFZQCAGS"></span>

                
      </section>

      
    </div>

    
  </article>

  
  
</div>

        <div class="thumbs feedback_trigger right-bottom"></div>

        
          <hr>
          <footer>
            
            

            
              <div class="d-flex mt-2">
              <p class="text-small text-grey-dk-000 mb-0 mr-2">
                Page last modified: <span class="d-inline-block">17/10/2020</span>.
              </p>
            
                
                  <p class="text-small text-grey-dk-000 mb-0">
                    <a href="https://github.com/DeltaManiac/deltamaniac.github.io/edit/main/vault/rust.bots.reddit.md" id="edit-this-page">Edit this page on GitHub</a>
                  </p>
                
              </div>
          </footer>
        
    </div>
</div>


  

  <div class="search-overlay"></div>

</div>

</body>
</html>
