<!DOCTYPE html>

<html lang="en-US"><head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
  <title> - </title>
  

  <link rel="shortcut icon" href="deltamaniac.github.io/favicon.ico" type="image/x-icon">
  <link rel="stylesheet" href="deltamaniac.github.io/assets/css/just-the-docs-default.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/default.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">

  
    <script type="text/javascript" src="deltamaniac.github.io/assets/js/vendor/lunr.min.js"></script>
  
  <script type="text/javascript" src="deltamaniac.github.io/assets/js/just-the-docs.js"></script>

  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>undefined - Page 7</title>

<meta name="description" content="">
<meta name="robots" content="noindex,follow">
<meta name="author" content="">

<link rel="canonical" href="deltamaniac.github.io/notes/b7749cd1-50ef-4a06-9ff3-08fec8a8c80a.html">

<meta property="og:title" content="undefined - Page 7">
<meta property="og:type" content="article">
<meta property="og:url" content="deltamaniac.github.io/notes/b7749cd1-50ef-4a06-9ff3-08fec8a8c80a.html">
<meta property="og:description" content="">
<meta property="og:image" content="deltamaniac.github.ioundefined">

<meta name="twitter:card" content="summary">

<meta name="twitter:url" content="deltamaniac.github.io/notes/b7749cd1-50ef-4a06-9ff3-08fec8a8c80a.html">
<meta name="twitter:title" content="undefined - Page 7">
<meta name="twitter:description" content="">
<meta name="twitter:image" content="deltamaniac.github.ioundefined">



</head>


<body>
    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
      <symbol id="svg-link" viewBox="0 0 24 24">
        <title>Link</title>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link">
          <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path>
        </svg>
      </symbol>
      <symbol id="svg-search" viewBox="0 0 24 24">
        <title>Search</title>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search">
          <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line>
        </svg>
      </symbol>
      <symbol id="svg-menu" viewBox="0 0 24 24">
        <title>Menu</title>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu">
          <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line>
        </svg>
      </symbol>
      <symbol id="svg-arrow-right" viewBox="0 0 24 24">
        <title>Expand</title>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right">
          <polyline points="9 18 15 12 9 6"></polyline>
        </svg>
      </symbol>
      <symbol id="svg-doc" viewBox="0 0 24 24">
        <title>Document</title>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file">
          <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline>
        </svg>
      </symbol>
    </svg>
  
    <div class="side-bar">
      <div class="site-header">
        <a href="deltamaniac.github.io" class="site-title lh-tight">
  

 </a>
        <a href="#" id="menu-button" class="site-button">
          <svg viewBox="0 0 24 24" class="icon"><use xlink:href="#svg-menu"></use></svg>
        </a>
      </div>

      <nav role="navigation" aria-label="Main" id="site-nav" class="site-nav">
        <ul class="nav-list">
<li class="nav-list-item" id="root">
<a id="a-root" href="deltamaniac.github.io" class="nav-list-link">Root</a>
</li>
<li class="nav-list-item" id="941adaa5-d22f-4bf9-831a-35bb5ac4100c">
<a href="" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a>
<a id="a-941adaa5-d22f-4bf9-831a-35bb5ac4100c" href="deltamaniac.github.io/notes/941adaa5-d22f-4bf9-831a-35bb5ac4100c.html" class="nav-list-link">Advent of Code</a>
<ul class="nav-list">
<li class="nav-list-item" id="bb5ef214-cf28-4a7d-9c1e-15e8e9829ca3">
<a href="" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a>
<a id="a-bb5ef214-cf28-4a7d-9c1e-15e8e9829ca3" href="deltamaniac.github.io/notes/bb5ef214-cf28-4a7d-9c1e-15e8e9829ca3.html" class="nav-list-link">2015</a>
<ul class="nav-list">
<li class="nav-list-item" id="dcb2143d-1df6-4c9e-9289-cbc76082ace2">
<a id="a-dcb2143d-1df6-4c9e-9289-cbc76082ace2" href="deltamaniac.github.io/notes/dcb2143d-1df6-4c9e-9289-cbc76082ace2.html" class="nav-list-link">Day 1</a>
</li>
<li class="nav-list-item" id="0359877a-1c2d-4363-aef5-41dcb3d086ca">
<a id="a-0359877a-1c2d-4363-aef5-41dcb3d086ca" href="deltamaniac.github.io/notes/0359877a-1c2d-4363-aef5-41dcb3d086ca.html" class="nav-list-link">Day 2</a>
</li>
<li class="nav-list-item" id="17fb47c1-bbab-4343-bdb4-3e9910c24944">
<a id="a-17fb47c1-bbab-4343-bdb4-3e9910c24944" href="deltamaniac.github.io/notes/17fb47c1-bbab-4343-bdb4-3e9910c24944.html" class="nav-list-link">Day 3</a>
</li>
<li class="nav-list-item" id="f6d391d5-db6b-46bb-a432-4a6592355b34">
<a id="a-f6d391d5-db6b-46bb-a432-4a6592355b34" href="deltamaniac.github.io/notes/f6d391d5-db6b-46bb-a432-4a6592355b34.html" class="nav-list-link">Day 4</a>
</li>
</ul>
</li>
</ul>
</li>
<li class="nav-list-item" id="7f7613d7-a18e-4c9f-aac2-59a0c98561c3">
<a href="" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a>
<a id="a-7f7613d7-a18e-4c9f-aac2-59a0c98561c3" href="deltamaniac.github.io/notes/7f7613d7-a18e-4c9f-aac2-59a0c98561c3.html" class="nav-list-link">Games</a>
<ul class="nav-list">
<li class="nav-list-item" id="317f9bc7-7931-429b-9fa9-1737534e8a1a">
<a href="" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a>
<a id="a-317f9bc7-7931-429b-9fa9-1737534e8a1a" href="deltamaniac.github.io/notes/317f9bc7-7931-429b-9fa9-1737534e8a1a.html" class="nav-list-link">Destiny</a>
<ul class="nav-list">
<li class="nav-list-item" id="022f0d91-14d1-4ee7-904b-18f474b84c49">
<a href="" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a>
<a id="a-022f0d91-14d1-4ee7-904b-18f474b84c49" href="deltamaniac.github.io/notes/022f0d91-14d1-4ee7-904b-18f474b84c49.html" class="nav-list-link">Gamerdungeon</a>
<ul class="nav-list">
<li class="nav-list-item" id="aac395c2-48dc-4c24-afb8-310bb7757e54">
<a href="" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a>
<a id="a-aac395c2-48dc-4c24-afb8-310bb7757e54" href="deltamaniac.github.io/notes/aac395c2-48dc-4c24-afb8-310bb7757e54.html" class="nav-list-link">Lore</a>
<ul class="nav-list">
<li class="nav-list-item" id="b4d422fa-d456-428e-8e48-b3d6b2a5cbcb">
<a id="a-b4d422fa-d456-428e-8e48-b3d6b2a5cbcb" href="deltamaniac.github.io/notes/b4d422fa-d456-428e-8e48-b3d6b2a5cbcb.html" class="nav-list-link">Chimi</a>
</li>
<li class="nav-list-item" id="2bfcbd54-a3b5-40dc-9192-4f7607233d13">
<a id="a-2bfcbd54-a3b5-40dc-9192-4f7607233d13" href="deltamaniac.github.io/notes/2bfcbd54-a3b5-40dc-9192-4f7607233d13.html" class="nav-list-link">Lucan</a>
</li>
<li class="nav-list-item" id="ea93896f-e8c2-49c3-a90f-5ebe71795a75">
<a id="a-ea93896f-e8c2-49c3-a90f-5ebe71795a75" href="deltamaniac.github.io/notes/ea93896f-e8c2-49c3-a90f-5ebe71795a75.html" class="nav-list-link">Swift</a>
</li>
<li class="nav-list-item" id="81183eb8-e34d-4588-aff1-bd8592e91791">
<a id="a-81183eb8-e34d-4588-aff1-bd8592e91791" href="deltamaniac.github.io/notes/81183eb8-e34d-4588-aff1-bd8592e91791.html" class="nav-list-link">Zek</a>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="nav-list-item" id="5c421f85-a4d9-4581-9b82-e1aebfb60420">
<a href="" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a>
<a id="a-5c421f85-a4d9-4581-9b82-e1aebfb60420" href="deltamaniac.github.io/notes/5c421f85-a4d9-4581-9b82-e1aebfb60420.html" class="nav-list-link">Tis-100</a>
<ul class="nav-list">
<li class="nav-list-item" id="773dd5dc-f267-4a01-bb29-e433bcabca8c">
<a href="" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a>
<a id="a-773dd5dc-f267-4a01-bb29-e433bcabca8c" href="deltamaniac.github.io/notes/773dd5dc-f267-4a01-bb29-e433bcabca8c.html" class="nav-list-link">Segment</a>
<ul class="nav-list">
<li class="nav-list-item" id="2f9f6f35-8e0d-4016-b62b-8c76b7710d46">
<a id="a-2f9f6f35-8e0d-4016-b62b-8c76b7710d46" href="deltamaniac.github.io/notes/2f9f6f35-8e0d-4016-b62b-8c76b7710d46.html" class="nav-list-link">00150</a>
</li>
<li class="nav-list-item" id="70899221-a056-4a90-bd18-eb70f749b27b">
<a id="a-70899221-a056-4a90-bd18-eb70f749b27b" href="deltamaniac.github.io/notes/70899221-a056-4a90-bd18-eb70f749b27b.html" class="nav-list-link">10981</a>
</li>
<li class="nav-list-item" id="c2e71c4f-5214-4c80-a678-4e2f1cde11ad">
<a id="a-c2e71c4f-5214-4c80-a678-4e2f1cde11ad" href="deltamaniac.github.io/notes/c2e71c4f-5214-4c80-a678-4e2f1cde11ad.html" class="nav-list-link">20176</a>
</li>
<li class="nav-list-item" id="54c5c95f-6a43-444d-bca9-55842b793a8a">
<a id="a-54c5c95f-6a43-444d-bca9-55842b793a8a" href="deltamaniac.github.io/notes/54c5c95f-6a43-444d-bca9-55842b793a8a.html" class="nav-list-link">21340</a>
</li>
<li class="nav-list-item" id="18792729-fd0e-457a-bb67-fd1cd7e1dcfc">
<a id="a-18792729-fd0e-457a-bb67-fd1cd7e1dcfc" href="deltamaniac.github.io/notes/18792729-fd0e-457a-bb67-fd1cd7e1dcfc.html" class="nav-list-link">22280</a>
</li>
<li class="nav-list-item" id="c6de8a46-6510-46dd-a8fd-9eac3b993fb3">
<a id="a-c6de8a46-6510-46dd-a8fd-9eac3b993fb3" href="deltamaniac.github.io/notes/c6de8a46-6510-46dd-a8fd-9eac3b993fb3.html" class="nav-list-link">30647</a>
</li>
<li class="nav-list-item" id="de4f35ff-985c-40fb-af0c-5c8440a6b73b">
<a id="a-de4f35ff-985c-40fb-af0c-5c8440a6b73b" href="deltamaniac.github.io/notes/de4f35ff-985c-40fb-af0c-5c8440a6b73b.html" class="nav-list-link">31904</a>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="nav-list-item" id="72f47187-278f-4a21-a56f-4abda62fea03">
<a href="" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a>
<a id="a-72f47187-278f-4a21-a56f-4abda62fea03" href="deltamaniac.github.io/notes/72f47187-278f-4a21-a56f-4abda62fea03.html" class="nav-list-link">Go</a>
<ul class="nav-list">
<li class="nav-list-item" id="8e750d99-269a-4d2c-ba5d-35903d2b04c9">
<a href="" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a>
<a id="a-8e750d99-269a-4d2c-ba5d-35903d2b04c9" href="deltamaniac.github.io/notes/8e750d99-269a-4d2c-ba5d-35903d2b04c9.html" class="nav-list-link">Framework</a>
<ul class="nav-list">
<li class="nav-list-item" id="8f8f58c7-8ffc-4b8b-98e9-c4e8eb563e70">
<a id="a-8f8f58c7-8ffc-4b8b-98e9-c4e8eb563e70" href="deltamaniac.github.io/notes/8f8f58c7-8ffc-4b8b-98e9-c4e8eb563e70.html" class="nav-list-link">Gokit</a>
</li>
</ul>
</li>
</ul>
</li>
<li class="nav-list-item" id="bbb1f7dc-0a49-4a91-9578-9fff08abaaf8">
<a href="" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a>
<a id="a-bbb1f7dc-0a49-4a91-9578-9fff08abaaf8" href="deltamaniac.github.io/notes/bbb1f7dc-0a49-4a91-9578-9fff08abaaf8.html" class="nav-list-link">Kafka</a>
<ul class="nav-list">
<li class="nav-list-item" id="21de6682-6669-43c0-8d66-68ceb823205d">
<a id="a-21de6682-6669-43c0-8d66-68ceb823205d" href="deltamaniac.github.io/notes/21de6682-6669-43c0-8d66-68ceb823205d.html" class="nav-list-link">Consumer</a>
</li>
<li class="nav-list-item" id="b7749cd1-50ef-4a06-9ff3-08fec8a8c80a">
<a id="a-b7749cd1-50ef-4a06-9ff3-08fec8a8c80a" href="deltamaniac.github.io/notes/b7749cd1-50ef-4a06-9ff3-08fec8a8c80a.html" class="nav-list-link">Producer</a>
</li>
</ul>
</li>
<li class="nav-list-item" id="18962325-b097-4283-9f8e-23a89a24511b">
<a href="" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a>
<a id="a-18962325-b097-4283-9f8e-23a89a24511b" href="deltamaniac.github.io/notes/18962325-b097-4283-9f8e-23a89a24511b.html" class="nav-list-link">Rust</a>
<ul class="nav-list">
<li class="nav-list-item" id="947feb8a-ba58-4fd9-85fb-c599a93c13f3">
<a href="" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a>
<a id="a-947feb8a-ba58-4fd9-85fb-c599a93c13f3" href="deltamaniac.github.io/notes/947feb8a-ba58-4fd9-85fb-c599a93c13f3.html" class="nav-list-link">Bots</a>
<ul class="nav-list">
<li class="nav-list-item" id="ecfd8eb4-cdb2-459a-ab1e-8ced6abd9498">
<a id="a-ecfd8eb4-cdb2-459a-ab1e-8ced6abd9498" href="deltamaniac.github.io/notes/ecfd8eb4-cdb2-459a-ab1e-8ced6abd9498.html" class="nav-list-link">Reddit</a>
</li>
</ul>
</li>
</ul>
</li>
<li class="nav-list-item" id="42bff885-549f-422e-8ef8-d17ecd01ca52">
<a id="a-42bff885-549f-422e-8ef8-d17ecd01ca52" href="deltamaniac.github.io/notes/42bff885-549f-422e-8ef8-d17ecd01ca52.html" class="nav-list-link">Todo</a>
</li>
</ul>
      </nav>
      <footer class="site-footer">
        🌱 with 💕 using <a href="https://www.dendron.so/"> Dendron 🌲 </a>
      </footer>
    </div>
    <div class="main" id="top">
        <div id="main-header" class="main-header">
          
            <div class="search">
              <div class="search-input-wrap">
                <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search " aria-label="Search " autocomplete="off">
                <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label>
              </div>
              <div id="search-results" class="search-results"></div>
            </div>
          
          
    </div>
    <div id="main-content-wrap" class="main-content-wrap">
      
        
          <nav aria-label="Breadcrumb" class="breadcrumb-nav">
            <ol class="breadcrumb-nav-list"><li class="breadcrumb-nav-list-item"><a href="deltamaniac.github.io">Root</a></li><li class="breadcrumb-nav-list-item"><a href="deltamaniac.github.io/notes/bbb1f7dc-0a49-4a91-9578-9fff08abaaf8.html">Kafka</a></li><li class="breadcrumb-nav-list-item">Producer</li></ol>
          </nav>
        
      
      <div id="main-content" class="main-content" role="main">

        
  
        

        <h1 id="producer"><a aria-hidden="true" class="anchor-heading" href="#producer"><svg aria-hidden="true" viewBox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a>Producer</h1>
<p>Kafka has a binary wire protocol.This means that it is possible for applications to read messages from Kafka or write messages to Kafka simply by sending the correct byte sequences to Kafka’s network port.</p>
<p>Key Structure is <code>ProducerRecord</code></p>
<p><img src="/assets/images/2020-10-11-20-37-00.png"></p>
<h1 id="serializer"><a aria-hidden="true" class="anchor-heading" href="#serializer"><svg aria-hidden="true" viewBox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a>Serializer</h1>
<p>Converts between wire format and code</p>
<p><a href="https://https://avro.apache.org/docs/current">Apache Avro</a>
Define a common schema for serialization and deserialization
Store in schema Registry
Store schema identifier in produced message
<img src="/assets/images/2020-10-11-20-37-15.png"></p>
<h1 id="creating-a-producer"><a aria-hidden="true" class="anchor-heading" href="#creating-a-producer"><svg aria-hidden="true" viewBox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a>Creating a Producer</h1>
<h2 id="in-rust"><a aria-hidden="true" class="anchor-heading" href="#in-rust"><svg aria-hidden="true" viewBox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a>In <a href="deltamaniac.github.io/notes/18962325-b097-4283-9f8e-23a89a24511b.html">rust</a></h2>
<p>Crate : <a href="https://crates.io/crates/kafka">kafka</a></p>
<pre><code class="hljs language-rust"><span class="hljs-comment">// Producer Code</span>
<span class="hljs-keyword">use</span> std::fmt::Write;
<span class="hljs-keyword">use</span> std::time::Duration;
<span class="hljs-keyword">use</span> kafka::producer::{Producer, Record, RequiredAcks};

<span class="hljs-keyword">let</span> <span class="hljs-keyword">mut</span> producer = Producer::from_hosts(<span class="hljs-built_in">vec!</span>(<span class="hljs-string">"localhost:9092"</span>.to_owned()))
.with_ack_timeout(Duration::from_secs(<span class="hljs-number">1</span>))
.with_required_acks(RequiredAcks::One)
.create()
.unwrap();

<span class="hljs-keyword">let</span> <span class="hljs-keyword">mut</span> buf = <span class="hljs-built_in">String</span>::with*capacity(<span class="hljs-number">2</span>);
<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-number">0</span>..<span class="hljs-number">10</span> {
<span class="hljs-keyword">let</span> * = <span class="hljs-built_in">write!</span>(&#x26;<span class="hljs-keyword">mut</span> buf, <span class="hljs-string">"{}"</span>, i); <span class="hljs-comment">// some computation of the message data to be sent</span>
producer.send(&#x26;Record::from_value(<span class="hljs-string">"my-topic"</span>, buf.as_bytes())).unwrap();
buf.clear();
}</code></pre>
<p>Crate : <a href="https://crates.io/crates/rdkafka">rdkafka</a></p>
<pre><code class="hljs language-rust"> sync <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">produce</span></span>(brokers: &#x26;<span class="hljs-built_in">str</span>, topic_name: &#x26;<span class="hljs-built_in">str</span>) {
    <span class="hljs-keyword">let</span> producer: &#x26;FutureProducer = &#x26;ClientConfig::new()
        .set(<span class="hljs-string">"bootstrap.servers"</span>, brokers)
        .set(<span class="hljs-string">"message.timeout.ms"</span>, <span class="hljs-string">"5000"</span>)
        .create()
        .expect(<span class="hljs-string">"Producer creation error"</span>);

    <span class="hljs-comment">// This loop is non blocking: all messages will be sent one after the other, without waiting</span>
    <span class="hljs-comment">// for the results.</span>
    <span class="hljs-keyword">let</span> futures = (<span class="hljs-number">0</span>..<span class="hljs-number">5</span>)
        .map(|i| <span class="hljs-keyword">async</span> <span class="hljs-keyword">move</span> {
            <span class="hljs-comment">// The send operation on the topic returns a future, which will be</span>
            <span class="hljs-comment">// completed once the result or failure from Kafka is received.</span>
            <span class="hljs-keyword">let</span> delivery_status = producer
                .send(
                    FutureRecord::to(topic_name)
                        .payload(&#x26;<span class="hljs-built_in">format!</span>(<span class="hljs-string">"Message {}"</span>, i))
                        .key(&#x26;<span class="hljs-built_in">format!</span>(<span class="hljs-string">"Key {}"</span>, i))
                        .headers(OwnedHeaders::new().add(<span class="hljs-string">"header_key"</span>, <span class="hljs-string">"header_value"</span>)),
                    Duration::from_secs(<span class="hljs-number">0</span>),
                )
                .<span class="hljs-keyword">await</span>;

            <span class="hljs-comment">// This will be executed when the result is received.</span>
            info!(<span class="hljs-string">"Delivery status for message {} received"</span>, i);
            delivery_status
        })
        .collect::&#x3C;<span class="hljs-built_in">Vec</span>&#x3C;_>>();

    <span class="hljs-comment">// This loop will wait until all delivery statuses have been received.</span>
    <span class="hljs-keyword">for</span> future <span class="hljs-keyword">in</span> futures {
        info!(<span class="hljs-string">"Future completed. Result: {:?}"</span>, future.<span class="hljs-keyword">await</span>);
    }
}
</code></pre>
<p>Schema Registry for confluent : <a href="https://github.com/gklijs/schema_registry_converter">https://github.com/gklijs/schema_registry_converter</a></p>
<p>Confluent Write up : <a href="https://www.confluent.io/blog/getting-started-with-rust-and-kafka/">https://www.confluent.io/blog/getting-started-with-rust-and-kafka/</a></p>
<hr>
<h2 id="in-go"><a aria-hidden="true" class="anchor-heading" href="#in-go"><svg aria-hidden="true" viewBox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a>In <a href="deltamaniac.github.io/notes/72f47187-278f-4a21-a56f-4abda62fea03.html">go</a></h2>
<p>Package : <a href="https://github.com/confluentinc/confluent-kafka-go">Confluent Inc</a></p>
<pre><code class="hljs language-golang"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {

	p, err := kafka.NewProducer(&#x26;kafka.ConfigMap{<span class="hljs-string">"bootstrap.servers"</span>: <span class="hljs-string">"localhost"</span>})
	<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
		<span class="hljs-built_in">panic</span>(err)
	}

	<span class="hljs-keyword">defer</span> p.Close()

	<span class="hljs-comment">// Delivery report handler for produced messages</span>
	<span class="hljs-keyword">go</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> {
		<span class="hljs-keyword">for</span> e := <span class="hljs-keyword">range</span> p.Events() {
			<span class="hljs-keyword">switch</span> ev := e.(<span class="hljs-keyword">type</span>) {
			<span class="hljs-keyword">case</span> *kafka.Message:
				<span class="hljs-keyword">if</span> ev.TopicPartition.Error != <span class="hljs-literal">nil</span> {
					fmt.Printf(<span class="hljs-string">"Delivery failed: %v\n"</span>, ev.TopicPartition)
				} <span class="hljs-keyword">else</span> {
					fmt.Printf(<span class="hljs-string">"Delivered message to %v\n"</span>, ev.TopicPartition)
				}
			}
		}
	}()

	<span class="hljs-comment">// Produce messages to topic (asynchronously)</span>
	topic := <span class="hljs-string">"myTopic"</span>
	<span class="hljs-keyword">for</span> _, word := <span class="hljs-keyword">range</span> []<span class="hljs-keyword">string</span>{<span class="hljs-string">"Welcome"</span>, <span class="hljs-string">"to"</span>, <span class="hljs-string">"the"</span>, <span class="hljs-string">"Confluent"</span>, <span class="hljs-string">"Kafka"</span>, <span class="hljs-string">"Golang"</span>, <span class="hljs-string">"client"</span>} {
		p.Produce(&#x26;kafka.Message{
			TopicPartition: kafka.TopicPartition{Topic: &#x26;topic, Partition: kafka.PartitionAny},
			Value:          []<span class="hljs-keyword">byte</span>(word),
		}, <span class="hljs-literal">nil</span>)
	}

	<span class="hljs-comment">// Wait for message deliveries before shutting down</span>
	p.Flush(<span class="hljs-number">15</span> * <span class="hljs-number">1000</span>)
}</code></pre>
<p>Package : <a href="https://github.com/segmentio/kafka-go">SegmentIO</a></p>
<pre><code class="hljs language-golang"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">producer</span><span class="hljs-params">()</span></span> {

    topic := <span class="hljs-string">"my-topic"</span>
    partition := <span class="hljs-number">0</span>

    conn, _ := kafka.DialLeader(context.Background(), <span class="hljs-string">"tcp"</span>, <span class="hljs-string">"localhost:9092"</span>, topic, partition)

    conn.SetWriteDeadline(time.Now().Add(<span class="hljs-number">10</span>*time.Second))
    conn.WriteMessages(
    kafka.Message{Value: []<span class="hljs-keyword">byte</span>(<span class="hljs-string">"one!"</span>)},
    kafka.Message{Value: []<span class="hljs-keyword">byte</span>(<span class="hljs-string">"two!"</span>)},
    kafka.Message{Value: []<span class="hljs-keyword">byte</span>(<span class="hljs-string">"three!"</span>)},
    )

    conn.Close()
}</code></pre>
<p>Package : <a href="https://github.com/Shopify/sarama">Sarama</a></p>
<pre><code class="hljs language-golang"><span class="hljs-comment">//Sync Producer</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">newDataCollector</span><span class="hljs-params">(brokerList []<span class="hljs-keyword">string</span>)</span> <span class="hljs-title">sarama</span>.<span class="hljs-title">SyncProducer</span></span> {

	<span class="hljs-comment">// For the data collector, we are looking for strong consistency semantics.</span>
	<span class="hljs-comment">// Because we don't change the flush settings, sarama will try to produce messages</span>
	<span class="hljs-comment">// as fast as possible to keep latency low.</span>
	config := sarama.NewConfig()
	config.Producer.RequiredAcks = sarama.WaitForAll <span class="hljs-comment">// Wait for all in-sync replicas to ack the message</span>
	config.Producer.Retry.Max = <span class="hljs-number">10</span>                   <span class="hljs-comment">// Retry up to 10 times to produce the message</span>
	config.Producer.Return.Successes = <span class="hljs-literal">true</span>
	tlsConfig := createTlsConfiguration()
	<span class="hljs-keyword">if</span> tlsConfig != <span class="hljs-literal">nil</span> {
		config.Net.TLS.Config = tlsConfig
		config.Net.TLS.Enable = <span class="hljs-literal">true</span>
	}

	<span class="hljs-comment">// On the broker side, you may want to change the following settings to get</span>
	<span class="hljs-comment">// stronger consistency guarantees:</span>
	<span class="hljs-comment">// - For your broker, set `unclean.leader.election.enable` to false</span>
	<span class="hljs-comment">// - For the topic, you could increase `min.insync.replicas`.</span>

	producer, err := sarama.NewSyncProducer(brokerList, config)
	<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
		log.Fatalln(<span class="hljs-string">"Failed to start Sarama producer:"</span>, err)
	}

	<span class="hljs-keyword">return</span> producer
}

<span class="hljs-comment">// Async Producer</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">newAccessLogProducer</span><span class="hljs-params">(brokerList []<span class="hljs-keyword">string</span>)</span> <span class="hljs-title">sarama</span>.<span class="hljs-title">AsyncProducer</span></span> {

	<span class="hljs-comment">// For the access log, we are looking for AP semantics, with high throughput.</span>
	<span class="hljs-comment">// By creating batches of compressed messages, we reduce network I/O at a cost of more latency.</span>
	config := sarama.NewConfig()
	tlsConfig := createTlsConfiguration()
	<span class="hljs-keyword">if</span> tlsConfig != <span class="hljs-literal">nil</span> {
		config.Net.TLS.Enable = <span class="hljs-literal">true</span>
		config.Net.TLS.Config = tlsConfig
	}
	config.Producer.RequiredAcks = sarama.WaitForLocal       <span class="hljs-comment">// Only wait for the leader to ack</span>
	config.Producer.Compression = sarama.CompressionSnappy   <span class="hljs-comment">// Compress messages</span>
	config.Producer.Flush.Frequency = <span class="hljs-number">500</span> * time.Millisecond <span class="hljs-comment">// Flush batches every 500ms</span>

	producer, err := sarama.NewAsyncProducer(brokerList, config)
	<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
		log.Fatalln(<span class="hljs-string">"Failed to start Sarama producer:"</span>, err)
	}

	<span class="hljs-comment">// We will just log to STDOUT if we're not able to produce messages.</span>
	<span class="hljs-comment">// Note: messages will only be returned here after all retry attempts are exhausted.</span>
	<span class="hljs-keyword">go</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> {
		<span class="hljs-keyword">for</span> err := <span class="hljs-keyword">range</span> producer.Errors() {
			log.Println(<span class="hljs-string">"Failed to write access log entry:"</span>, err)
		}
	}()

	<span class="hljs-keyword">return</span> producer
}

<span class="hljs-keyword">go</span> <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">sendMessage</span><span class="hljs-params">()</span></span>{
        <span class="hljs-comment">// Synch</span>
		partition, offset, err := s.DataCollector.SendMessage(&#x26;sarama.ProducerMessage{
			Topic: <span class="hljs-string">"important"</span>,
			Value: sarama.StringEncoder(r.URL.RawQuery),
        })
        <span class="hljs-comment">// Async</span>
        s.AccessLogProducer.Input() &#x3C;- &#x26;sarama.ProducerMessage{
			Topic: <span class="hljs-string">"access_log"</span>,
			Key:   sarama.StringEncoder(r.RemoteAddr),
			Value: entry,
		}
}</code></pre>


        

        

        
          <hr>
          <footer>
            
            

            
              <div class="d-flex mt-2">
                
                
              </div>
            
          </footer>
        
    </div>
</div>


  

  <div class="search-overlay"></div>

</div>
</body>
</html>
