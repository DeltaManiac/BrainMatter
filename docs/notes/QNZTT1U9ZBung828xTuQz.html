<!DOCTYPE html>

<html lang="en-US">
<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
  
  <title>Gokit - BrainMatter</title>
  

  <link
    rel="shortcut icon"
    href="https://deltamaniac.github.io/favicon.ico"
    type="image/x-icon"
  />
  <link
    rel="stylesheet"
    href="https://deltamaniac.github.io/assets/css/just-the-docs-default.css"
  />
  <script
    type="text/javascript"
    src="https://deltamaniac.github.io/assets/js/just-the-docs.js"
  ></script>
  <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.22.0/themes/prism.min.css"
  />
  <link
    rel="stylesheet"
    href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css"
    integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X"
    crossorigin="anonymous"
  />
  <script
    type="text/javascript"
    src="https://deltamaniac.github.io/assets/js/vendor/lunr.min.js"
  ></script>
  
  <meta name="viewport" content="width=device-width, initial-scale=1" />
   
   
  
<meta name="description" content="Personal knowledge space">
<meta name="author" content="DeltaManiac">

<link rel="canonical" href="https://deltamaniac.github.io//notes/QNZTT1U9ZBung828xTuQz.html">

<meta property="og:type" content="article">
<meta property="og:url" content="https://deltamaniac.github.io//notes/QNZTT1U9ZBung828xTuQz.html">
<meta property="og:description" content="Personal knowledge space">
<meta property="og:image" content="https://deltamaniac.github.io/undefined">

<meta name="twitter:card" content="summary">
<meta name="twitter:site" content="@delta_maniac">
<meta name="twitter:url" content="https://deltamaniac.github.io//notes/QNZTT1U9ZBung828xTuQz.html">
<meta name="twitter:description" content="Personal knowledge space">
<meta name="twitter:image" content="https://deltamaniac.github.io/undefined">


  <meta property="og:title" content="Gokit - BrainMatter" />
  <meta name="twitter:title" content="Gokit - BrainMatter" />
  
</head>



<body>
    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
      <symbol id="svg-link" viewBox="0 0 24 24">
        <title>Link</title>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link">
          <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path>
        </svg>
      </symbol>
      <symbol id="svg-search" viewBox="0 0 24 24">
        <title>Search</title>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search">
          <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line>
        </svg>
      </symbol>
      <symbol id="svg-menu" viewBox="0 0 24 24">
        <title>Menu</title>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu">
          <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line>
        </svg>
      </symbol>
      <symbol id="svg-arrow-right" viewBox="0 0 24 24">
        <title>Expand</title>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right">
          <polyline points="9 18 15 12 9 6"></polyline>
        </svg>
      </symbol>
      <symbol id="svg-doc" viewBox="0 0 24 24">
        <title>Document</title>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file">
          <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline>
        </svg>
      </symbol>
    </svg>

    <div class="side-bar">
      <div class="site-header">
        <a href="https://deltamaniac.github.io" class="site-title lh-tight">
  BrainMatter

 </a>
        <a href="#" id="menu-button" class="site-button">
          <svg viewBox="0 0 24 24" class="icon"><use xlink:href="#svg-menu"></use></svg>
        </a>
      </div>

      <nav role="navigation" aria-label="Main" id="site-nav" class="site-nav">
      </nav>
      <footer class="site-footer">
        ðŸŒ± with ðŸ’• using <a href="https://www.dendron.so/"> Dendron ðŸŒ² </a>
      </footer>
    </div>
    <div class="main" id="top">
        <div id="main-header" class="main-header">
          
            <div class="search">
              <div class="search-input-wrap">
                <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search BrainMatter" aria-label="Search BrainMatter" autocomplete="off">
                <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label>
              </div>
              <div id="search-results" class="search-results"></div>
            </div>
          
          
    </div>
    <div id="main-content-wrap" class="main-content-wrap">
      
        
          <nav aria-label="Breadcrumb" class="breadcrumb-nav">
            <ol class="breadcrumb-nav-list"><li class="breadcrumb-nav-list-item"><a href="https://deltamaniac.github.io">BrainMatter</a></li><li class="breadcrumb-nav-list-item"><a href="https://deltamaniac.github.io/notes\96Hj5nYpnUciwlTenFpoU.html">Go</a></li><li class="breadcrumb-nav-list-item"><a href="https://deltamaniac.github.io/notes\OmHkA6xzHAPClubvCFwQt.html">Framework</a></li><li class="breadcrumb-nav-list-item">Gokit</li></ol>
          </nav>
        
      
      <div id="main-content" class="main-content" role="main">

        
        
        <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
        <script>mermaid.initialize({startOnLoad:true});</script>
        

        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css" integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk" crossorigin="anonymous">
        <script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
        <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
        <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js" integrity="sha384-OgVRvuATP1z7JjHLkuOU7Xw704+h835Lr+6QL9UvYjZE3Ipu6Tp75j7Bh/kR0JKI" crossorigin="anonymous"></script>
        
        

        

        

        

        <script>
          $(function () {
            $('[data-toggle="popover"]').popover({html: true})
          })
        </script>

        

<div id="main" role="main">

  <article class="page" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="Gokit">
    
    <meta itemprop="datePublished" content="2020-10-17T11:59:35+00:00">
    <meta itemprop="dateModified" content="2020-10-17T11:59:35+00:00">

    <div class="page__inner-wrap">

      

      <section class="page__content" itemprop="text">

        

        <h1 id="gokit"><a aria-hidden="true" class="anchor-heading" href="#gokit"><svg aria-hidden="true" viewBox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a>Gokit</h1>
<h1 id="gokit-1"><a aria-hidden="true" class="anchor-heading" href="#gokit-1"><svg aria-hidden="true" viewBox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a>Gokit</h1>
<p>Spring boot like framework for <a href="https://deltamaniac.github.io/notes/96Hj5nYpnUciwlTenFpoU.html">Go</a>. It has 3 major Components</p>
<h2 id="service-layer"><a aria-hidden="true" class="anchor-heading" href="#service-layer"><svg aria-hidden="true" viewBox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a>Service Layer</h2>
<ul>
<li>Innermost layer where business logic resides.</li>
<li>Modeled as services</li>
<li>Oblivious to Endpoint/Transport Layers</li>
<li>Can be used by multiple Transports (grpc/json/http)</li>
</ul>
<h2 id="endpoint-layer"><a aria-hidden="true" class="anchor-heading" href="#endpoint-layer"><svg aria-hidden="true" viewBox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a>Endpoint Layer</h2>
<ul>
<li>Represents a single RPC Method</li>
<li>Service exposed as an Endpoint</li>
<li>Endpoint can be exposed by multiple Transports</li>
</ul>
<h2 id="transport-layer"><a aria-hidden="true" class="anchor-heading" href="#transport-layer"><svg aria-hidden="true" viewBox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a>Transport Layer</h2>
<ul>
<li>Exposes various Transports
<ul>
<li>grpc</li>
<li>http</li>
</ul>
</li>
</ul>
<h1 id="building-a-pastebin-clone"><a aria-hidden="true" class="anchor-heading" href="#building-a-pastebin-clone"><svg aria-hidden="true" viewBox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a>Building a <code>pastebin</code> clone</h1>
<h2 id="define-a-service-blueprint-interface"><a aria-hidden="true" class="anchor-heading" href="#define-a-service-blueprint-interface"><svg aria-hidden="true" viewBox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a>Define a service blueprint interface</h2>
<pre class="language-go"><code class="language-go"><span class="token comment">// PbService provides storage capabilities</span>
<span class="token keyword">type</span> PbService <span class="token keyword">interface</span> <span class="token punctuation">{</span>
	<span class="token function">Create</span><span class="token punctuation">(</span>content <span class="token builtin">string</span><span class="token punctuation">,</span> ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span>
	<span class="token function">Delete</span><span class="token punctuation">(</span>key <span class="token builtin">string</span><span class="token punctuation">,</span> ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span>
	<span class="token function">Get</span><span class="token punctuation">(</span>key <span class="token builtin">string</span><span class="token punctuation">,</span> ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
<h2 id="make-a-new-struct-to-define-the-pastebin-service"><a aria-hidden="true" class="anchor-heading" href="#make-a-new-struct-to-define-the-pastebin-service"><svg aria-hidden="true" viewBox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a>Make a new struct to define the PasteBin Service</h2>
<p>This struct is used to group together the functionalities of pastebin service</p>
<pre class="language-go"><code class="language-go"><span class="token keyword">type</span> pbService <span class="token keyword">struct</span> <span class="token punctuation">{</span>
	memory <span class="token keyword">map</span><span class="token punctuation">[</span>uuid<span class="token punctuation">.</span>UUID<span class="token punctuation">]</span><span class="token builtin">string</span>
<span class="token punctuation">}</span>

<span class="token comment">// NewPbService make a new PbService</span>
<span class="token keyword">func</span> <span class="token function">NewPbService</span><span class="token punctuation">(</span><span class="token punctuation">)</span> PbService <span class="token punctuation">{</span>
	<span class="token keyword">return</span> pbService<span class="token punctuation">{</span>
		memory<span class="token punctuation">:</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">map</span><span class="token punctuation">[</span>uuid<span class="token punctuation">.</span>UUID<span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<h2 id="implement-the-pbservice-interface-on-the-struct"><a aria-hidden="true" class="anchor-heading" href="#implement-the-pbservice-interface-on-the-struct"><svg aria-hidden="true" viewBox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a>Implement the PbService Interface on the struct</h2>
<p>In <a href="https://deltamaniac.github.io/notes/96Hj5nYpnUciwlTenFpoU.html">Go</a> we do not have a key word to define that this structs implements a specific interface like the <code>implements</code> in Java.</p>
<p>They way we enforce contracts is by implementing all the methods of the contract interface in our case here its the <code>PbService</code> interface.</p>
<p>Since our <code>NewPbService</code> method returns the type of <code>PbService</code> the go compiler will ensure that <code>NewPbService</code> confirms to the <code>PbService</code> interface.</p>
<pre class="language-go"><code class="language-go"><span class="token comment">//Create: Here we store the content and return a uuid</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>s pbService<span class="token punctuation">)</span> <span class="token function">Create</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> content <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	id <span class="token operator">:=</span> uuid<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	s<span class="token punctuation">.</span>memory<span class="token punctuation">[</span>id<span class="token punctuation">]</span> <span class="token operator">=</span> content
	<span class="token keyword">return</span> id<span class="token punctuation">.</span><span class="token function">String</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">nil</span>
<span class="token punctuation">}</span>

<span class="token comment">//Delete: Here we use the key to find and delete the content stored</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>s pbService<span class="token punctuation">)</span> <span class="token function">Delete</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> key <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	id<span class="token punctuation">,</span> err <span class="token operator">:=</span> uuid<span class="token punctuation">.</span><span class="token function">Parse</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token string">""</span><span class="token punctuation">,</span> errors<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span><span class="token string">"Invalid Uuid Format"</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	<span class="token function">delete</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span>memory<span class="token punctuation">,</span> id<span class="token punctuation">)</span>
	<span class="token keyword">return</span> <span class="token string">"ok"</span><span class="token punctuation">,</span> <span class="token boolean">nil</span>
<span class="token punctuation">}</span>

<span class="token comment">//Get: Here we use the key to find and return the content stored</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>s pbService<span class="token punctuation">)</span> <span class="token function">Get</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> key <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	id<span class="token punctuation">,</span> err <span class="token operator">:=</span> uuid<span class="token punctuation">.</span><span class="token function">Parse</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token string">""</span><span class="token punctuation">,</span> errors<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span><span class="token string">"Invalid Uuid Format"</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	content<span class="token punctuation">,</span> exists <span class="token operator">:=</span> s<span class="token punctuation">.</span>memory<span class="token punctuation">[</span>id<span class="token punctuation">]</span>
	<span class="token keyword">if</span> exists <span class="token punctuation">{</span>
		<span class="token keyword">return</span> content<span class="token punctuation">,</span> <span class="token boolean">nil</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> <span class="token string">""</span><span class="token punctuation">,</span> errors<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span><span class="token string">"Invalid Uuid"</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
<h2 id="request-and-response"><a aria-hidden="true" class="anchor-heading" href="#request-and-response"><svg aria-hidden="true" viewBox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a>Request and Response</h2>
<p>In Go kit, the primary messaging pattern is RPC.</p>
<p>So, every method in our interface will be modeled as a remote procedure call. For each method, we define request and response structs, capturing all of the input and output parameters respectively.</p>
<h3 id="create-request-response"><a aria-hidden="true" class="anchor-heading" href="#create-request-response"><svg aria-hidden="true" viewBox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a>Create Request Response</h3>
<pre class="language-go"><code class="language-go"><span class="token keyword">type</span> createPbRequest <span class="token keyword">struct</span> <span class="token punctuation">{</span>
	content <span class="token builtin">string</span> <span class="token string">`json:"content"`</span>
<span class="token punctuation">}</span>

<span class="token keyword">type</span> createPbResponse <span class="token keyword">struct</span> <span class="token punctuation">{</span>
	key <span class="token builtin">string</span> <span class="token string">`json:"key"`</span>
	Err <span class="token builtin">string</span> <span class="token string">`json:"err,omitempty"`</span> <span class="token comment">// errors don't JSON-marshal, so we use a string</span>
<span class="token punctuation">}</span>
</code></pre>
<h3 id="delete-request-response"><a aria-hidden="true" class="anchor-heading" href="#delete-request-response"><svg aria-hidden="true" viewBox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a>Delete Request Response</h3>
<pre class="language-go"><code class="language-go"><span class="token keyword">type</span> deletePbRequest <span class="token keyword">struct</span> <span class="token punctuation">{</span>
	key <span class="token builtin">string</span> <span class="token string">`json:"key"`</span>
<span class="token punctuation">}</span>

<span class="token keyword">type</span> deletePbResponse <span class="token keyword">struct</span> <span class="token punctuation">{</span>
	status <span class="token builtin">string</span> <span class="token string">`json:"status"`</span>
	Err    <span class="token builtin">string</span> <span class="token string">`json:"err,omitempty"`</span> <span class="token comment">// errors don't JSON-marshal, so we use a string</span>
<span class="token punctuation">}</span>
</code></pre>
<h3 id="get-request-response"><a aria-hidden="true" class="anchor-heading" href="#get-request-response"><svg aria-hidden="true" viewBox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a>Get Request Response</h3>
<pre class="language-go"><code class="language-go"><span class="token keyword">type</span> getPbRequest <span class="token keyword">struct</span> <span class="token punctuation">{</span>
	key <span class="token builtin">string</span> <span class="token string">`json:"key"`</span>
<span class="token punctuation">}</span>

<span class="token keyword">type</span> getPbResponse <span class="token keyword">struct</span> <span class="token punctuation">{</span>
	content <span class="token builtin">string</span> <span class="token string">`json:"content"`</span>
	Err     <span class="token builtin">string</span> <span class="token string">`json:"err,omitempty"`</span> <span class="token comment">// errors don't JSON-marshal, so we use a string</span>
<span class="token punctuation">}</span>
</code></pre>
<h2 id="define-endpoints"><a aria-hidden="true" class="anchor-heading" href="#define-endpoints"><svg aria-hidden="true" viewBox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a>Define Endpoints</h2>
<p>An endpoint represents a single RPC, which is a single method in our service.</p>
<h3 id="create-endpoint"><a aria-hidden="true" class="anchor-heading" href="#create-endpoint"><svg aria-hidden="true" viewBox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a>Create Endpoint</h3>
<pre class="language-go"><code class="language-go"><span class="token keyword">func</span> <span class="token function">createPbEndpoint</span><span class="token punctuation">(</span>svc PbService<span class="token punctuation">)</span> endpoint<span class="token punctuation">.</span>Endpoint <span class="token punctuation">{</span>
	<span class="token keyword">return</span> <span class="token keyword">func</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> request <span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		req <span class="token operator">:=</span> request<span class="token punctuation">.</span><span class="token punctuation">(</span>createPbRequest<span class="token punctuation">)</span>
		key<span class="token punctuation">,</span> err <span class="token operator">:=</span> svc<span class="token punctuation">.</span><span class="token function">Create</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> req<span class="token punctuation">.</span>Content<span class="token punctuation">)</span>
		<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
			<span class="token keyword">return</span> createPbResponse<span class="token punctuation">{</span>key<span class="token punctuation">,</span> err<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">nil</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">return</span> createPbResponse<span class="token punctuation">{</span>key<span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">nil</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<h3 id="delete-endpoint"><a aria-hidden="true" class="anchor-heading" href="#delete-endpoint"><svg aria-hidden="true" viewBox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a>Delete Endpoint</h3>
<pre class="language-go"><code class="language-go"><span class="token keyword">func</span> <span class="token function">deletePbEndpoint</span><span class="token punctuation">(</span>svc PbService<span class="token punctuation">)</span> endpoint<span class="token punctuation">.</span>Endpoint <span class="token punctuation">{</span>
	<span class="token keyword">return</span> <span class="token keyword">func</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> request <span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		req <span class="token operator">:=</span> request<span class="token punctuation">.</span><span class="token punctuation">(</span>deletePbRequest<span class="token punctuation">)</span>
		status<span class="token punctuation">,</span> err <span class="token operator">:=</span> svc<span class="token punctuation">.</span><span class="token function">Delete</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> req<span class="token punctuation">.</span>Key<span class="token punctuation">)</span>
		<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
			<span class="token keyword">return</span> deletePbResponse<span class="token punctuation">{</span>status<span class="token punctuation">,</span> err<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">nil</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">return</span> deletePbResponse<span class="token punctuation">{</span>status<span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">nil</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<h3 id="get-endpoint"><a aria-hidden="true" class="anchor-heading" href="#get-endpoint"><svg aria-hidden="true" viewBox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a>Get Endpoint</h3>
<pre class="language-go"><code class="language-go"><span class="token keyword">func</span> <span class="token function">getPbEndpoint</span><span class="token punctuation">(</span>svc PbService<span class="token punctuation">)</span> endpoint<span class="token punctuation">.</span>Endpoint <span class="token punctuation">{</span>
	<span class="token keyword">return</span> <span class="token keyword">func</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> request <span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		req <span class="token operator">:=</span> request<span class="token punctuation">.</span><span class="token punctuation">(</span>getPbRequest<span class="token punctuation">)</span>
		content<span class="token punctuation">,</span> err <span class="token operator">:=</span> svc<span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> req<span class="token punctuation">.</span>Key<span class="token punctuation">)</span>
		<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
			<span class="token keyword">return</span> getPbResponse<span class="token punctuation">{</span>content<span class="token punctuation">,</span> err<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">nil</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">return</span> getPbResponse<span class="token punctuation">{</span>content<span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">nil</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<h2 id="define-transport"><a aria-hidden="true" class="anchor-heading" href="#define-transport"><svg aria-hidden="true" viewBox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a>Define Transport</h2>
<p>Since this trivial example used JSON over HTTP we would have to decode the JSON to structs that our service can understand</p>
<h3 id="create-requester-decoder"><a aria-hidden="true" class="anchor-heading" href="#create-requester-decoder"><svg aria-hidden="true" viewBox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a>Create Requester Decoder</h3>
<pre class="language-go"><code class="language-go"><span class="token keyword">func</span> <span class="token function">decodeCreatePbRequest</span><span class="token punctuation">(</span><span class="token boolean">_</span> context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> r <span class="token operator">*</span>http<span class="token punctuation">.</span>Request<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">var</span> request createPbRequest
	<span class="token keyword">if</span> err <span class="token operator">:=</span> json<span class="token punctuation">.</span><span class="token function">NewDecoder</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>Body<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Decode</span><span class="token punctuation">(</span><span class="token operator">&#x26;</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> err
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> request<span class="token punctuation">,</span> <span class="token boolean">nil</span>
<span class="token punctuation">}</span>
</code></pre>
<h3 id="delete-request-decoder"><a aria-hidden="true" class="anchor-heading" href="#delete-request-decoder"><svg aria-hidden="true" viewBox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a>Delete Request Decoder</h3>
<pre class="language-go"><code class="language-go"><span class="token keyword">func</span> <span class="token function">decodeDeletePbRequest</span><span class="token punctuation">(</span><span class="token boolean">_</span> context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> r <span class="token operator">*</span>http<span class="token punctuation">.</span>Request<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">var</span> request deletePbRequest
	<span class="token keyword">if</span> err <span class="token operator">:=</span> json<span class="token punctuation">.</span><span class="token function">NewDecoder</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>Body<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Decode</span><span class="token punctuation">(</span><span class="token operator">&#x26;</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> err
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> request<span class="token punctuation">,</span> <span class="token boolean">nil</span>
<span class="token punctuation">}</span>
</code></pre>
<h3 id="get-request-decoder"><a aria-hidden="true" class="anchor-heading" href="#get-request-decoder"><svg aria-hidden="true" viewBox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a>Get Request Decoder</h3>
<pre class="language-go"><code class="language-go"><span class="token keyword">func</span> <span class="token function">decodeGetPbRequest</span><span class="token punctuation">(</span><span class="token boolean">_</span> context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> r <span class="token operator">*</span>http<span class="token punctuation">.</span>Request<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">var</span> request getPbRequest
	<span class="token keyword">if</span> err <span class="token operator">:=</span> json<span class="token punctuation">.</span><span class="token function">NewDecoder</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>Body<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Decode</span><span class="token punctuation">(</span><span class="token operator">&#x26;</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> err
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> request<span class="token punctuation">,</span> <span class="token boolean">nil</span>
<span class="token punctuation">}</span>
</code></pre>
<h3 id="response-encoder"><a aria-hidden="true" class="anchor-heading" href="#response-encoder"><svg aria-hidden="true" viewBox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a>Response Encoder</h3>
<p>This method would accept an <code>interface</code> type and convert it JSON, this allows it to accept <code>createPbResponse</code>,<code>deletePbResponse</code>,<code>getPbResponse</code> as an <code>interface{}</code> and encode it as json using the annotations in the struct definition.</p>
<pre class="language-go"><code class="language-go"><span class="token keyword">func</span> <span class="token function">encodeResponse</span><span class="token punctuation">(</span><span class="token boolean">_</span> context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> w http<span class="token punctuation">.</span>ResponseWriter<span class="token punctuation">,</span> response <span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{</span>
	<span class="token keyword">return</span> json<span class="token punctuation">.</span><span class="token function">NewEncoder</span><span class="token punctuation">(</span>w<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Encode</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
<h2 id="main"><a aria-hidden="true" class="anchor-heading" href="#main"><svg aria-hidden="true" viewBox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a>Main</h2>
<pre class="language-go"><code class="language-go"><span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token string">"context"</span>
	<span class="token string">"encoding/json"</span>
	<span class="token string">"errors"</span>
	<span class="token string">"log"</span>
	<span class="token string">"net/http"</span>

	<span class="token string">"github.com/go-kit/kit/endpoint"</span>
	<span class="token string">"github.com/google/uuid"</span>

	httptransport <span class="token string">"github.com/go-kit/kit/transport/http"</span>
<span class="token punctuation">)</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	svc <span class="token operator">:=</span> <span class="token function">NewPbService</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	createPbHandler <span class="token operator">:=</span> httptransport<span class="token punctuation">.</span><span class="token function">NewServer</span><span class="token punctuation">(</span>
		<span class="token function">createPbEndpoint</span><span class="token punctuation">(</span>svc<span class="token punctuation">)</span><span class="token punctuation">,</span>
		decodeCreatePbRequest<span class="token punctuation">,</span>
		encodeResponse<span class="token punctuation">,</span>
	<span class="token punctuation">)</span>

	deletePbHandler <span class="token operator">:=</span> httptransport<span class="token punctuation">.</span><span class="token function">NewServer</span><span class="token punctuation">(</span>
		<span class="token function">deletePbEndpoint</span><span class="token punctuation">(</span>svc<span class="token punctuation">)</span><span class="token punctuation">,</span>
		decodeDeletePbRequest<span class="token punctuation">,</span>
		encodeResponse<span class="token punctuation">,</span>
	<span class="token punctuation">)</span>

	getPbHandler <span class="token operator">:=</span> httptransport<span class="token punctuation">.</span><span class="token function">NewServer</span><span class="token punctuation">(</span>
		<span class="token function">getPbEndpoint</span><span class="token punctuation">(</span>svc<span class="token punctuation">)</span><span class="token punctuation">,</span>
		decodeGetPbRequest<span class="token punctuation">,</span>
		encodeResponse<span class="token punctuation">,</span>
	<span class="token punctuation">)</span>

	http<span class="token punctuation">.</span><span class="token function">Handle</span><span class="token punctuation">(</span><span class="token string">"/create"</span><span class="token punctuation">,</span> createPbHandler<span class="token punctuation">)</span>
	http<span class="token punctuation">.</span><span class="token function">Handle</span><span class="token punctuation">(</span><span class="token string">"/delete"</span><span class="token punctuation">,</span> deletePbHandler<span class="token punctuation">)</span>
	http<span class="token punctuation">.</span><span class="token function">Handle</span><span class="token punctuation">(</span><span class="token string">"/get"</span><span class="token punctuation">,</span> getPbHandler<span class="token punctuation">)</span>
	log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span>http<span class="token punctuation">.</span><span class="token function">ListenAndServe</span><span class="token punctuation">(</span><span class="token string">":8080"</span><span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
<h2 id="divide-and-conquer"><a aria-hidden="true" class="anchor-heading" href="#divide-and-conquer"><svg aria-hidden="true" viewBox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a>Divide and Conquer</h2>
<p>At this point the <code>main.go</code> has a lot of code so lets move to different files so that we have separation of concerns.</p>
<h3 id="servicego"><a aria-hidden="true" class="anchor-heading" href="#servicego"><svg aria-hidden="true" viewBox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a><code>service.go</code></h3>
<pre class="language-go"><code class="language-go"><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token string">"context"</span>
	<span class="token string">"errors"</span>

	<span class="token string">"github.com/google/uuid"</span>
<span class="token punctuation">)</span>

<span class="token comment">// PbService provides storage capabilities</span>
<span class="token keyword">type</span> PbService <span class="token keyword">interface</span> <span class="token punctuation">{</span>
	<span class="token function">Create</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> content <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span>
	<span class="token function">Delete</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> key <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span>
	<span class="token function">Get</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> key <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">type</span> pbService <span class="token keyword">struct</span> <span class="token punctuation">{</span>
	memory <span class="token keyword">map</span><span class="token punctuation">[</span>uuid<span class="token punctuation">.</span>UUID<span class="token punctuation">]</span><span class="token builtin">string</span>
<span class="token punctuation">}</span>

<span class="token comment">// NewPbService make a new PbService</span>
<span class="token keyword">func</span> <span class="token function">NewPbService</span><span class="token punctuation">(</span><span class="token punctuation">)</span> PbService <span class="token punctuation">{</span>
	<span class="token keyword">return</span> pbService<span class="token punctuation">{</span>
		memory<span class="token punctuation">:</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">map</span><span class="token punctuation">[</span>uuid<span class="token punctuation">.</span>UUID<span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">//Create: Here we store the content and return a uuid</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>s pbService<span class="token punctuation">)</span> <span class="token function">Create</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> content <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	id <span class="token operator">:=</span> uuid<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	s<span class="token punctuation">.</span>memory<span class="token punctuation">[</span>id<span class="token punctuation">]</span> <span class="token operator">=</span> content
	<span class="token keyword">return</span> id<span class="token punctuation">.</span><span class="token function">String</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">nil</span>
<span class="token punctuation">}</span>

<span class="token comment">//Get: Here we use the key to find and return the content stored</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>s pbService<span class="token punctuation">)</span> <span class="token function">Get</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> key <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	id<span class="token punctuation">,</span> err <span class="token operator">:=</span> uuid<span class="token punctuation">.</span><span class="token function">Parse</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token string">""</span><span class="token punctuation">,</span> errors<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span><span class="token string">"Invalid Uuid Format"</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	content<span class="token punctuation">,</span> exists <span class="token operator">:=</span> s<span class="token punctuation">.</span>memory<span class="token punctuation">[</span>id<span class="token punctuation">]</span>
	<span class="token keyword">if</span> exists <span class="token punctuation">{</span>
		<span class="token keyword">return</span> content<span class="token punctuation">,</span> <span class="token boolean">nil</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> <span class="token string">""</span><span class="token punctuation">,</span> errors<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span><span class="token string">"Invalid Uuid"</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">//Delete: Here we use the key to find and delete the content stored</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>s pbService<span class="token punctuation">)</span> <span class="token function">Delete</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> key <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	id<span class="token punctuation">,</span> err <span class="token operator">:=</span> uuid<span class="token punctuation">.</span><span class="token function">Parse</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token string">""</span><span class="token punctuation">,</span> errors<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span><span class="token string">"Invalid Uuid Format"</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	<span class="token function">delete</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span>memory<span class="token punctuation">,</span> id<span class="token punctuation">)</span>
	<span class="token keyword">return</span> <span class="token string">"ok"</span><span class="token punctuation">,</span> <span class="token boolean">nil</span>
<span class="token punctuation">}</span>
</code></pre>
<h3 id="transportgo"><a aria-hidden="true" class="anchor-heading" href="#transportgo"><svg aria-hidden="true" viewBox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a><code>transport.go</code></h3>
<pre class="language-go"><code class="language-go"><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token string">"context"</span>
	<span class="token string">"encoding/json"</span>
	<span class="token string">"net/http"</span>

	<span class="token string">"github.com/go-kit/kit/endpoint"</span>
<span class="token punctuation">)</span>

<span class="token keyword">type</span> createPbRequest <span class="token keyword">struct</span> <span class="token punctuation">{</span>
	Content <span class="token builtin">string</span> <span class="token string">`json:"content"`</span>
<span class="token punctuation">}</span>

<span class="token keyword">type</span> createPbResponse <span class="token keyword">struct</span> <span class="token punctuation">{</span>
	Key <span class="token builtin">string</span> <span class="token string">`json:"key"`</span>
	Err <span class="token builtin">string</span> <span class="token string">`json:"err,omitempty"`</span> <span class="token comment">// errors don't JSON-marshal, so we use a string</span>
<span class="token punctuation">}</span>

<span class="token keyword">type</span> getPbRequest <span class="token keyword">struct</span> <span class="token punctuation">{</span>
	Key <span class="token builtin">string</span> <span class="token string">`json:"key"`</span>
<span class="token punctuation">}</span>

<span class="token keyword">type</span> getPbResponse <span class="token keyword">struct</span> <span class="token punctuation">{</span>
	Content <span class="token builtin">string</span> <span class="token string">`json:"content"`</span>
	Err     <span class="token builtin">string</span> <span class="token string">`json:"err,omitempty"`</span> <span class="token comment">// errors don't JSON-marshal, so we use a string</span>
<span class="token punctuation">}</span>

<span class="token keyword">type</span> deletePbRequest <span class="token keyword">struct</span> <span class="token punctuation">{</span>
	Key <span class="token builtin">string</span> <span class="token string">`json:"key"`</span>
<span class="token punctuation">}</span>

<span class="token keyword">type</span> deletePbResponse <span class="token keyword">struct</span> <span class="token punctuation">{</span>
	Status <span class="token builtin">string</span> <span class="token string">`json:"status"`</span>
	Err    <span class="token builtin">string</span> <span class="token string">`json:"err,omitempty"`</span> <span class="token comment">// errors don't JSON-marshal, so we use a string</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">createPbEndpoint</span><span class="token punctuation">(</span>svc PbService<span class="token punctuation">)</span> endpoint<span class="token punctuation">.</span>Endpoint <span class="token punctuation">{</span>
	<span class="token keyword">return</span> <span class="token keyword">func</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> request <span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		req <span class="token operator">:=</span> request<span class="token punctuation">.</span><span class="token punctuation">(</span>createPbRequest<span class="token punctuation">)</span>
		key<span class="token punctuation">,</span> err <span class="token operator">:=</span> svc<span class="token punctuation">.</span><span class="token function">Create</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> req<span class="token punctuation">.</span>Content<span class="token punctuation">)</span>
		<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
			<span class="token keyword">return</span> createPbResponse<span class="token punctuation">{</span>key<span class="token punctuation">,</span> err<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">nil</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">return</span> createPbResponse<span class="token punctuation">{</span>key<span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">nil</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">deletePbEndpoint</span><span class="token punctuation">(</span>svc PbService<span class="token punctuation">)</span> endpoint<span class="token punctuation">.</span>Endpoint <span class="token punctuation">{</span>
	<span class="token keyword">return</span> <span class="token keyword">func</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> request <span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		req <span class="token operator">:=</span> request<span class="token punctuation">.</span><span class="token punctuation">(</span>deletePbRequest<span class="token punctuation">)</span>
		status<span class="token punctuation">,</span> err <span class="token operator">:=</span> svc<span class="token punctuation">.</span><span class="token function">Delete</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> req<span class="token punctuation">.</span>Key<span class="token punctuation">)</span>
		<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
			<span class="token keyword">return</span> deletePbResponse<span class="token punctuation">{</span>status<span class="token punctuation">,</span> err<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">nil</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">return</span> deletePbResponse<span class="token punctuation">{</span>status<span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">nil</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">getPbEndpoint</span><span class="token punctuation">(</span>svc PbService<span class="token punctuation">)</span> endpoint<span class="token punctuation">.</span>Endpoint <span class="token punctuation">{</span>
	<span class="token keyword">return</span> <span class="token keyword">func</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> request <span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		req <span class="token operator">:=</span> request<span class="token punctuation">.</span><span class="token punctuation">(</span>getPbRequest<span class="token punctuation">)</span>
		content<span class="token punctuation">,</span> err <span class="token operator">:=</span> svc<span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> req<span class="token punctuation">.</span>Key<span class="token punctuation">)</span>
		<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
			<span class="token keyword">return</span> getPbResponse<span class="token punctuation">{</span>content<span class="token punctuation">,</span> err<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">nil</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">return</span> getPbResponse<span class="token punctuation">{</span>content<span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">nil</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">decodeCreatePbRequest</span><span class="token punctuation">(</span><span class="token boolean">_</span> context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> r <span class="token operator">*</span>http<span class="token punctuation">.</span>Request<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">var</span> request createPbRequest
	<span class="token keyword">if</span> err <span class="token operator">:=</span> json<span class="token punctuation">.</span><span class="token function">NewDecoder</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>Body<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Decode</span><span class="token punctuation">(</span><span class="token operator">&#x26;</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> err
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> request<span class="token punctuation">,</span> <span class="token boolean">nil</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">decodeGetPbRequest</span><span class="token punctuation">(</span><span class="token boolean">_</span> context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> r <span class="token operator">*</span>http<span class="token punctuation">.</span>Request<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">var</span> request getPbRequest
	<span class="token keyword">if</span> err <span class="token operator">:=</span> json<span class="token punctuation">.</span><span class="token function">NewDecoder</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>Body<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Decode</span><span class="token punctuation">(</span><span class="token operator">&#x26;</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> err
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> request<span class="token punctuation">,</span> <span class="token boolean">nil</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">decodeDeletePbRequest</span><span class="token punctuation">(</span><span class="token boolean">_</span> context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> r <span class="token operator">*</span>http<span class="token punctuation">.</span>Request<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">var</span> request deletePbRequest
	<span class="token keyword">if</span> err <span class="token operator">:=</span> json<span class="token punctuation">.</span><span class="token function">NewDecoder</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>Body<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Decode</span><span class="token punctuation">(</span><span class="token operator">&#x26;</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> err
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> request<span class="token punctuation">,</span> <span class="token boolean">nil</span>
<span class="token punctuation">}</span>
</code></pre>
<h3 id="maingo"><a aria-hidden="true" class="anchor-heading" href="#maingo"><svg aria-hidden="true" viewBox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a><code>main.go</code></h3>
<pre class="language-go"><code class="language-go"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	svc <span class="token operator">:=</span> <span class="token function">NewPbService</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	createPbHandler <span class="token operator">:=</span> httptransport<span class="token punctuation">.</span><span class="token function">NewServer</span><span class="token punctuation">(</span>
		<span class="token function">createPbEndpoint</span><span class="token punctuation">(</span>svc<span class="token punctuation">)</span><span class="token punctuation">,</span>
		decodeCreatePbRequest<span class="token punctuation">,</span>
		encodeResponse<span class="token punctuation">,</span>
	<span class="token punctuation">)</span>

	deletePbHandler <span class="token operator">:=</span> httptransport<span class="token punctuation">.</span><span class="token function">NewServer</span><span class="token punctuation">(</span>
		<span class="token function">deletePbEndpoint</span><span class="token punctuation">(</span>svc<span class="token punctuation">)</span><span class="token punctuation">,</span>
		decodeDeletePbRequest<span class="token punctuation">,</span>
		encodeResponse<span class="token punctuation">,</span>
	<span class="token punctuation">)</span>
	getPbHandler <span class="token operator">:=</span> httptransport<span class="token punctuation">.</span><span class="token function">NewServer</span><span class="token punctuation">(</span>
		<span class="token function">getPbEndpoint</span><span class="token punctuation">(</span>svc<span class="token punctuation">)</span><span class="token punctuation">,</span>
		decodeGetPbRequest<span class="token punctuation">,</span>
		encodeResponse<span class="token punctuation">,</span>
	<span class="token punctuation">)</span>
	http<span class="token punctuation">.</span><span class="token function">Handle</span><span class="token punctuation">(</span><span class="token string">"/create"</span><span class="token punctuation">,</span> createPbHandler<span class="token punctuation">)</span>
	http<span class="token punctuation">.</span><span class="token function">Handle</span><span class="token punctuation">(</span><span class="token string">"/delete"</span><span class="token punctuation">,</span> deletePbHandler<span class="token punctuation">)</span>
	http<span class="token punctuation">.</span><span class="token function">Handle</span><span class="token punctuation">(</span><span class="token string">"/get"</span><span class="token punctuation">,</span> getPbHandler<span class="token punctuation">)</span>
	log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span>http<span class="token punctuation">.</span><span class="token function">ListenAndServe</span><span class="token punctuation">(</span><span class="token string">":8080"</span><span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
<h2 id="logging-middleware"><a aria-hidden="true" class="anchor-heading" href="#logging-middleware"><svg aria-hidden="true" viewBox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a>Logging Middleware</h2>
<p>All applications need to log information, this can be enabled by adding a logging middleware that we create in a file called <code>logging.go</code></p>
<p>Middleware in go-kit work on <code>Endpoint</code></p>
<p>The interface definition is <code>type Middleware func(Endpoint) Endpoint</code>, which means it is a function that takes in an endpoint and returns an endpoint</p>
<p>We can create the <code>loggingMiddleware</code> so that it adheres to the <code>PbService</code> by implementing the <code>Create</code> <code>Delete</code> <code>Get</code> methods.</p>
<pre class="language-go"><code class="language-go"><span class="token keyword">type</span> loggingMiddleware <span class="token keyword">struct</span> <span class="token punctuation">{</span>
	logger log<span class="token punctuation">.</span>Logger
	next   PbService
<span class="token punctuation">}</span>
</code></pre>
<h3 id="create"><a aria-hidden="true" class="anchor-heading" href="#create"><svg aria-hidden="true" viewBox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a>Create</h3>
<pre class="language-go"><code class="language-go"><span class="token keyword">func</span> <span class="token punctuation">(</span>m loggingMiddleware<span class="token punctuation">)</span> <span class="token function">Create</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> content <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>output <span class="token builtin">string</span><span class="token punctuation">,</span> err <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">// This defered function would be invoked just before the retuen statement</span>
	<span class="token keyword">defer</span> <span class="token keyword">func</span><span class="token punctuation">(</span>begin time<span class="token punctuation">.</span>Time<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		m<span class="token punctuation">.</span>logger<span class="token punctuation">.</span><span class="token function">Log</span><span class="token punctuation">(</span>
			<span class="token string">"method"</span><span class="token punctuation">,</span> <span class="token string">"CreatePb"</span><span class="token punctuation">,</span>
			<span class="token string">"input"</span><span class="token punctuation">,</span> content<span class="token punctuation">,</span>
			<span class="token string">"output"</span><span class="token punctuation">,</span> output<span class="token punctuation">,</span>
			<span class="token string">"err"</span><span class="token punctuation">,</span> err<span class="token punctuation">,</span>
			<span class="token string">"took"</span><span class="token punctuation">,</span> time<span class="token punctuation">.</span><span class="token function">Since</span><span class="token punctuation">(</span>begin<span class="token punctuation">)</span><span class="token punctuation">,</span>
		<span class="token punctuation">)</span>
	<span class="token punctuation">}</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	output<span class="token punctuation">,</span> err <span class="token operator">=</span> m<span class="token punctuation">.</span>next<span class="token punctuation">.</span><span class="token function">Create</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> content<span class="token punctuation">)</span>
	<span class="token keyword">return</span>
<span class="token punctuation">}</span>
</code></pre>
<h3 id="delete"><a aria-hidden="true" class="anchor-heading" href="#delete"><svg aria-hidden="true" viewBox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a>Delete</h3>
<pre class="language-go"><code class="language-go"> <span class="token keyword">func</span> <span class="token punctuation">(</span>m loggingMiddleware<span class="token punctuation">)</span> <span class="token function">Delete</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> key <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>output <span class="token builtin">string</span><span class="token punctuation">,</span> err <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">defer</span> <span class="token keyword">func</span><span class="token punctuation">(</span>begin time<span class="token punctuation">.</span>Time<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		m<span class="token punctuation">.</span>logger<span class="token punctuation">.</span><span class="token function">Log</span><span class="token punctuation">(</span>
			<span class="token string">"method"</span><span class="token punctuation">,</span> <span class="token string">"DeletePb"</span><span class="token punctuation">,</span>
			<span class="token string">"input"</span><span class="token punctuation">,</span> key<span class="token punctuation">,</span>
			<span class="token string">"output"</span><span class="token punctuation">,</span> output<span class="token punctuation">,</span>
			<span class="token string">"err"</span><span class="token punctuation">,</span> err<span class="token punctuation">,</span>
			<span class="token string">"took"</span><span class="token punctuation">,</span> time<span class="token punctuation">.</span><span class="token function">Since</span><span class="token punctuation">(</span>begin<span class="token punctuation">)</span><span class="token punctuation">,</span>
		<span class="token punctuation">)</span>
	<span class="token punctuation">}</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	output<span class="token punctuation">,</span> err <span class="token operator">=</span> m<span class="token punctuation">.</span>next<span class="token punctuation">.</span><span class="token function">Delete</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> key<span class="token punctuation">)</span>
	<span class="token keyword">return</span>
<span class="token punctuation">}</span>
</code></pre>
<h3 id="get"><a aria-hidden="true" class="anchor-heading" href="#get"><svg aria-hidden="true" viewBox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a>Get</h3>
<pre class="language-go"><code class="language-go"><span class="token keyword">func</span> <span class="token punctuation">(</span>m loggingMiddleware<span class="token punctuation">)</span> <span class="token function">Get</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> key <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>output <span class="token builtin">string</span><span class="token punctuation">,</span> err <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">defer</span> <span class="token keyword">func</span><span class="token punctuation">(</span>begin time<span class="token punctuation">.</span>Time<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		m<span class="token punctuation">.</span>logger<span class="token punctuation">.</span><span class="token function">Log</span><span class="token punctuation">(</span>
			<span class="token string">"method"</span><span class="token punctuation">,</span> <span class="token string">"GetPb"</span><span class="token punctuation">,</span>
			<span class="token string">"input"</span><span class="token punctuation">,</span> key<span class="token punctuation">,</span>
			<span class="token string">"output"</span><span class="token punctuation">,</span> output<span class="token punctuation">,</span>
			<span class="token string">"err"</span><span class="token punctuation">,</span> err<span class="token punctuation">,</span>
			<span class="token string">"took"</span><span class="token punctuation">,</span> time<span class="token punctuation">.</span><span class="token function">Since</span><span class="token punctuation">(</span>begin<span class="token punctuation">)</span><span class="token punctuation">,</span>
		<span class="token punctuation">)</span>
	<span class="token punctuation">}</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	output<span class="token punctuation">,</span> err <span class="token operator">=</span> m<span class="token punctuation">.</span>next<span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> key<span class="token punctuation">)</span>
	<span class="token keyword">return</span>
<span class="token punctuation">}</span>
</code></pre>
<h2 id="wiring-the-middleware"><a aria-hidden="true" class="anchor-heading" href="#wiring-the-middleware"><svg aria-hidden="true" viewBox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a>Wiring the Middleware</h2>
<p>In order to wire the middleware in all we have to do is link it up with the service that we have defined</p>
<pre class="language-go"><code class="language-go"><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token string">"context"</span>
	<span class="token string">"encoding/json"</span>
	<span class="token string">"net/http"</span>
	<span class="token string">"os"</span>

	<span class="token string">"github.com/go-kit/kit/log"</span>

	httptransport <span class="token string">"github.com/go-kit/kit/transport/http"</span>
<span class="token punctuation">)</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">// Use the global logger</span>
	logger <span class="token operator">:=</span> log<span class="token punctuation">.</span><span class="token function">NewLogfmtLogger</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>Stderr<span class="token punctuation">)</span>
	<span class="token keyword">var</span> svc PbService
	svc <span class="token operator">=</span> <span class="token function">NewPbService</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token comment">// Wire the middleware and thats it</span>
	svc <span class="token operator">=</span> loggingMiddleware<span class="token punctuation">{</span>logger<span class="token punctuation">,</span> svc<span class="token punctuation">}</span>

	createPbHandler <span class="token operator">:=</span> httptransport<span class="token punctuation">.</span><span class="token function">NewServer</span><span class="token punctuation">(</span>
		<span class="token function">createPbEndpoint</span><span class="token punctuation">(</span>svc<span class="token punctuation">)</span><span class="token punctuation">,</span>
		decodeCreatePbRequest<span class="token punctuation">,</span>
		encodeResponse<span class="token punctuation">,</span>
	<span class="token punctuation">)</span>

	deletePbHandler <span class="token operator">:=</span> httptransport<span class="token punctuation">.</span><span class="token function">NewServer</span><span class="token punctuation">(</span>
		<span class="token function">deletePbEndpoint</span><span class="token punctuation">(</span>svc<span class="token punctuation">)</span><span class="token punctuation">,</span>
		decodeDeletePbRequest<span class="token punctuation">,</span>
		encodeResponse<span class="token punctuation">,</span>
	<span class="token punctuation">)</span>

	getPbHandler <span class="token operator">:=</span> httptransport<span class="token punctuation">.</span><span class="token function">NewServer</span><span class="token punctuation">(</span>
		<span class="token function">getPbEndpoint</span><span class="token punctuation">(</span>svc<span class="token punctuation">)</span><span class="token punctuation">,</span>
		decodeGetPbRequest<span class="token punctuation">,</span>
		encodeResponse<span class="token punctuation">,</span>
	<span class="token punctuation">)</span>
	http<span class="token punctuation">.</span><span class="token function">Handle</span><span class="token punctuation">(</span><span class="token string">"/create"</span><span class="token punctuation">,</span> createPbHandler<span class="token punctuation">)</span>
	http<span class="token punctuation">.</span><span class="token function">Handle</span><span class="token punctuation">(</span><span class="token string">"/delete"</span><span class="token punctuation">,</span> deletePbHandler<span class="token punctuation">)</span>
	http<span class="token punctuation">.</span><span class="token function">Handle</span><span class="token punctuation">(</span><span class="token string">"/get"</span><span class="token punctuation">,</span> getPbHandler<span class="token punctuation">)</span>
	logger<span class="token punctuation">.</span><span class="token function">Log</span><span class="token punctuation">(</span><span class="token string">"msg"</span><span class="token punctuation">,</span> <span class="token string">"HTTP"</span><span class="token punctuation">,</span> <span class="token string">"addr"</span><span class="token punctuation">,</span> <span class="token string">":8080"</span><span class="token punctuation">)</span>
	logger<span class="token punctuation">.</span><span class="token function">Log</span><span class="token punctuation">(</span><span class="token string">"err"</span><span class="token punctuation">,</span> http<span class="token punctuation">.</span><span class="token function">ListenAndServe</span><span class="token punctuation">(</span><span class="token string">":8080"</span><span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">encodeResponse</span><span class="token punctuation">(</span><span class="token boolean">_</span> context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> w http<span class="token punctuation">.</span>ResponseWriter<span class="token punctuation">,</span> response <span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{</span>
	<span class="token keyword">return</span> json<span class="token punctuation">.</span><span class="token function">NewEncoder</span><span class="token punctuation">(</span>w<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Encode</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
<h2 id="pastebin"><a aria-hidden="true" class="anchor-heading" href="#pastebin"><svg aria-hidden="true" viewBox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a>PasteBin</h2>
<h3 id="client"><a aria-hidden="true" class="anchor-heading" href="#client"><svg aria-hidden="true" viewBox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a>Client</h3>
<pre class="language-sh"><code class="language-sh">
$ curl localhost:8080/create -XPOST -d '{"content":"THIS IS SPARTA"}'

{"key":"c449250a-d74c-4d23-acbb-6785b0bd822a"}

$ curl localhost:8080/get -XPOST -d '{"key":"c449250a-d74c-4d23-acbb-6785b0bd822a"}'

{"content":"THIS IS SPARTA"}

$ curl localhost:8I00/delete -XPOST -d '{"key":"c449250a-d74c-4d23-acbb-6785b0bd822a"}'

{"status":"ok"}

$ curl localhost:8080/get -XPOST -d '{"key":"c449250a-d74c-4d23-acbb-6785b0bd822a"}'

{"content":"","err":"Invalid Uuid"}

</code></pre>
<h3 id="server"><a aria-hidden="true" class="anchor-heading" href="#server"><svg aria-hidden="true" viewBox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a>Server</h3>
<pre class="language-sh"><code class="language-sh">$ ./pastebin-II

msg=HTTP addr=:8080

method=CreatePb input="THIS IS SPARTA" output=c449250a-d74c-4d23-acbb-6785b0bd822a err=null took=67.92Âµs

method=GetPb input=c449250a-d74c-4d23-acbb-6785b0bd822a output="THIS IS SPARTA" err=null took=1.675Âµs

method=DeletePb input=c449250a-d74c-4d23-acbb-6785b0bd822a output=ok err=null took=1.45Âµs

method=GetPb input=c449250a-d74c-4d23-acbb-6785b0bd822a output= err="Invalid Uuid" took=803ns
</code></pre><span id="navId" data="QNZTT1U9ZBung828xTuQz"></span>

                
      </section>

      
    </div>

    
  </article>

  
  
</div>

        <div class="thumbs feedback_trigger right-bottom"></div>

        
          <hr>
          <footer>
            
            

            
              <div class="d-flex mt-2">
              <p class="text-small text-grey-dk-000 mb-0 mr-2">
                Page last modified: <span class="d-inline-block">17/10/2020</span>.
              </p>
            
                
                  <p class="text-small text-grey-dk-000 mb-0">
                    <a href="https://github.com/DeltaManiac/deltamaniac.github.io/edit/main/vault/go.framework.gokit.md" id="edit-this-page">Edit this page on GitHub</a>
                  </p>
                
              </div>
          </footer>
        
    </div>
</div>


  

  <div class="search-overlay"></div>

</div>

</body>
</html>
